
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpportunityHub - Find Your Next Challenge</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="manifest" href="site.webmanifest">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --accent: #f72585;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #4cc9f0;
            --warning: #ffd166;
            --danger: #ef476f;
            --gray: #6c757d;
            --light-gray: #e9ecef;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7ff;
            color: var(--dark);
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header Styles - Fixed for mobile */
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1rem 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
            transition: transform 0.3s ease;
        }
        
        header.hidden {
            transform: translateY(-100%);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            display: flex;
            align-items: center;
        }
        
        .logo i {
            margin-right: 10px;
        }
        
        nav ul {
            display: flex;
            list-style: none;
        }
        
        nav ul li {
            margin-left: 1.5rem;
        }
        
        nav ul li a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            padding: 5px 10px;
            border-radius: 4px;
        }
        
        nav ul li a:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .auth-buttons {
            display: flex;
            gap: 10px;
        }
        
        .auth-buttons button {
            background-color: white;
            color: var(--primary);
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .admin-section {
    background: white;
    border-radius: 8px;
    padding: 1.5rem;
    margin: 2rem 0;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    border-left: 4px solid var(--primary);
}

.application-filters {
    margin: 1.5rem 0;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.filter-btn {
    padding: 10px 20px;
    border: 2px solid var(--primary);
    background: white;
    color: var(--primary);
    border-radius: 6px;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.3s ease;
}

.filter-btn.active, 
.filter-btn:hover {
    background: var(--primary);
    color: white;
    transform: translateY(-2px);
}

.application-reason {
    max-width: 300px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.status-badge {
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    text-transform: capitalize;
}


.status-pending {
    background: var(--warning);
    color: var(--dark);
}
.status-approved {
    background: var(--success);
    color: white;
}

.status-rejected {
    background: var(--danger);
    color: white;
}

.super-admin-badge {
    background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 0.7rem;
    margin-left: 10px;
    font-weight: 600;
}
        
        .auth-buttons button:hover {
            background-color: var(--light);
            transform: translateY(-2px);
        }
        
        /* Auth Modal */
        .auth-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .auth-content {
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 1.5rem;
        }
        
        .auth-tab {
            flex: 1;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            border-bottom: 2px solid var(--light-gray);
        }
        
        .auth-tab.active {
            border-bottom: 2px solid var(--primary);
            font-weight: 600;
            color: var(--primary);
        }
        
        .auth-form {
            display: none;
        }
        
        .auth-form.active {
            display: block;
        }
        
        .auth-form input {
            width: 100%;
            padding: 12px;
            margin-bottom: 1rem;
            border: 1px solid var(--light-gray);
            border-radius: 4px;
            font-size: 1rem;
        }
        
        .auth-form button {
            width: 100%;
            padding: 12px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .auth-form button:hover {
            background-color: var(--secondary);
        }
        
        .auth-error {
            color: var(--danger);
            margin-top: 1rem;
            text-align: center;
            display: none;
        }
        
        /* Google Sign-In Button */
        .google-signin-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 10px;
            background-color: white;
            color: #757575;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 15px;
        }
        
        .google-signin-btn:hover {
            background-color: #f5f5f5;
        }
        
        .google-signin-btn img {
            width: 18px;
            height: 18px;
            margin-right: 10px;
        }
        
        /* Password Reset Link */
        .password-reset-link {
            text-align: center;
            margin-top: 15px;
            color: var(--primary);
            cursor: pointer;
            font-size: 14px;
        }
        
        .password-reset-link:hover {
            text-decoration: underline;
        }
        
        /* Hero Section */
        .hero {
            background: linear-gradient(rgba(67, 97, 238, 0.9), rgba(58, 12, 163, 0.9)), url('https://images.unsplash.com/photo-1523240795612-9a054b0db644?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80');
            background-size: cover;
            background-position: center;
            color: white;
            padding: 4rem 0;
            text-align: center;
        }
        
        .hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        .hero p {
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto 2rem;
        }
        
        .search-bar {
            max-width: 600px;
            margin: 0 auto;
            display: flex;
        }
        
       .search-bar input {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 4px 0 0 4px;
            font-size: 1rem;
        }
        
        .search-bar button {
            background-color: var(--accent);
            color: white;
            border: none;
            padding: 0 20px;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
            font-size: 1.2rem;
        }
        
        /* Filters Section */
        .filters {
            background-color: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            margin: -30px auto 30px;
            position: relative;
            max-width: 1000px;
            z-index: 10;
        }
        
        .filter-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .filter-group {
            flex: 1;
            min-width: 200px;
        }
        
        .filter-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }
        
        .filter-group select, .filter-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--light-gray);
            border-radius: 4px;
            background-color: var(--light);
        }
        
        /* Multi-select styles */
        .multiselect-container {
            position: relative;
        }
        
        .multiselect-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
            background: white;
            border: 1px solid var(--light-gray);
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }
        
        .multiselect-dropdown.show {
            display: block;
        }
        
        .multiselect-option {
            padding: 8px 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
        }
        
        .multiselect-option:hover {
            background-color: var(--light);
        }
        
        .multiselect-option input {
            margin-right: 8px;
            width: auto;
        }
        
        .multiselect-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 5px;
        }
        
        .multiselect-tag {
            background-color: var(--primary);
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
        }
        
        .multiselect-tag i {
            margin-left: 5px;
            cursor: pointer;
        }
        
        .filter-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .filter-actions button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .apply-btn {
            background-color: var(--primary);
            color: white;
        }
        
        .reset-btn {
            background-color: var(--light-gray);
            color: var(--dark);
        }
        
        /* Opportunities Grid */
        .opportunities-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin: 2rem 0;
        }
        
        .opportunity-card {
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
        }
        
        .opportunity-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--light-gray);
        }
        
        /* Opportunity badges - Updated for consistency */
        .opportunity-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 10px;
            margin-right: 5px;
        }
        
        .type-badge {
            background-color: #e6f7ff;
            color: #0066cc;
        }
        
        .field-badge {
            background-color: #f0e6ff;
            color: #6600cc;
        }
        .level-badge {
    background-color: #fff0e6;
    color: #cc4400;
}
        .format-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .format-online {
            background-color: #e6f7ff;
            color: #0066cc;
        }
        
        .format-onsite {
            background-color: #fff0e6;
            color: #cc4400;
        }
        
        .format-hybrid {
            background-color: #e6f7ed;
            color: #007a41;
        }
        
        .card-header h3 {
            font-size: 1.3rem;
            margin-bottom: 10px;
        }
        
        .organization {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .card-body {
            padding: 1.5rem;
        }
        
        .detail {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .detail i {
            width: 24px;
            color: var(--primary);
            margin-right: 10px;
        }
        
        .deadline {
            color: var(--danger);
            font-weight: 600;
            display: flex;
            align-items: center;
        }
        
        .deadline.urgent {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { color: var(--danger); }
            50% { color: #ff8fa3; }
            100% { color: var(--danger); }
        }
        
        .time-remaining {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 8px;
            background-color: var(--light-gray);
        }
        
        .time-remaining.urgent {
            background-color: var(--danger);
            color: white;
        }
        
        .time-remaining.warning {
            background-color: var(--warning);
            color: var(--dark);
        }
        
        .time-remaining.normal {
            background-color: var(--success);
            color: white;
        }
        
        .card-footer {
            padding: 1rem 1.5rem;
            background-color: var(--light);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .save-btn {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 1.2rem;
            transition: color 0.3s ease;
        }
        
        .save-btn:hover, .save-btn.saved {
            color: var(--accent);
        }
        
        .apply-link, .details-btn {
            color: var(--primary);
            font-weight: 600;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 4px;
            background-color: rgba(67, 97, 238, 0.1);
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .apply-link:hover, .details-btn:hover {
            background-color: var(--primary);
            color: white;
        }
        
        .card-actions {
            display: flex;
            gap: 10px;
            width: 100%;
            justify-content: space-between;
        }
        
        .card-actions .left-actions {
            display: flex;
            gap: 10px;
        }
        
        .card-actions .right-actions {
            display: flex;
            gap: 10px;
        }
        
        /* Dashboard */
        .dashboard {
            display: none;
            margin: 2rem 0;
        }
        
        .dashboard-tabs {
            display: flex;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .dashboard-tab {
            padding: 1rem 1.5rem;
            cursor: pointer;
            font-weight: 500;
        }
        
        .dashboard-tab.active {
            border-bottom: 2px solid var(--primary);
            color: var(--primary);
        }
        
      .dashboard-content {
            display: none;
        }
        
        .dashboard-content.active {
            display: block;
        }
        
        .dashboard-opportunities {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .empty-state {
            text-align: center;
            padding: 2rem;
            color: var(--gray);
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--light-gray);
        }
        
        /* Admin Panel */
        .admin-panel {
            display: none;
            margin: 2rem 0;
        }
        .filter-expired {
    background-color: #ff6b6b;
    color: white;
}
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
.admin-actions {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
    margin-bottom: 1rem;
}
        
   .admin-table {
    width: 100%;
    border-collapse: collapse;
    margin: 1.5rem 0;
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
        
    .admin-table td {
    padding: 12px 15px;
    border-bottom: 1px solid var(--light-gray);
}
        
    .admin-table th {
    background: var(--primary);
    color: white;
    padding: 15px;
    text-align: left;
    font-weight: 600;
}
        @media (max-width: 768px) {
    .admin-actions {
        flex-direction: column;
        align-items: stretch;
    }
    
    .application-filters {
        justify-content: center;
    }
    
    .admin-table {
        display: block;
        overflow-x: auto;
    }
    
    .footer-content {
        grid-template-columns: 1fr;
        text-align: center;
    }
}
        
        .admin-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .admin-table tr:hover {
            background-color: #e9ecef;
        }
        
        .admin-actions-cell {
            display: flex;
            gap: 8px;
        }
        
        .admin-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .edit-btn {
            background-color: var(--warning);
            color: var(--dark);
        }
        
        .delete-btn {
            background-color: var(--danger);
            color: white;
        }
        
        /* Admin Modal */
        .admin-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        /* Add these styles to your CSS section */
.filter-expired-btn {
    background-color: #ff6b6b;
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
}

.filter-expired-btn:hover {
    background-color: #ff5252;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.filter-expired-btn.active {
    background-color: #dc3545;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
}

.filter-expired-btn.filter-expired {
    background-color: #dc3545;
}

.filter-expired-btn.filter-all {
    background-color: var(--primary);
}
        
        .admin-modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            width: 100%;
            max-width: 600px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .admin-form-group {
            margin-bottom: 1.5rem;
        }
        .filter-expired.active, 
.filter-expired:hover,
.filter-expired-btn.active, 
.filter-expired-btn:hover {
    background-color: var(--danger);
    color: white;
}
        
        .admin-form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        #addOpportunityBtn {
    background: var(--primary);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
}
        #refreshApplicationsBtn {
    background: var(--success);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
}
    #addOpportunityBtn:hover,
#refreshApplicationsBtn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}
        
        .admin-form-group input, .admin-form-group select, .admin-form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--light-gray);
            border-radius: 4px;
            font-size: 1rem;
        }
        
        .admin-form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .admin-form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 1.5rem;
        }
        
        .admin-form-actions button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .cancel-btn {
            background-color: var(--light-gray);
            color: var(--dark);
        }
        
        .submit-btn {
            background-color: var(--primary);
            color: white;
        }
        
        /* Notification */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: white;
            border-left: 4px solid var(--success);
            padding: 15px 20px;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            transform: translateX(150%);
            transition: transform 0.3s ease;
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification i {
            color: var(--success);
            font-size: 1.5rem;
            margin-right: 10px;
        }
        
        .notification.error {
            border-left-color: var(--danger);
        }
        
        .notification.error i {
            color: var(--danger);
        }
        
        .notification.warning {
            border-left-color: var(--warning);
        }
        
        .notification.warning i {
            color: var(--warning);
        }
        
        /* Footer */
      footer {
    background-color: var(--dark);
    color: white;
    padding: 3rem 0 2rem;
    margin-top: 4rem;
    width: 100%;
}
        
.footer-content {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 30px;
}
        .site-footer {
    background-color: #2c3e50;
    color: #ecf0f1;
    padding: 40px 0 20px;
    width: 100%; /* Add this */
    margin: 0; /* Ensure no margin */
}
        
        .footer-section h3 {
            font-size: 1.2rem;
            margin-bottom: 1.2rem;
            position: relative;
            padding-bottom: 10px;
        }
        
        .footer-section h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 2px;
            background-color: var(--accent);
        }
        
        .footer-links {
            list-style: none;
        }
        
        .footer-links li {
            margin-bottom: 10px;
        }
        
        .footer-links a {
            color: #ccc;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .footer-links a:hover {
            color: white;
        }
        
        .copyright {
            text-align: center;
            padding-top: 2rem;
            margin-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #ccc;
            font-size: 0.9rem;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            nav ul {
                margin-top: 1rem;
                justify-content: center;
                flex-wrap: wrap;
            }
            
            nav ul li {
                margin: 5px;
            }
            
            .auth-buttons {
                margin-top: 1rem;
            }
            
            .hero h1 {
                font-size: 2.2rem;
            }
            
            .hero p {
                font-size: 1rem;
            }
            
            .filter-row {
                flex-direction: column;
            }
            
            .admin-table {
                display: block;
                overflow-x: auto;
            }
            
            .opportunities-grid {
                grid-template-columns: 1fr;
            }
            
            .card-footer {
                flex-direction: column;
                align-items: stretch;
            }
            
            .card-actions {
                flex-direction: column;
                gap: 10px;
            }
            
            .card-actions .left-actions, .card-actions .right-actions {
                justify-content: space-between;
                width: 100%;
            }
            
            /* Mobile header behavior */
            header {
                padding: 0.5rem 0;
            }
            
            .logo {
                font-size: 1.4rem;
            }
            
            nav ul li {
                margin-left: 0.8rem;
            }
            
            .auth-buttons button {
                padding: 6px 12px;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 480px) {
            .logo {
                font-size: 1.2rem;
            }
            
            nav ul li a {
                font-size: 0.9rem;
                padding: 4px 8px;
            }
            
            .auth-buttons button {
                padding: 5px 10px;
                font-size: 0.8rem;
            }
            
            .hero h1 {
                font-size: 1.8rem;
            }
            
            .search-bar {
                flex-direction: column;
            }
            
            .search-bar input {
                border-radius: 4px;
                margin-bottom: 10px;
            }
            
            .search-bar button {
                border-radius: 4px;
                padding: 12px;
            }
        }

        /* Enhanced Notification System */
        .notification-system {
            position: fixed;
            top: 80px;
            right: 20px;
            width: 350px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
            z-index: 9999;
            display: none;
            max-height: 500px;
            overflow: hidden;
        }

        .notification-system.show {
            display: block;
            animation: slideInRight 0.3s ease;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: var(--primary);
            color: white;
            border-radius: 8px 8px 0 0;
        }

        .notification-header h3 {
            margin: 0;
            font-size: 1.1rem;
        }

        .notification-clear {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .notification-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .notification-item {
            padding: 15px 20px;
            border-bottom: 1px solid var(--light-gray);
            display: flex;
            align-items: flex-start;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .notification-item:hover {
            background-color: #f8f9fa;
        }

        .notification-item.unread {
            background-color: #f0f7ff;
            border-left: 3px solid var(--primary);
        }

        .notification-item.urgent {
            background-color: #fff5f5;
            border-left: 3px solid var(--danger);
        }

        .notification-icon {
            margin-right: 12px;
            font-size: 1.2rem;
            margin-top: 2px;
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 0.95rem;
        }

        .notification-message {
            font-size: 0.85rem;
            color: var(--gray);
            margin-bottom: 5px;
            line-height: 1.4;
        }

        .notification-time {
            font-size: 0.75rem;
            color: #adb5bd;
        }

        .notification-actions {
            display: flex;
            gap: 5px;
            margin-top: 8px;
        }

        .notification-action-btn {
            background: none;
            border: 1px solid #dee2e6;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 0.7rem;
            cursor: pointer;
        }

        .empty-notifications {
            text-align: center;
            padding: 30px 20px;
            color: var(--gray);
        }

        .empty-notifications i {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--light-gray);
        }

        /* Deadline Alert Modal */
        .deadline-alert-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .deadline-alert-modal.show {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .deadline-alert-content {
            background: white;
            border-radius: 12px;
            width: 100%;
            max-width: 450px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .deadline-alert-header {
            background: linear-gradient(135deg, var(--danger), #ff6b6b);
            color: white;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .deadline-alert-header h3 {
            margin: 0;
            flex: 1;
        }

        .deadline-alert-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .deadline-alert-body {
            padding: 25px;
        }

        .deadline-alert-body p {
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .deadline-alert-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .btn-primary, .btn-secondary, .btn-tertiary {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-secondary {
            background: var(--warning);
            color: var(--dark);
        }

        .btn-tertiary {
            background: var(--light-gray);
            color: var(--dark);
        }

        /* Notification Bell in Header */
        .notification-bell {
            position: relative;
            margin-right: 15px;
            cursor: pointer;
        }

        .notification-bell i {
            font-size: 1.3rem;
            color: white;
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Notification Settings */
        .notification-settings {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            z-index: 999;
            display: none;
            max-width: 300px;
            width: 90%;
        }

        .notification-settings.show {
            display: block;
        }

        .notification-settings h4 {
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Settings Icon */
        .settings-icon {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1rem;
            padding: 5px;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s;
        }

        .settings-icon:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        /* Notification Preferences */
        .notification-preferences {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--light-gray);
        }

        .preference-item {
            margin-bottom: 10px;
        }

        .preference-item label {
            display: flex;
            align-items: center;
            font-size: 0.9rem;
            cursor: pointer;
        }

        .preference-item input {
            margin-right: 8px;
        }

        /* Details Modal */
        .details-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .details-modal.show {
            display: flex;
        }

        .details-content {
            background-color: white;
            border-radius: 8px;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }

        .details-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--light-gray);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .details-header h2 {
            margin: 0;
            flex: 1;
            margin-right: 20px;
        }

        .details-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }

        .details-body {
            padding: 1.5rem;
        }

        .details-section {
            margin-bottom: 1.5rem;
        }

        .details-section h3 {
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        .details-actions {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--light-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        /* Duplicate Warning Modal */
        .duplicate-warning-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .duplicate-warning-content {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .duplicate-warning-content h3 {
            color: var(--warning);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .duplicate-warning-content h3 i {
            font-size: 1.5rem;
        }

        .existing-opportunity-info {
            background: #f8f9fa;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
            border-left: 4px solid var(--warning);
        }

        .existing-opportunity-info h4 {
            margin-bottom: 0.5rem;
            color: var(--dark);
        }

        .duplicate-warning-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        .duplicate-warning-actions button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .cancel-duplicate-btn {
            background: #6c757d;
            color: white;
        }

        .view-existing-btn {
            background: var(--primary);
            color: white;
        }

        .force-add-btn {
            background: var(--success);
            color: white;
        }

        /* Check Duplicates Button */
        .check-duplicates-btn {
            background: var(--warning);
            color: #000;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: background-color 0.3s;
        }

        .check-duplicates-btn:hover {
            background: #e0a800;
        }
        
        /* No results message */
        .no-results {
            text-align: center;
            padding: 3rem;
            color: var(--gray);
            font-size: 1.1rem;
            grid-column: 1 / -1;
        }
        
        .divider {
            display: flex;
            align-items: center;
            text-align: center;
            margin: 20px 0;
            color: var(--gray);
        }
        
        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .divider::before {
            margin-right: 10px;
        }
        
        .divider::after {
            margin-left: 10px;
        }

        /* CURATOR SYSTEM STYLES */
        .curator-profile {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border-left: 5px solid var(--primary);
        }

        .curator-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--light);
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary);
            display: block;
        }

        .stat-label {
            color: var(--gray);
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .badges-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 1.5rem 0;
        }

        .badge {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .badge.bronze {
            background: linear-gradient(135deg, #cd7f32, #b08d57);
        }

        .badge.silver {
            background: linear-gradient(135deg, #c0c0c0, #a8a8a8);
        }

        .badge.gold {
            background: linear-gradient(135deg, #ffd700, #daa520);
        }

        /* Leaderboard Styles */
        .leaderboard-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .leaderboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .leaderboard-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 1.5rem;
        }

        .leaderboard-tab {
            padding: 10px 20px;
            background: var(--light-gray);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .leaderboard-tab.active {
            background: var(--primary);
            color: white;
        }

        .leaderboard-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            background: var(--light);
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .leaderboard-item:hover {
            transform: translateX(5px);
            background: #e9ecef;
        }

        .rank {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary);
            width: 40px;
            text-align: center;
        }

        .rank-1 { color: #ffd700; }
        .rank-2 { color: #c0c0c0; }
        .rank-3 { color: #cd7f32; }

        .curator-info {
            flex: 1;
            margin-left: 1rem;
        }

        .curator-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .curator-stats-small {
            display: flex;
            gap: 15px;
            font-size: 0.8rem;
            color: var(--gray);
        }

        .view-curator-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s ease;
        }

        .view-curator-btn:hover {
            background: var(--secondary);
        }

        /* Navigation updates */
        .nav-curator {
            display: none;
        }
        .application-filters {
    margin: 1rem 0;
}

.filter-btn {
    padding: 8px 16px;
    border: 1px solid var(--primary);
    background: white;
    color: var(--primary);
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.filter-btn.active, .filter-btn:hover {
    background: var(--primary);
    color: white;
}

.application-reason {
    max-width: 300px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.status-badge {
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 600;
}

.status-pending {
    background: var(--warning);
    color: var(--dark);
}

.status-approved {
    background: var(--success);
    color: white;
}

.status-rejected {
    background: var(--danger);
    color: white;
}

.super-admin-badge {
    background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 0.7rem;
    margin-left: 10px;
    font-weight: 600;
}

.view-btn {
    background-color: var(--primary);
    color: white;
}

        /* Responsive updates */
        @media (max-width: 768px) {
            .curator-stats {
                grid-template-columns: 1fr;
            }
            
            .leaderboard-item {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }
            
            .curator-info {
                margin-left: 0;
            }
            
            .curator-stats-small {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header id="mainHeader">
        <div class="container header-content">
            <div class="logo">
                <i class="fas fa-rocket"></i>
                <span>OpportunityHub</span>
            </div>
            
            <nav>
                <ul>
                    <li><a href="#" class="nav-opportunities">Opportunities</a></li>
                    <li><a href="#" class="nav-dashboard">Dashboard</a></li>
                    <li><a href="#" class="nav-curator">My Curator Profile</a></li>
                    <li><a href="#" class="nav-admin" style="display: none;">Admin</a></li>
                    <li class="notification-bell" id="notificationBell" style="display: none;">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
                    </li>
                </ul>
            </nav>
            
            <div class="auth-buttons">
                <button id="loginBtn">Sign In</button>
                <button id="signupBtn">Sign Up</button>
                <button id="logoutBtn" style="display: none;">Logout</button>
                <button class="settings-icon" id="notificationSettingsBtn" style="display: none;">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </div>
    </header>
    
    <!-- Auth Modal -->
    <div class="auth-modal" id="authModal">
        <div class="auth-content">
            <div class="auth-tabs">
                <div class="auth-tab active" data-tab="login">Login</div>
                <div class="auth-tab" data-tab="signup">Sign Up</div>
            </div>
            
            <div class="auth-form active" id="loginForm">
                <input type="email" id="loginEmail" placeholder="Email">
                <input type="password" id="loginPassword" placeholder="Password">
                <button id="doLogin">Login</button>
                <div class="password-reset-link" id="passwordResetLink">Forgot Password?</div>
                <div class="auth-error" id="loginError"></div>
                
                <div class="divider">or</div>
                <button class="google-signin-btn" id="googleSignIn">
                    <img src="https://developers.google.com/identity/images/g-logo.png" alt="Google logo">
                    Sign in with Google
                </button>
            </div>
            
            <div class="auth-form" id="signupForm">
                <input type="text" id="signupName" placeholder="Full Name">
                <input type="email" id="signupEmail" placeholder="Email">
                <input type="password" id="signupPassword" placeholder="Password">
                <input type="password" id="signupConfirm" placeholder="Confirm Password">
                <button id="doSignup">Sign Up</button>
                <div class="auth-error" id="signupError"></div>
                
                <div class="divider">or</div>
                <button class="google-signin-btn" id="googleSignUp">
                    <img src="https://developers.google.com/identity/images/g-logo.png" alt="Google logo">
                    Sign up with Google
                </button>
            </div>
        </div>
    </div>
    
    <!-- Hero Section -->
    <section class="hero" id="heroSection">
        <div class="container">
            <h1>Find Your Next Challenge</h1>
            <p>Discover internships, research opportunities, and summer programs to build your portfolio and boost your career</p>
            
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="Search opportunities by keyword, field, or organization...">
                <button id="searchBtn"><i class="fas fa-search"></i></button>
            </div>
        </div>
    </section>
    
    <!-- Main Content -->
    <main class="container">
        <!-- Curator Profile Section -->
        <div class="curator-profile" id="curatorProfile" style="display: none;">
            <h2>My Curator Profile</h2>
            <div class="curator-stats">
                <div class="stat-card">
                    <span class="stat-number" id="opportunitiesCreated">0</span>
                    <span class="stat-label">Opportunities Created</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="totalSaves">0</span>
                    <span class="stat-label">Total Saves by Students</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="uniqueSavers">0</span>
                    <span class="stat-label">Unique Students Reached</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="curatorRank">-</span>
                    <span class="stat-label">Leaderboard Rank</span>
                </div>
            </div>
            
            <h3>Your Badges</h3>
            <div class="badges-container" id="badgesContainer">
                <!-- Badges will be dynamically added here -->
            </div>
            <!-- Add this to your curator-profile section, after the badges container -->
            <div class="community-application-section" style="margin: 2rem 0; padding: 1.5rem; background: var(--light); border-radius: 8px;">
    <h3>Join Our Community</h3>
    <p>Want to become a curator and help others find amazing opportunities?</p>
    <button class="apply-link" id="joinCommunityBtn" style="margin-top: 1rem;">
        <i class="fas fa-handshake"></i> I Want to Become a Part of This Community
    </button>
    
    <!-- Application Status Display -->
    <div id="applicationStatus" style="margin-top: 1rem; display: none;">
        <p><strong>Your Application Status:</strong> <span id="statusText"></span></p>
        <p id="statusMessage" style="font-size: 0.9rem; color: var(--gray);"></p>
    </div>
</div>
            
            <h3>Your Top Opportunities</h3>
            <div id="topOpportunitiesList">
                <!-- Top opportunities will be dynamically added here -->
            </div>
        </div>

        <!-- Leaderboard Section -->
        <div class="leaderboard-section" id="leaderboardSection" style="display: none;">
            <div class="leaderboard-header">
                <h2>Top Curators</h2>
                <span id="leaderboardUpdateTime"></span>
            </div>
            
            <div class="leaderboard-tabs">
                <button class="leaderboard-tab active" data-period="all">All Time</button>
                <button class="leaderboard-tab" data-period="month">This Month</button>
                <button class="leaderboard-tab" data-period="week">This Week</button>
            </div>
            
            <div class="leaderboard-list" id="leaderboardList">
                <!-- Leaderboard items will be dynamically added here -->
            </div>
        </div>

        <!-- Filters Section -->
        <section class="filters" id="filtersSection">
            <div class="filter-row">
                <div class="filter-group">
                    <label for="fieldInput">Field of Interest</label>
                    <div class="multiselect-container">
                        <input type="text" id="fieldInput" placeholder="Select fields..." readonly>
                        <div class="multiselect-dropdown" id="fieldDropdown">
                            <!-- Field options will be populated by JavaScript -->
                        </div>
                        <div class="multiselect-tags" id="fieldTags"></div>
                    </div>
                </div>
                
                <div class="filter-group">
                    <label for="typeInput">Opportunity Type</label>
                    <div class="multiselect-container">
                        <input type="text" id="typeInput" placeholder="Select types..." readonly>
                        <div class="multiselect-dropdown" id="typeDropdown">
                            <!-- Type options will be populated by JavaScript -->
                        </div>
                        <div class="multiselect-tags" id="typeTags"></div>
                    </div>
                </div>
                
                <div class="filter-group">
                    <label for="format">Format</label>
                    <select id="format">
                        <option value="">All Formats</option>
                        <option value="online">Online</option>
                        <option value="onsite">On-site</option>
                        <option value="hybrid">Hybrid</option>
                    </select>
                </div>
            </div>
            
            <div class="filter-row">
                <div class="filter-group">
    <label for="studentTypeInput">Student Level</label>
    <div class="multiselect-container">
        <input type="text" id="studentTypeInput" placeholder="Select levels..." readonly>
        <div class="multiselect-dropdown" id="studentTypeDropdown">
            <!-- Student type options will be populated by JavaScript -->
        </div>
        <div class="multiselect-tags" id="studentTypeTags"></div>
    </div>
</div>
                <div class="filter-group">
                    <label for="deadline">Deadline Within</label>
                    <select id="deadline">
                        <option value="">Any Time</option>
                        <option value="week">1 Week</option>
                        <option value="month">1 Month</option>
                        <option value="3months">3 Months</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="language">Language</label>
                    <select id="language">
                        <option value="">Any Language</option>
                        <option value="english">English</option>
                        <option value="russian">Russian</option>
                        <option value="uzbek">Uzbek</option>
                        <option value="english-russian">English/Russian</option>
                    </select>
                </div>
            </div>
            
            <div class="filter-actions">
                <button class="reset-btn" id="resetFilters">Reset Filters</button>
                <button class="apply-btn" id="applyFilters">Apply Filters</button>
            </div>
        </section>
        
        <!-- Opportunities Grid -->
        <h2 id="opportunitiesTitle">Featured Opportunities</h2>
        <div class="opportunities-grid" id="opportunitiesGrid">
            <!-- Opportunities will be loaded from Firebase -->
        </div>
        
        <!-- Dashboard -->
        <div class="dashboard" id="dashboard">
            <h2>My Dashboard</h2>
            
            <div class="dashboard-tabs">
                <div class="dashboard-tab active" data-tab="pending">Pending Opportunities</div>
                <div class="dashboard-tab" data-tab="completed">Completed</div>
            </div>
            
            <div class="dashboard-content active" id="pendingContent">
                <div class="dashboard-opportunities" id="pendingOpportunities">
                    <div class="empty-state">
                        <i class="far fa-bookmark"></i>
                        <h3>No pending opportunities</h3>
                        <p>Save opportunities to your dashboard to track them here</p>
                    </div>
                </div>
            </div>
            
            <div class="dashboard-content" id="completedContent">
                <div class="dashboard-opportunities" id="completedOpportunities">
                    <div class="empty-state">
                        <i class="far fa-check-circle"></i>
                        <h3>No completed opportunities</h3>
                        <p>Mark opportunities as complete to track your achievements</p>
                    </div>
                </div>
            </div>
        </div>
        
      <!-- Admin Panel - SINGLE VERSION -->
<div class="admin-panel" id="adminPanel">
    <div class="admin-header">
        <h2>Admin Panel</h2>
      <div class="admin-actions">
    <button class="apply-btn" id="addOpportunityBtn">
        <i class="fas fa-plus"></i> Add New Opportunity
    </button>
    <button class="check-duplicates-btn" id="checkDuplicatesBtn">
        <i class="fas fa-clone"></i> Check All Duplicates
    </button>
    <button class="filter-expired-btn" id="filterExpiredBtn">
        <i class="fas fa-hourglass-end"></i> Show Expired Only
    </button>
</div>
    </div>
    
    <!-- Applications Management Section (Super Admin Only) -->
    <div class="admin-section" style="margin: 2rem 0; display: none;" id="applicationsManagementSection">
        <h3>Community Applications Management <span class="super-admin-badge">Super Admin Only</span></h3>
        <div class="admin-actions">
            <button class="apply-btn" id="refreshApplicationsBtn">
                <i class="fas fa-sync-alt"></i> Refresh Applications
            </button>
        </div>
        
        <div class="application-filters">
            <button class="filter-btn active" data-status="all">All</button>
            <button class="filter-btn" data-status="pending">Pending</button>
            <button class="filter-btn" data-status="approved">Approved</button>
            <button class="filter-btn" data-status="rejected">Rejected</button>
        </div>
        
        <table class="admin-table">
            <thead>
                <tr>
                    <th>Applicant</th>
                    <th>Age</th>
                    <th>Email</th>
                    <th>Reason</th>
                    <th>Applied Date</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="applicationsList">
                <!-- Applications will be loaded here -->
            </tbody>
        </table>
    </div>

    <!-- Opportunities Management Section -->
    <div class="admin-section">
        <h3>Opportunities Management</h3>
        <table class="admin-table">
            <thead>
                <tr>
                    <th>Title</th>
                    <th>Organization</th>
                    <th>Type</th>
                    <th>Format</th>
                    <th>Deadline</th>
                    <th>Added By</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="adminOpportunitiesList">
                <!-- Admin opportunities will be loaded here -->
            </tbody>
        </table>
    </div>
</div>

<!-- Admin Modal (for adding/editing opportunities) -->
<div class="admin-modal" id="adminModal">
    <div class="admin-modal-content">
        <h2 id="adminModalTitle">Add New Opportunity</h2>
        
        <button class="check-duplicates-btn" id="checkDuplicateBtn">
            <i class="fas fa-search"></i> Check for Duplicates Before Submitting
        </button>
        
        <form id="adminOpportunityForm">
            <input type="hidden" id="opportunityId">
            
            <div class="admin-form-group">
                <label for="adminTitle">Title *</label>
                <input type="text" id="adminTitle" required>
            </div>
            
            <div class="admin-form-group">
                <label for="adminOrganization">Organization *</label>
                <input type="text" id="adminOrganization" required>
            </div>
            
            <div class="admin-form-group">
                <label for="adminTypeInput">Type *</label>
                <div class="multiselect-container">
                    <input type="text" id="adminTypeInput" placeholder="Select types..." readonly>
                    <div class="multiselect-dropdown" id="adminTypeDropdown">
                        <!-- Type options will be populated by JavaScript -->
                    </div>
                    <div class="multiselect-tags" id="adminTypeTags"></div>
                </div>
            </div>
            
            <div class="admin-form-group">
                <label for="adminFieldInput">Field *</label>
                <div class="multiselect-container">
                    <input type="text" id="adminFieldInput" placeholder="Select fields..." readonly>
                    <div class="multiselect-dropdown" id="adminFieldDropdown">
                        <!-- Field options will be populated by JavaScript -->
                    </div>
                    <div class="multiselect-tags" id="adminFieldTags"></div>
                </div>
            </div>
            
            <div class="admin-form-group">
                <label for="adminFormat">Format *</label>
                <select id="adminFormat" required>
                    <option value="">Select Format</option>
                    <option value="online">Online</option>
                    <option value="onsite">On-site</option>
                    <option value="hybrid">Hybrid</option>
                </select>
            </div>
            
            <div class="admin-form-group" id="locationFieldGroup">
                <label for="adminLocation">Location *</label>
                <input type="text" id="adminLocation">
            </div>
            <div class="admin-form-group">
    <label for="adminStudentTypeInput">Student Level *</label>
    <div class="multiselect-container">
        <input type="text" id="adminStudentTypeInput" placeholder="Select levels..." readonly required>
        <div class="multiselect-dropdown" id="adminStudentTypeDropdown">
            <!-- Student type options will be populated by JavaScript -->
        </div>
        <div class="multiselect-tags" id="adminStudentTypeTags"></div>
    </div>
</div>
            <div class="admin-form-group">
                <label for="adminDescription">Description *</label>
                <textarea id="adminDescription" required></textarea>
            </div>
            
            <div class="admin-form-group">
                <label for="adminDeadline">Deadline *</label>
                <input type="date" id="adminDeadline" required>
            </div>
            
            <div class="admin-form-group">
                <label for="adminApplyLink">Application Link *</label>
                <input type="url" id="adminApplyLink" required>
            </div>
            
            <div class="admin-form-group">
                <label for="adminTimeCommitment">Time Commitment (Optional)</label>
                <input type="text" id="adminTimeCommitment" placeholder="e.g., 20 hours per week">
            </div>
            
            <div class="admin-form-group">
                <label for="adminDuration">Duration (Optional)</label>
                <input type="text" id="adminDuration" placeholder="e.g., 3 months">
            </div>
            
            <div class="admin-form-group">
                <label for="adminLanguage">Language (Optional)</label>
                <select id="adminLanguage">
                    <option value="">Select Language</option>
                    <option value="english">English</option>
                    <option value="russian">Russian</option>
                    <option value="uzbek">Uzbek</option>
                    <option value="english-russian">English/Russian</option>
                </select>
            </div>
            
            <div class="admin-form-group">
                <label for="adminAgeRestrictions">Age Restrictions (Optional)</label>
                <input type="text" id="adminAgeRestrictions" placeholder="e.g., Under 22, 18-25, 16+">
            </div>
            
            <div class="admin-form-actions">
                <button type="button" class="cancel-btn" id="adminCancelBtn">Cancel</button>
                <button type="submit" class="submit-btn">Save Opportunity</button>
            </div>
        </form>
    </div>
</div>
    
    <!-- Details Modal -->
    <div class="details-modal" id="detailsModal">
        <div class="details-content">
            <div class="details-header">
                <h2 id="detailsTitle">Opportunity Details</h2>
                <button class="details-close" id="detailsClose">&times;</button>
            </div>
            <div class="details-body">
                <div class="details-section">
                    <h3>Description</h3>
                    <p id="detailsDescription"></p>
                </div>
                <div class="details-section">
                    <h3>Organization</h3>
                    <p id="detailsOrganization"></p>
                </div>
                <div class="details-section">
                    <h3>Type</h3>
                    <p id="detailsType"></p>
                </div>
                <div class="details-section">
                    <h3>Field</h3>
                    <p id="detailsField"></p>
                </div>
                <div class="details-section">
                    <h3>Location</h3>
                    <p id="detailsLocation"></p>
                </div>
                <div class="details-section">
                    <h3>Deadline</h3>
                    <p id="detailsDeadline"></p>
                </div>
            <div class="details-section">
                <h3>Age Restrictions</h3>
                <p id="detailsAgeRestrictions">No age restrictions specified</p>
            </div>
                <div class="details-section">
                    <h3>Additional Information</h3>
                    <p id="detailsAdditionalInfo"></p>
                </div>
            </div>
            <div class="details-actions">
                <div class="left-actions">
                    <button class="save-btn" id="detailsSaveBtn">
                        <i class="far fa-bookmark"></i> Save to Dashboard
                    </button>
                </div>
                <div class="right-actions">
                    <a href="#" target="_blank" class="apply-link" id="detailsApplyLink">Apply Now</a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Notification -->
    <div class="notification" id="notification">
        <i class="fas fa-bell"></i>
        <div class="notification-content">
            <h4>Notification</h4>
            <p>Operation completed successfully!</p>
        </div>
    </div>
    
    <!-- Enhanced Notification System -->
    <div class="notification-system" id="notificationSystem">
        <div class="notification-header">
            <h3><i class="fas fa-bell"></i> Notifications</h3>
            <div>
                <button class="notification-clear" id="markAllRead">Mark All Read</button>
                <button class="notification-clear" id="clearAllNotifications">Clear All</button>
            </div>
        </div>
        <div class="notification-list" id="notificationList">
            <!-- Notifications will be dynamically added here -->
        </div>
    </div>
    
    <!-- Deadline Alert Modal -->
    <div class="deadline-alert-modal" id="deadlineAlertModal">
        <div class="deadline-alert-content">
            <div class="deadline-alert-header">
                <i class="fas fa-exclamation-triangle"></i>
                <h3>Deadline Alert!</h3>
                <button class="deadline-alert-close" id="closeDeadlineAlert">&times;</button>
            </div>
            <div class="deadline-alert-body">
                <p id="deadlineAlertMessage"></p>
                <div class="deadline-alert-actions">
                    <button class="btn-primary" id="viewOpportunityBtn">View Opportunity</button>
                    <button class="btn-secondary" id="snoozeDeadlineBtn">Snooze (24h)</button>
                    <button class="btn-tertiary" id="dismissDeadlineBtn">Dismiss</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Notification Settings Panel -->
    <div class="notification-settings" id="notificationSettings">
        <h4>Notification Settings <button class="settings-icon" id="closeSettings"><i class="fas fa-times"></i></button></h4>
        
        <div class="setting-item">
            <span>Browser Notifications</span>
            <label class="switch">
                <input type="checkbox" id="browserNotifications">
                <span class="slider"></span>
            </label>
        </div>
        
        <div class="setting-item">
            <span>Sound Notifications</span>
            <label class="switch">
                <input type="checkbox" id="soundNotifications">
                <span class="slider"></span>
            </label>
        </div>
        
        <div class="notification-preferences">
            <h5>Notification Preferences</h5>
            <div class="preference-item">
                <label>
                    <input type="checkbox" id="deadlineReminders" checked>
                    Deadline Reminders
                </label>
            </div>
            <div class="preference-item">
                <label>
                    <input type="checkbox" id="newOpportunities" checked>
                    New Opportunities
                </label>
            </div>
            <div class="preference-item">
                <label>
                    <input type="checkbox" id="applicationUpdates" checked>
                    Application Updates
                </label>
            </div>
        </div>
        
        <div class="setting-item">
            <span>Reminder Intervals (days before deadline)</span>
            <div>
                <label><input type="checkbox" name="reminderIntervals" value="7" checked> 7 days</label>
                <label><input type="checkbox" name="reminderIntervals" value="3" checked> 3 days</label>
                <label><input type="checkbox" name="reminderIntervals" value="1" checked> 1 day</label>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
   <footer class="site-footer">
        <div class="container footer-content">
            <div class="footer-section">
                <h3>About OpportunityHub</h3>
                <p>We connect high school students with meaningful opportunities to build their portfolios and gain real-world experience.</p>
            </div>
            
            <div class="footer-section">
                <h3>Quick Links</h3>
                <ul class="footer-links">
                    <li><a href="#" class="footer-opportunities">Browse Opportunities</a></li>
                    <li><a href="#" class="footer-dashboard">My Dashboard</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>Resources</h3>
                <ul class="footer-links">
                    <li><a href="#" class="footer-resources">Application Tips</a></li>
                    <li><a href="#" class="footer-resources">Interview Preparation</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>Contact Us</h3>
                <ul class="footer-links">
                    <li><a href="mailto:opportunityhubcontacts@gmail.com"><i class="fas fa-envelope"></i>opportunityhubcontacts@gmail.com</a></li>
                </ul>
            </div>
        </div>
        
        <div class="container copyright">
            <p>&copy; 2025 OpportunityHub. All rights reserved.</p>
        </div>
    </footer>
    <!-- Community Application Modal -->
<div class="admin-modal" id="communityApplicationModal">
    <div class="admin-modal-content">
        <h2>Join Our Community</h2>
        <p style="margin-bottom: 1.5rem; color: var(--gray);">Tell us a bit about yourself and why you want to join our community.</p>
        
        <form id="communityApplicationForm">
            <div class="admin-form-group">
                <label for="applicantName">Your Name *</label>
                <input type="text" id="applicantName" required>
            </div>
            
            <div class="admin-form-group">
                <label for="applicantAge">Your Age *</label>
                <input type="number" id="applicantAge" min="16" max="100" required>
            </div>
            
            <div class="admin-form-group">
                <label for="applicantReason">Why do you want to join our community? *</label>
                <textarea 
                    id="applicantReason" 
                    placeholder="Please share why you're interested in becoming a curator and how you can contribute to our community... (minimum 20 characters)"
                    minlength="20"
                    required
                    rows="5"
                ></textarea>
                <small style="color: var(--gray);">Minimum 20 characters required</small>
            </div>
            
            <div class="admin-form-actions">
                <button type="button" class="cancel-btn" id="cancelApplicationBtn">Cancel</button>
                <button type="submit" class="submit-btn">Submit Application</button>
            </div>
        </form>
    </div>
</div>

    <!-- Firebase App (core SDK is always required) -->

       <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-app.js";
    import { 
        getAuth, 
        createUserWithEmailAndPassword, 
        signInWithEmailAndPassword, 
        signOut, 
        onAuthStateChanged, 
        GoogleAuthProvider, 
        signInWithPopup,
        sendPasswordResetEmail,
        fetchSignInMethodsForEmail
    } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-auth.js";
    import { getDatabase, ref, set, get, child, push, onValue, remove, update } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-database.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyDEFumFatqFMn29D1x9f-_WWiVh2F_aVtQ",
        authDomain: "youthaxis-16bab.firebaseapp.com",
        projectId: "youthaxis-16bab",
        storageBucket: "youthaxis-16bab.firebasestorage.app",
        messagingSenderId: "287063568472",
        appId: "1:287063568472:web:9209a3a4a82407d63e9a2d",
        measurementId: "G-7M9QET4FLZ",
        databaseURL: "https://youthaxis-16bab-default-rtdb.firebaseio.com/"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const database = getDatabase(app);
    const googleProvider = new GoogleAuthProvider();

    // Global variables
    let allOpportunities = [];
    let filteredOpportunities = [];
    let userOpportunities = {
        pending: [],
        completed: []
    };
    let isAdminUser = false;
    let userOpportunitiesListener = null;
    let notificationManager = null;
    let currentOpportunityDetails = null;
    let lastScrollPosition = 0;

    // CURATOR SYSTEM VARIABLES
    let curatorStats = {
        opportunitiesCreated: 0,
        totalSaves: 0,
        uniqueSavers: 0,
        curatorRank: '-',
        badges: []
    };

    let leaderboardData = [];
    let userSaveStats = {};

    // Enhanced field and type options
    const FIELD_OPTIONS = {
        'any': 'Any Field',
        'stem': 'STEM',
        'business': 'Business & Finance',
        'arts': 'Arts & Design',
        'social': 'Social Sciences',
        'health': 'Health & Medicine',
        'humanities': 'Humanities',
        'education': 'Education',
        'law': 'Law & Policy',
        'engineering': 'Engineering',
        'environment': 'Environmental Science',
        'journalism': 'Journalism & Media',
        'technology': 'Technology & Computer Science',
        'literature': 'Literature & Writing',
        'languages': 'Languages & Linguistics',
        'psychology': 'Psychology',
        'economics': 'Economics',
        'mathematics': 'Mathematics',
        'physics': 'Physics',
        'chemistry': 'Chemistry',
        'biology': 'Biology'
    };

    const TYPE_OPTIONS = {
        'internship': 'Internship',
        'research': 'Research',
        'summer': 'Summer Program',
        'volunteer': 'Volunteer',
        'scholarship': 'Scholarship',
        'competition': 'Competition',
        'conference': 'Conference',
        'fellowship': 'Fellowship',
        'workshop': 'Workshop',
        'grant': 'Grant',
        'award': 'Award',
        'exchange': 'Exchange Program',
        'mentorship': 'Mentorship Program',
        'training': 'Training Program'
    };
    const STUDENT_TYPE_OPTIONS = {
    'highschool': 'High School',
    'bachelor': 'Bachelor',
    'master': 'Master',
    'phd': 'PhD',
    'any': 'Any Level'
};

    const ADMIN_ROLES = {
        SUPER_ADMIN: 'super-admin',
        ADMIN: 'admin'
    };

    // Utility functions
    function getOpportunityTypeText(type) {
        if (!type) return 'Not specified';
        
        if (Array.isArray(type)) {
            return type.map(t => TYPE_OPTIONS[t] || t).join(', ');
        }
        return TYPE_OPTIONS[type] || type;
    }

    function getFieldText(field) {
        if (!field) return 'Any Field';
        
        if (Array.isArray(field)) {
            if (field.includes('any')) {
                return 'Any Field';
            }
            return field.map(f => FIELD_OPTIONS[f] || f).join(', ');
        }
        
        if (field === 'any') {
            return 'Any Field';
        }
        
        return FIELD_OPTIONS[field] || field;
    }
    function getStudentTypeText(studentType) {
    if (!studentType) return 'High School';
    
    if (Array.isArray(studentType)) {
        if (studentType.includes('any')) {
            return 'All Levels';
        }
        return studentType.map(st => STUDENT_TYPE_OPTIONS[st] || st).join(', ');
    }
    
    if (studentType === 'any') {
        return 'All Levels';
    }
    
    return STUDENT_TYPE_OPTIONS[studentType] || studentType;
}
    function getFormatBadge(format) {
        switch(format) {
            case 'online': return '<span class="format-badge format-online">Online</span>';
            case 'onsite': return '<span class="format-badge format-onsite">On-site</span>';
            case 'hybrid': return '<span class="format-badge format-hybrid">Hybrid</span>';
            default: return '';
        }
    }

    function getFormatText(format) {
        switch(format) {
            case 'online': return 'Online';
            case 'onsite': return 'On-site';
            case 'hybrid': return 'Hybrid';
            default: return format || 'Not specified';
        }
    }

    function formatDate(dateString) {
        if (!dateString) return 'No deadline';
        
        try {
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return new Date(dateString).toLocaleDateString('en-US', options);
        } catch (e) {
            return 'Invalid date';
        }
    }

    function calculateTimeRemaining(deadline) {
        if (!deadline) return { text: 'No deadline', class: 'normal' };
        
        try {
            const now = new Date();
            const deadlineDate = new Date(deadline);
            const diffTime = deadlineDate - now;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays < 0) {
                return { text: 'Expired', class: 'expired' };
            } else if (diffDays === 0) {
                return { text: 'Today', class: 'urgent' };
            } else if (diffDays === 1) {
                return { text: '1 day', class: 'urgent' };
            } else if (diffDays < 7) {
                return { text: `${diffDays} days`, class: 'urgent' };
            } else if (diffDays < 30) {
                const weeks = Math.floor(diffDays / 7);
                const days = diffDays % 7;
                let text = `${weeks} week${weeks > 1 ? 's' : ''}`;
                if (days > 0) {
                    text += `, ${days} day${days > 1 ? 's' : ''}`;
                }
                return { text, class: 'warning' };
            } else {
                const months = Math.floor(diffDays / 30);
                const days = diffDays % 30;
                let text = `${months} month${months > 1 ? 's' : ''}`;
                if (days > 0) {
                    text += `, ${days} day${days > 1 ? 's' : ''}`;
                }
                return { text, class: 'normal' };
            }
        } catch (e) {
            return { text: 'Invalid date', class: 'normal' };
        }
    }

    function isOpportunityExpired(deadline) {
        if (!deadline) return false;
        
        try {
            const today = new Date();
            const deadlineDate = new Date(deadline);
            return deadlineDate < today;
        } catch (e) {
            return false;
        }
    }

    function isDeadlineUrgent(deadline) {
        if (!deadline) return false;
        
        try {
            const today = new Date();
            const deadlineDate = new Date(deadline);
            const diffTime = deadlineDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays <= 7 && diffDays >= 0;
        } catch (e) {
            return false;
        }
    }

    // Multi-Select Functionality
    class MultiSelect {
        constructor(inputId, dropdownId, tagsId, options) {
            this.input = document.getElementById(inputId);
            this.dropdown = document.getElementById(dropdownId);
            this.tags = document.getElementById(tagsId);
            this.options = options;
            this.selected = [];
            this.init();
        }

        init() {
            this.populateDropdown();

            this.input.addEventListener('click', () => {
                this.toggleDropdown();
            });

            document.addEventListener('click', (e) => {
                if (!this.input.contains(e.target) && !this.dropdown.contains(e.target)) {
                    this.hideDropdown();
                }
            });

            this.updateInputPlaceholder();
        }

        populateDropdown() {
            this.dropdown.innerHTML = '';
            
            for (const [key, value] of Object.entries(this.options)) {
                const option = document.createElement('div');
                option.className = 'multiselect-option';
                option.innerHTML = `
                    <input type="checkbox" id="${key}" value="${key}">
                    <label for="${key}">${value}</label>
                `;
                
                option.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const checkbox = option.querySelector('input');
                    checkbox.checked = !checkbox.checked;
                    
                    if (checkbox.checked) {
                        this.selectOption(key, value);
                    } else {
                        this.deselectOption(key);
                    }
                });
                
                this.dropdown.appendChild(option);
            }
        }

        selectOption(key, value) {
            if (!this.selected.includes(key)) {
                this.selected.push(key);
                this.renderTags();
                this.updateInputPlaceholder();
            }
        }

        deselectOption(key) {
            this.selected = this.selected.filter(item => item !== key);
            this.renderTags();
            this.updateInputPlaceholder();
        }

        renderTags() {
            this.tags.innerHTML = '';
            
            this.selected.forEach(key => {
                const tag = document.createElement('div');
                tag.className = 'multiselect-tag';
                tag.innerHTML = `
                    ${this.options[key]}
                    <i class="fas fa-times" data-value="${key}"></i>
                `;
                
                tag.querySelector('i').addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.deselectOption(key);
                });
                
                this.tags.appendChild(tag);
            });
        }

        updateInputPlaceholder() {
            if (this.selected.length === 0) {
                this.input.placeholder = 'Select options...';
            } else {
                this.input.placeholder = `${this.selected.length} selected`;
            }
        }

        toggleDropdown() {
            this.dropdown.classList.toggle('show');
        }

        hideDropdown() {
            this.dropdown.classList.remove('show');
        }

        getSelected() {
            return this.selected;
        }

        setSelected(values) {
            if (Array.isArray(values)) {
                this.selected = values;
            } else {
                this.selected = values ? [values] : [];
            }
            this.renderTags();
            this.updateInputPlaceholder();
            
            const checkboxes = this.dropdown.querySelectorAll('input');
            checkboxes.forEach(checkbox => {
                checkbox.checked = this.selected.includes(checkbox.value);
            });
        }

        clear() {
            this.selected = [];
            this.renderTags();
            this.updateInputPlaceholder();
            
            const checkboxes = this.dropdown.querySelectorAll('input');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
        }
    }

    // Initialize multi-select components
    let fieldMultiSelect, typeMultiSelect, adminFieldMultiSelect, adminTypeMultiSelect;

    // Notification functions
    function showNotification(message, type = 'success') {
        const notification = document.getElementById('notification');
        if (!notification) return;
        
        const notificationContent = notification.querySelector('.notification-content');
        
        notification.className = 'notification';
        if (type === 'error') {
            notification.classList.add('error');
        } else if (type === 'warning') {
            notification.classList.add('warning');
        }
        
        if (message) {
            notificationContent.innerHTML = `
                <h4>${type === 'error' ? 'Error' : type === 'warning' ? 'Warning' : 'Success'}</h4>
                <p>${message}</p>
            `;
        }
        
        notification.classList.add('show');
        
        setTimeout(() => {
            notification.classList.remove('show');
        }, 3000);
    }

    // CURATOR SYSTEM FUNCTIONS
    function initCuratorSystem() {
        trackOpportunitySaves();
        loadCuratorStats();
        loadLeaderboard();
        
        const user = auth.currentUser;
        if (user) {
            document.querySelector('.nav-curator').style.display = 'list-item';
        }
    }
           
 function updateCuratorStatsOnSave(opportunityId, userId) {
    // Find the opportunity
    const opportunity = allOpportunities.find(opp => opp.id === opportunityId);
    if (!opportunity) return;

    // Get the creator's user ID from the opportunity
    const creatorUserId = opportunity.addedBy;
    
    if (!creatorUserId) return;

    // Force reload curator stats and leaderboard for ALL users
    // This will update the stats for the creator of the saved opportunity
    setTimeout(() => {
        loadCuratorStats();
        loadLeaderboard();
    }, 500);
}
function trackOpportunitySaves() {
    const userOppRef = ref(database, 'userOpportunities');
    onValue(userOppRef, (snapshot) => {
        const data = snapshot.val();
        userSaveStats = {};
        
        console.log('TrackOpportunitySaves - Raw data:', data);
        
        if (data) {
            for (const userId in data) {
                for (const oppId in data[userId]) {
                    if (!userSaveStats[oppId]) {
                        userSaveStats[oppId] = new Set();
                    }
                    userSaveStats[oppId].add(userId);
                }
            }
            
            console.log('Processed userSaveStats:', userSaveStats);
            
            const user = auth.currentUser;
            if (user) {
                loadCuratorStats();
                loadLeaderboard();
            }
        } else {
            console.log('No user opportunity data found');
        }
    });
}

    function loadCuratorStats() {
        const user = auth.currentUser;
        if (!user) return;

        const userOpportunities = allOpportunities.filter(opp => opp.addedBy === user.uid);
        curatorStats.opportunitiesCreated = userOpportunities.length;

        let totalSaves = 0;
        let uniqueSavers = new Set();
        
        userOpportunities.forEach(opp => {
            if (userSaveStats[opp.id]) {
                totalSaves += userSaveStats[opp.id].size;
                userSaveStats[opp.id].forEach(saverId => uniqueSavers.add(saverId));
            }
        });

        curatorStats.totalSaves = totalSaves;
        curatorStats.uniqueSavers = uniqueSavers.size;

        calculateUserRank(user.uid);
        updateBadges();
        updateCuratorProfileUI();
    }

    function calculateUserRank(userId) {
        const userStats = leaderboardData.find(user => user.id === userId);
        if (userStats) {
            curatorStats.curatorRank = userStats.rank;
        } else {
            curatorStats.curatorRank = '-';
        }
    }

    function updateBadges() {
        const badges = [];
        
        if (curatorStats.opportunitiesCreated >= 10) {
            badges.push({ name: 'Bronze Curator', level: 'bronze', icon: '' });
        }
        
        if (curatorStats.opportunitiesCreated >= 25 && curatorStats.totalSaves >= 50) {
            badges.push({ name: 'Silver Curator', level: 'silver', icon: '' });
        }
        
        if (curatorStats.opportunitiesCreated >= 50 && curatorStats.totalSaves >= 200) {
            badges.push({ name: 'Gold Curator', level: 'gold', icon: '' });
        }
        
        if (curatorStats.uniqueSavers >= 100) {
            badges.push({ name: 'Community Builder', level: 'gold', icon: '' });
        }
        
        if (curatorStats.curatorRank <= 10 && curatorStats.curatorRank !== '-') {
            badges.push({ name: 'Rising Star', level: 'silver', icon: '' });
        }
        
        curatorStats.badges = badges;
    }

   function updateCuratorProfileUI() {
    document.getElementById('opportunitiesCreated').textContent = curatorStats.opportunitiesCreated;
    document.getElementById('totalSaves').textContent = curatorStats.totalSaves;
    document.getElementById('uniqueSavers').textContent = curatorStats.uniqueSavers;
    document.getElementById('curatorRank').textContent = curatorStats.curatorRank;

    const badgesContainer = document.getElementById('badgesContainer');
    badgesContainer.innerHTML = '';
    
    // ADD REFRESH BUTTON CODE:
    // Add refresh button if it doesn't exist
    if (!document.getElementById('refreshStatsBtn')) {
        const refreshBtn = document.createElement('button');
        refreshBtn.id = 'refreshStatsBtn';
        refreshBtn.className = 'apply-link';
        refreshBtn.innerHTML = '<i class="fas fa-sync-alt"></i> Refresh Stats';
        refreshBtn.style.marginTop = '10px';
        refreshBtn.addEventListener('click', () => {
            loadCuratorStats();
            loadLeaderboard();
            showNotification('Stats refreshed!');
        });
        document.querySelector('.curator-stats').appendChild(refreshBtn);
    }
    
    curatorStats.badges.forEach(badge => {
        const badgeElement = document.createElement('div');
        badgeElement.className = `badge ${badge.level}`;
        badgeElement.innerHTML = `
            ${badge.icon} ${badge.name}
        `;
        badgesContainer.appendChild(badgeElement);
    });

    updateTopOpportunities();
}

    function updateTopOpportunities() {
        const user = auth.currentUser;
        if (!user) return;

        const userOpportunities = allOpportunities.filter(opp => opp.addedBy === user.uid);
        
        userOpportunities.sort((a, b) => {
            const savesA = userSaveStats[a.id] ? userSaveStats[a.id].size : 0;
            const savesB = userSaveStats[b.id] ? userSaveStats[b.id].size : 0;
            return savesB - savesA;
        });

        const topOpportunitiesList = document.getElementById('topOpportunitiesList');
        topOpportunitiesList.innerHTML = '';

        const topOpps = userOpportunities.slice(0, 5);
        topOpps.forEach(opp => {
            const saves = userSaveStats[opp.id] ? userSaveStats[opp.id].size : 0;
            const oppElement = document.createElement('div');
            oppElement.className = 'opportunity-card';
            oppElement.innerHTML = `
                <div class="card-header">
                    <h3>${opp.title}</h3>
                    <p class="organization">${opp.organization}</p>
                </div>
                <div class="card-body">
                    <p>Saved by <strong>${saves}</strong> students</p>
                </div>
            `;
            topOpportunitiesList.appendChild(oppElement);
        });
    }

  function loadLeaderboard() {
    const creatorStats = {};
    
    allOpportunities.forEach(opp => {
        if (!creatorStats[opp.addedBy]) {
            creatorStats[opp.addedBy] = {
                id: opp.addedBy,
                name: opp.addedByName || 'Unknown Curator',
                opportunities: 0,
                totalSaves: 0,
                uniqueSavers: new Set()
            };
        }
        
        creatorStats[opp.addedBy].opportunities++;
        
        if (userSaveStats[opp.id]) {
            creatorStats[opp.addedBy].totalSaves += userSaveStats[opp.id].size;
            userSaveStats[opp.id].forEach(saverId => {
                creatorStats[opp.addedBy].uniqueSavers.add(saverId);
            });
        }
    });

    leaderboardData = Object.values(creatorStats).map(creator => {
        const score = creator.opportunities * 2 + creator.totalSaves + creator.uniqueSavers.size * 3;
        return {
            ...creator,
            uniqueSavers: creator.uniqueSavers.size,
            score: score
        };
    });

    leaderboardData.sort((a, b) => b.score - a.score);

    leaderboardData.forEach((creator, index) => {
        creator.rank = index + 1;
    });

    // Store in global variable
    window.globalLeaderboardData = leaderboardData;
    
    // Show all-time by default
    updateLeaderboardUIWithData(leaderboardData);
    
    // Initialize the tabs AFTER the leaderboard is loaded
    setTimeout(() => {
        initLeaderboardTabs();
    }, 100);
}

  function initLeaderboardTabs() {
    const leaderboardTabs = document.querySelectorAll('.leaderboard-tab');
    
    leaderboardTabs.forEach(tab => {
        tab.addEventListener('click', function() {
            // Remove active class from all tabs
            leaderboardTabs.forEach(t => t.classList.remove('active'));
            // Add active class to clicked tab
            this.classList.add('active');
            
            // Get the period (week, month, all)
            const period = this.getAttribute('data-period');
            
            // Filter leaderboard based on period
            filterLeaderboardByPeriod(period);
        });
    });
}

// Add this function to filter leaderboard by period
function filterLeaderboardByPeriod(period) {
    const currentDate = new Date();
    let filteredStats = {};
    
    // Get opportunities for the period
    let periodOpportunities = [];
    
    if (period === 'week') {
        // Get opportunities created in the last 7 days
        const oneWeekAgo = new Date();
        oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
        
        periodOpportunities = allOpportunities.filter(opp => {
            const oppDate = new Date(opp.createdAt || opp.updatedAt || '2000-01-01');
            return oppDate >= oneWeekAgo;
        });
    } else if (period === 'month') {
        // Get opportunities created in the last 30 days
        const oneMonthAgo = new Date();
        oneMonthAgo.setDate(oneMonthAgo.getDate() - 30);
        
        periodOpportunities = allOpportunities.filter(opp => {
            const oppDate = new Date(opp.createdAt || opp.updatedAt || '2000-01-01');
            return oppDate >= oneMonthAgo;
        });
    } else {
        // All time - use all opportunities
        periodOpportunities = allOpportunities;
    }
    
    console.log(`Filtered ${periodOpportunities.length} opportunities for ${period} period`);
    
    // Calculate creator stats for this period
    periodOpportunities.forEach(opp => {
        if (!filteredStats[opp.addedBy]) {
            filteredStats[opp.addedBy] = {
                id: opp.addedBy,
                name: opp.addedByName || 'Unknown Curator',
                opportunities: 0,
                totalSaves: 0,
                uniqueSavers: new Set()
            };
        }
        
        filteredStats[opp.addedBy].opportunities++;
        
        if (userSaveStats[opp.id]) {
            filteredStats[opp.addedBy].totalSaves += userSaveStats[opp.id].size;
            userSaveStats[opp.id].forEach(saverId => {
                filteredStats[opp.addedBy].uniqueSavers.add(saverId);
            });
        }
    });

    // Convert to array and calculate scores
    let periodLeaderboardData = Object.values(filteredStats).map(creator => {
        const score = creator.opportunities * 2 + creator.totalSaves + creator.uniqueSavers.size * 3;
        return {
            ...creator,
            uniqueSavers: creator.uniqueSavers.size,
            score: score
        };
    });

    // Sort by score
    periodLeaderboardData.sort((a, b) => b.score - a.score);

    // Add ranks
    periodLeaderboardData.forEach((creator, index) => {
        creator.rank = index + 1;
    });

    // Update the leaderboard UI with filtered data
    updateLeaderboardUIWithData(periodLeaderboardData);
}

// Modified version of updateLeaderboardUI to accept data parameter
function updateLeaderboardUIWithData(leaderboardData) {
    const leaderboardList = document.getElementById('leaderboardList');
    if (!leaderboardList) return;
    
    leaderboardList.innerHTML = '';

    const topCurators = leaderboardData.slice(0, 20);
    
    if (topCurators.length === 0) {
        leaderboardList.innerHTML = `
            <div style="text-align: center; padding: 2rem; color: var(--gray);">
                <i class="fas fa-users" style="font-size: 3rem; margin-bottom: 1rem; color: var(--light-gray);"></i>
                <h3>No curators found</h3>
                <p>No curators have added opportunities in this period</p>
            </div>
        `;
        return;
    }
    
    topCurators.forEach(creator => {
        const item = document.createElement('div');
        item.className = 'leaderboard-item';
        item.innerHTML = `
            <div class="rank rank-${creator.rank}">${creator.rank}</div>
            <div class="curator-info">
                <div class="curator-name">${creator.name}</div>
                <div class="curator-stats-small">
                    <span>${creator.opportunities} opportunities</span>
                    <span>${creator.totalSaves} saves</span>
                    <span>${creator.uniqueSavers} students reached</span>
                </div>
            </div>
            <button class="view-curator-btn" data-userid="${creator.id}">
                View Profile
            </button>
        `;
        leaderboardList.appendChild(item);
    });

    document.getElementById('leaderboardUpdateTime').textContent = 
        `Last updated: ${new Date().toLocaleTimeString()}`;
}
    function showCuratorProfile() {
        document.getElementById('curatorProfile').style.display = 'block';
        document.getElementById('leaderboardSection').style.display = 'block';
        
        document.getElementById('heroSection').style.display = 'none';
        document.getElementById('filtersSection').style.display = 'none';
        document.getElementById('opportunitiesTitle').style.display = 'none';
        document.getElementById('opportunitiesGrid').style.display = 'none';
        document.getElementById('dashboard').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'none';
        
        loadCuratorStats();
        loadLeaderboard();
    }

    // Wait for DOM to be fully loaded
    document.addEventListener('DOMContentLoaded', function() {
        // DOM Elements
        const loginBtn = document.getElementById('loginBtn');
        const signupBtn = document.getElementById('signupBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const authModal = document.getElementById('authModal');
        const authTabs = document.querySelectorAll('.auth-tab');
        const loginForm = document.getElementById('loginForm');
        const signupForm = document.getElementById('signupForm');
        const doLogin = document.getElementById('doLogin');
        const doSignup = document.getElementById('doSignup');
        const loginError = document.getElementById('loginError');
        const signupError = document.getElementById('signupError');
        const opportunitiesGrid = document.getElementById('opportunitiesGrid');
        const dashboard = document.getElementById('dashboard');
        const adminPanel = document.getElementById('adminPanel');
        const navDashboard = document.querySelector('.nav-dashboard');
        const navHome = document.querySelector('.nav-home');
        const navOpportunities = document.querySelector('.nav-opportunities');
        const navCurator = document.querySelector('.nav-curator');
        const navAdmin = document.querySelector('.nav-admin');
        const heroSection = document.getElementById('heroSection');
        const filtersSection = document.getElementById('filtersSection');
        const opportunitiesTitle = document.getElementById('opportunitiesTitle');
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const applyFiltersBtn = document.getElementById('applyFilters');
        const resetFiltersBtn = document.getElementById('resetFilters');
        const pendingOpportunities = document.getElementById('pendingOpportunities');
        const completedOpportunities = document.getElementById('completedOpportunities');
        const dashboardTabs = document.querySelectorAll('.dashboard-tab');
        const addOpportunityBtn = document.getElementById('addOpportunityBtn');
        const adminModal = document.getElementById('adminModal');
        const adminModalTitle = document.getElementById('adminModalTitle');
        const adminOpportunityForm = document.getElementById('adminOpportunityForm');
        const adminCancelBtn = document.getElementById('adminCancelBtn');
        const adminOpportunitiesList = document.getElementById('adminOpportunitiesList');
        const googleSignIn = document.getElementById('googleSignIn');
        const googleSignUp = document.getElementById('googleSignUp');
        const passwordResetLink = document.getElementById('passwordResetLink');
        const detailsModal = document.getElementById('detailsModal');
        const detailsClose = document.getElementById('detailsClose');
        const detailsSaveBtn = document.getElementById('detailsSaveBtn');
        const adminFormat = document.getElementById('adminFormat');
        const locationFieldGroup = document.getElementById('locationFieldGroup');
        const checkDuplicateBtn = document.getElementById('checkDuplicateBtn');
        const checkDuplicatesBtn = document.getElementById('checkDuplicatesBtn');
        const mainHeader = document.getElementById('mainHeader');

        // Initialize multi-select components
   // Initialize multi-select components
let fieldMultiSelect, typeMultiSelect, adminFieldMultiSelect, adminTypeMultiSelect;
// ADD THESE TWO LINES:
let studentTypeMultiSelect, adminStudentTypeMultiSelect;

// Later in your DOMContentLoaded function:
fieldMultiSelect = new MultiSelect('fieldInput', 'fieldDropdown', 'fieldTags', FIELD_OPTIONS);
typeMultiSelect = new MultiSelect('typeInput', 'typeDropdown', 'typeTags', TYPE_OPTIONS);
adminFieldMultiSelect = new MultiSelect('adminFieldInput', 'adminFieldDropdown', 'adminFieldTags', FIELD_OPTIONS);
adminTypeMultiSelect = new MultiSelect('adminTypeInput', 'adminTypeDropdown', 'adminTypeTags', TYPE_OPTIONS);
// ADD THESE TWO LINES HERE:
studentTypeMultiSelect = new MultiSelect('studentTypeInput', 'studentTypeDropdown', 'studentTypeTags', STUDENT_TYPE_OPTIONS);
adminStudentTypeMultiSelect = new MultiSelect('adminStudentTypeInput', 'adminStudentTypeDropdown', 'adminStudentTypeTags', STUDENT_TYPE_OPTIONS);
    
        // Event Listeners
        if (loginBtn) loginBtn.addEventListener('click', () => showAuthModal('login'));
        if (signupBtn) signupBtn.addEventListener('click', () => showAuthModal('signup'));
        if (logoutBtn) logoutBtn.addEventListener('click', handleLogout);
        
        if (authTabs) {
            authTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.getAttribute('data-tab');
                    switchAuthTab(tabName);
                });
            });
        }
        
        if (doLogin) doLogin.addEventListener('click', handleLogin);
        if (doSignup) doSignup.addEventListener('click', handleSignup);
        
        if (navDashboard) {
            navDashboard.addEventListener('click', (e) => {
                e.preventDefault();
                showDashboard();
            });
        }
        
        if (navHome) {
            navHome.addEventListener('click', (e) => {
                e.preventDefault();
                showHome();
            });
        }
        
        if (navOpportunities) {
            navOpportunities.addEventListener('click', (e) => {
                e.preventDefault();
                showOpportunities();
            });
        }
        
        if (navCurator) {
            navCurator.addEventListener('click', (e) => {
                e.preventDefault();
                showCuratorProfile();
            });
        }
        
        if (navAdmin) {
            navAdmin.addEventListener('click', (e) => {
                e.preventDefault();
                showAdminPanel();
            });
        }

        if (searchBtn) searchBtn.addEventListener('click', applySearchFilter);
        if (searchInput) {
            searchInput.addEventListener('keyup', (e) => {
                if (e.key === 'Enter') applySearchFilter();
            });
        }

        if (applyFiltersBtn) applyFiltersBtn.addEventListener('click', applyFilters);
        if (resetFiltersBtn) resetFiltersBtn.addEventListener('click', resetFilters);

        if (dashboardTabs) {
            dashboardTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.getAttribute('data-tab');
                    switchDashboardTab(tabName);
                });
            });
        }

        if (addOpportunityBtn) addOpportunityBtn.addEventListener('click', () => showAdminModal());
        if (adminCancelBtn) adminCancelBtn.addEventListener('click', () => adminModal.style.display = 'none');
        if (adminOpportunityForm) adminOpportunityForm.addEventListener('submit', handleAdminFormSubmit);

        if (googleSignIn) googleSignIn.addEventListener('click', () => handleGoogleSignIn());
        if (googleSignUp) googleSignUp.addEventListener('click', () => handleGoogleSignIn());
        
        if (passwordResetLink) passwordResetLink.addEventListener('click', handlePasswordReset);
        
        if (detailsClose) detailsClose.addEventListener('click', closeOpportunityDetails);
        if (detailsSaveBtn) detailsSaveBtn.addEventListener('click', handleDetailsSave);

        if (adminFormat) {
            adminFormat.addEventListener('change', handleFormatChange);
        }

        if (checkDuplicateBtn) {
            checkDuplicateBtn.addEventListener('click', handleCheckDuplicate);
        }
        
        if (checkDuplicatesBtn) {
            checkDuplicatesBtn.addEventListener('click', checkAllDuplicates);
        }

        // Close modals when clicking outside
        window.addEventListener('click', (e) => {
            if (e.target === authModal) {
                authModal.style.display = 'none';
            }
            if (e.target === adminModal) {
                adminModal.style.display = 'none';
            }
            if (e.target === detailsModal) {
                closeOpportunityDetails();
            }
        });

        // Header scroll behavior
        window.addEventListener('scroll', () => {
            const currentScrollPosition = window.pageYOffset;
            
            if (window.innerWidth <= 768) {
                if (currentScrollPosition > lastScrollPosition && currentScrollPosition > 100) {
                    mainHeader.classList.add('hidden');
                } else {
                    mainHeader.classList.remove('hidden');
                }
            }
            
            lastScrollPosition = currentScrollPosition;
        });

        // Check auth state
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                if (loginBtn) loginBtn.style.display = 'none';
                if (signupBtn) signupBtn.style.display = 'none';
                if (logoutBtn) logoutBtn.style.display = 'block';
                
                document.querySelector('.nav-curator').style.display = 'list-item';
                
                try {
                    const adminStatus = await checkAdminStatus(user.uid);
                    isAdminUser = adminStatus.isAdmin;
                    
                    if (navAdmin) {
                        navAdmin.style.display = isAdminUser ? 'list-item' : 'none';
                        
                        if (isAdminUser) {
                            const roleBadge = adminStatus.role === ADMIN_ROLES.SUPER_ADMIN ? ' (Super Admin)' : ' (Admin)';
                            navAdmin.innerHTML = `Admin${roleBadge}`;
                        }
                    }
                } catch (error) {
                    console.error('Error checking admin status:', error);
                    isAdminUser = false;
                }
                
                initCuratorSystem();
                loadUserOpportunities(user.uid);
            } else {
                if (loginBtn) loginBtn.style.display = 'block';
                if (signupBtn) signupBtn.style.display = 'block';
                if (logoutBtn) logoutBtn.style.display = 'none';
                if (navAdmin) navAdmin.style.display = 'none';
                if (navCurator) navCurator.style.display = 'none';
                
                userOpportunities = {
                    pending: [],
                    completed: []
                };
                
                if (userOpportunitiesListener) {
                    userOpportunitiesListener();
                    userOpportunitiesListener = null;
                }
                
                if (dashboard) dashboard.style.display = 'none';
                if (adminPanel) adminPanel.style.display = 'none';
                if (document.getElementById('curatorProfile')) document.getElementById('curatorProfile').style.display = 'none';
                if (document.getElementById('leaderboardSection')) document.getElementById('leaderboardSection').style.display = 'none';
                
                setTimeout(() => {
                    showHome();
                    renderOpportunities();
                }, 100);
                
                isAdminUser = false;
            }
        });

        // Load opportunities from Firebase
       function loadOpportunitiesFromFirebase() {
    const opportunitiesRef = ref(database, 'opportunities');
    
    onValue(opportunitiesRef, (snapshot) => {
        const data = snapshot.val();
        allOpportunities = [];
        
        if (data) {
            for (const key in data) {
                allOpportunities.push({
                    id: key,
                    ...data[key]
                });
            }
            
            allOpportunities.forEach(opp => {
                if (!opp.field || (Array.isArray(opp.field) && opp.field.length === 0)) {
                    opp.field = ['any'];
                }
                 if (!opp.studentType) {
        opp.studentType = ['highschool', 'any'];
    }
            });
        }
        
        applyFilters();
        
        // ADD THESE LINES HERE:
        // Refresh curator stats and leaderboard when opportunities are loaded
        if (auth.currentUser) {
            loadCuratorStats();
            loadLeaderboard();
        }
        
        if (adminPanel && adminPanel.style.display === 'block') {
            renderAdminOpportunities();
        }
    });
}
     function initExpiredOpportunitiesFilter() {
    const filterExpiredBtn = document.getElementById('filterExpiredBtn');
    if (!filterExpiredBtn) return;
    
    let showExpiredOnly = false;
    let originalOpportunities = [...allOpportunities]; // Store original list
    
    filterExpiredBtn.addEventListener('click', function() {
        showExpiredOnly = !showExpiredOnly;
        
        if (showExpiredOnly) {
            // Show expired only
            this.innerHTML = '<i class="fas fa-list"></i> Show All';
            this.classList.remove('filter-expired-btn');
            this.classList.add('filter-all');
            
            // Filter to show only expired opportunities
            const filteredOpportunities = allOpportunities.filter(opp => {
                return isOpportunityExpired(opp.deadline);
            });
            
            // Update the admin table
            renderAdminOpportunities(filteredOpportunities);
            showNotification(`Showing ${filteredOpportunities.length} expired opportunities`);
            
        } else {
            // Show all opportunities
            this.innerHTML = '<i class="fas fa-hourglass-end"></i> Show Expired Only';
            this.classList.remove('filter-all');
            this.classList.add('filter-expired-btn');
            
            // Show all opportunities
            renderAdminOpportunities(allOpportunities);
            showNotification(`Showing all ${allOpportunities.length} opportunities`);
        }
    });
}
        // Render opportunities to the grid
 function renderAdminOpportunities(opportunitiesToRender = null) {
    if (!adminOpportunitiesList) return;
    
    // Use provided opportunities or default to allOpportunities
    const opportunities = opportunitiesToRender || allOpportunities;
    
    adminOpportunitiesList.innerHTML = '';
    
    if (opportunities.length === 0) {
        adminOpportunitiesList.innerHTML = `
            <tr>
                <td colspan="8" style="text-align: center; padding: 2rem;">
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <h3>No opportunities found</h3>
                        <p>No opportunities match the current filter</p>
                    </div>
                </td>
            </tr>
        `;
        return;
    }
    
    opportunities.forEach(async (opp) => {
        const timeRemaining = calculateTimeRemaining(opp.deadline);
        const canModify = await canUserModifyOpportunity(opp.id);
        const isOwnOpportunity = opp.addedBy === auth.currentUser?.uid;
        const isExpired = isOpportunityExpired(opp.deadline);
        
        const row = document.createElement('tr');
        if (isExpired) {
            row.style.backgroundColor = '#fff5f5';
            row.style.borderLeft = '4px solid var(--danger)';
        }
        
        row.innerHTML = `
            <td>${opp.title || 'Untitled'}
                ${isExpired ? 
                    '<span style="color: var(--danger); margin-left: 10px; font-size: 0.8rem; font-weight: 600;">(EXPIRED)</span>' : 
                    ''}
            </td>
            <td>${opp.organization || 'Unknown'}</td>
            <td>${getOpportunityTypeText(opp.type)}</td>
            <td>${getFormatText(opp.format)}</td>
            <td>${formatDate(opp.deadline)} 
                ${isExpired ? 
                    '<span class="time-remaining" style="background-color: var(--danger);">Expired</span>' : 
                    `<span class="time-remaining ${timeRemaining.class}">${timeRemaining.text}</span>`
                }
            </td>
            <td>${opp.addedByName || 'Unknown'}</td>
            <td>
                ${isOwnOpportunity ? 
                    '<span style="color: var(--success); font-weight: 600;">You</span>' : 
                    '<span style="color: var(--gray);">Other</span>'}
            </td>
            <td class="admin-actions-cell">
                <button class="admin-btn edit-btn" data-id="${opp.id}" 
                    ${!canModify && !isOwnOpportunity ? 'disabled' : ''}
                    title="${!canModify && !isOwnOpportunity ? 'Can only edit your own opportunities' : 'Edit'}"
                    style="${!canModify && !isOwnOpportunity ? 'opacity: 0.5; cursor: not-allowed;' : ''}">
                    <i class="fas fa-edit"></i> Edit
                </button>
                <button class="admin-btn delete-btn" data-id="${opp.id}" 
                    ${!canModify && !isOwnOpportunity ? 'disabled' : ''}
                    title="${!canModify && !isOwnOpportunity ? 'Can only delete your own opportunities' : 'Delete'}"
                    style="${!canModify && !isOwnOpportunity ? 'opacity: 0.5; cursor: not-allowed;' : ''}">
                    <i class="fas fa-trash"></i> Delete
                </button>
            </td>
        `;
        
        adminOpportunitiesList.appendChild(row);
        
        const editButton = row.querySelector('.edit-btn');
        editButton.addEventListener('click', function() {
            if (this.disabled) {
                showNotification('You can only edit opportunities that you created', 'warning');
                return;
            }
            const oppId = this.getAttribute('data-id');
            const opportunity = allOpportunities.find(opp => opp.id === oppId);
            showAdminModal(opportunity);
        });
        
        const deleteButton = row.querySelector('.delete-btn');
        deleteButton.addEventListener('click', function() {
            if (this.disabled) {
                showNotification('You can only delete opportunities that you created', 'warning');
                return;
            }
            const oppId = this.getAttribute('data-id');
            if (confirm('Are you sure you want to delete this opportunity?\n\nThis action cannot be undone.')) {
                deleteOpportunity(oppId);
            }
        });
    });
}
        function isOpportunityExpired(deadline) {
    if (!deadline) return false;
    
    try {
        // Set time to end of day for the deadline
        const today = new Date();
        today.setHours(23, 59, 59, 999);
        
        const deadlineDate = new Date(deadline);
        deadlineDate.setHours(23, 59, 59, 999);
        
        return deadlineDate < today;
    } catch (e) {
        console.error('Error checking expiration:', e);
        return false;
    }
}
        function showOpportunityDetails(opportunity) {
            const detailsModal = document.getElementById('detailsModal');
            const detailsTitle = document.getElementById('detailsTitle');
            const detailsDescription = document.getElementById('detailsDescription');
            const detailsOrganization = document.getElementById('detailsOrganization');
            const detailsType = document.getElementById('detailsType');
            const detailsField = document.getElementById('detailsField');
            const detailsLocation = document.getElementById('detailsLocation');
            const detailsDeadline = document.getElementById('detailsDeadline');
            const detailsAdditionalInfo = document.getElementById('detailsAdditionalInfo');
            const detailsApplyLink = document.getElementById('detailsApplyLink');
            const detailsSaveBtn = document.getElementById('detailsSaveBtn');
            
            if (!detailsModal) return;
            
            detailsTitle.textContent = opportunity.title || 'No title';
            detailsDescription.textContent = opportunity.description || 'No description available';
            detailsOrganization.textContent = opportunity.organization || 'Unknown organization';
            detailsType.textContent = getOpportunityTypeText(opportunity.type);
            detailsField.textContent = getFieldText(opportunity.field);
            
            if (opportunity.format === 'online') {
                detailsLocation.textContent = 'Online';
            } else {
                detailsLocation.textContent = opportunity.location || 'Not specified';
            }
            
            detailsDeadline.textContent = formatDate(opportunity.deadline);
            detailsApplyLink.href = opportunity.applyLink || '#';
            
            let additionalInfo = '';
            if (opportunity.format) {
                additionalInfo += `<p><strong>Format:</strong> ${getFormatText(opportunity.format)}</p>`;
            }
            if (opportunity.studentType) {
    additionalInfo += `<p><strong>Student Level:</strong> ${getStudentTypeText(opportunity.studentType)}</p>`;
}
            if (opportunity.timeCommitment) {
                additionalInfo += `<p><strong>Time Commitment:</strong> ${opportunity.timeCommitment}</p>`;
            }
            if (opportunity.duration) {
                additionalInfo += `<p><strong>Duration:</strong> ${opportunity.duration}</p>`;
            }
            if (opportunity.language) {
                additionalInfo += `<p><strong>Language:</strong> ${opportunity.language}</p>`;
            }
            if (opportunity.ageRestrictions) {
                additionalInfo += `<p><strong>Age Restrictions:</strong> ${opportunity.ageRestrictions}</p>`;
            }
            if (opportunity.addedByName) {
                additionalInfo += `<p><strong>Added by:</strong> ${opportunity.addedByName}</p>`;
            }
            document.getElementById('detailsAgeRestrictions').textContent = opportunity.ageRestrictions || 'No age restrictions specified';
            detailsAdditionalInfo.innerHTML = additionalInfo || '<p>No additional information provided.</p>';
            
            const isSaved = userOpportunities.pending.some(item => item.id === opportunity.id) || 
                           userOpportunities.completed.some(item => item.id === opportunity.id);
            
            if (isSaved) {
                detailsSaveBtn.innerHTML = '<i class="fas fa-bookmark"></i> Remove from Dashboard';
                detailsSaveBtn.classList.add('saved');
            } else {
                detailsSaveBtn.innerHTML = '<i class="far fa-bookmark"></i> Save to Dashboard';
                detailsSaveBtn.classList.remove('saved');
            }
            
            currentOpportunityDetails = opportunity;
            
            detailsModal.classList.add('show');
        }

        function closeOpportunityDetails() {
            const detailsModal = document.getElementById('detailsModal');
            if (detailsModal) {
                detailsModal.classList.remove('show');
            }
        }

        function handleDetailsSave() {
            const user = auth.currentUser;
            if (user && currentOpportunityDetails) {
                if (detailsSaveBtn.classList.contains('saved')) {
                    removeOpportunity(user.uid, currentOpportunityDetails);
                } else {
                    saveOpportunity(user.uid, currentOpportunityDetails);
                }
            } else {
                showAuthModal('login');
                showNotification('Please sign in to save opportunities', 'warning');
            }
        }

        function showAuthModal(tab) {
            if (!authModal) return;
            authModal.style.display = 'flex';
            switchAuthTab(tab);
        }

        function switchAuthTab(tabName) {
            if (!authTabs || !loginForm || !signupForm) return;
            
            authTabs.forEach(tab => {
                if (tab.getAttribute('data-tab') === tabName) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
            
            if (tabName === 'login') {
                loginForm.classList.add('active');
                signupForm.classList.remove('active');
            } else {
                loginForm.classList.remove('active');
                signupForm.classList.add('active');
            }
            
            if (loginError) loginError.style.display = 'none';
            if (signupError) signupError.style.display = 'none';
        }

        function handleFormatChange() {
            const format = adminFormat.value;
            const locationInput = document.getElementById('adminLocation');
            
            if (format === 'online') {
                locationFieldGroup.style.display = 'none';
                locationInput.required = false;
                locationInput.value = 'Online';
            } else {
                locationFieldGroup.style.display = 'block';
                locationInput.required = true;
                if (locationInput.value === 'Online') {
                    locationInput.value = '';
                }
            }
        }

        function handleLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                if (loginError) {
                    loginError.textContent = 'Please enter both email and password';
                    loginError.style.display = 'block';
                }
                return;
            }
            
            signInWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    if (authModal) authModal.style.display = 'none';
                    showNotification('Successfully logged in!');
                })
                .catch((error) => {
                    if (loginError) {
                        let errorMessage = error.message;
                        if (error.code === 'auth/invalid-email') {
                            errorMessage = 'Invalid email address format';
                        } else if (error.code === 'auth/user-not-found') {
                            errorMessage = 'No account found with this email';
                        } else if (error.code === 'auth/wrong-password') {
                            errorMessage = 'Incorrect password';
                        } else if (error.code === 'auth/invalid-credential') {
                            errorMessage = 'Invalid credentials';
                        }
                        loginError.textContent = errorMessage;
                        loginError.style.display = 'block';
                    }
                });
        }

        function handleSignup() {
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const confirm = document.getElementById('signupConfirm').value;
            
            if (!name || !email || !password || !confirm) {
                if (signupError) {
                    signupError.textContent = 'Please fill in all fields';
                    signupError.style.display = 'block';
                }
                return;
            }
            
            if (password !== confirm) {
                if (signupError) {
                    signupError.textContent = 'Passwords do not match';
                    signupError.style.display = 'block';
                }
                return;
            }
            
            if (password.length < 6) {
                if (signupError) {
                    signupError.textContent = 'Password should be at least 6 characters';
                    signupError.style.display = 'block';
                }
                return;
            }
            
            createUserWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    
                    set(ref(database, 'users/' + user.uid), {
                        name: name,
                        email: email,
                        createdAt: new Date().toISOString()
                    });

                    if (authModal) authModal.style.display = 'none';
                    showNotification('Account created successfully!');
                })
                .catch((error) => {
                    if (signupError) {
                        let errorMessage = error.message;
                        if (error.code === 'auth/email-already-in-use') {
                            errorMessage = 'An account with this email already exists';
                        } else if (error.code === 'auth/invalid-email') {
                            errorMessage = 'Invalid email address format';
                        } else if (error.code === 'auth/weak-password') {
                            errorMessage = 'Password is too weak';
                        }
                        signupError.textContent = errorMessage;
                        signupError.style.display = 'block';
                    }
                });
        }

        function handleGoogleSignIn() {
            signInWithPopup(auth, googleProvider)
                .then((result) => {
                    const user = result.user;
                    
                    const userRef = ref(database, 'users/' + user.uid);
                    
                    get(userRef).then((snapshot) => {
                        if (!snapshot.exists()) {
                            set(userRef, {
                                name: user.displayName,
                                email: user.email,
                                createdAt: new Date().toISOString(),
                                isGoogleUser: true
                            });
                        }
                        
                        if (authModal) authModal.style.display = 'none';
                        showNotification('Successfully signed in with Google!');
                    });
                })
                .catch((error) => {
                    const currentTab = document.querySelector('.auth-tab.active').getAttribute('data-tab');
                    if (currentTab === 'login' && loginError) {
                        loginError.textContent = error.message;
                        loginError.style.display = 'block';
                    } else if (currentTab === 'signup' && signupError) {
                        signupError.textContent = error.message;
                        signupError.style.display = 'block';
                    }
                });
        }

        async function handlePasswordReset() {
            const email = document.getElementById('loginEmail').value;
            
            if (!email) {
                showNotification('Please enter your email address first', 'warning');
                return;
            }
            
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                if (loginError) {
                    loginError.textContent = 'Please enter a valid email address';
                    loginError.style.display = 'block';
                }
                return;
            }
            
            try {
                const emailExists = await checkEmailExists(email);
                
                if (!emailExists) {
                    if (loginError) {
                        loginError.textContent = 'This email is not registered with us';
                        loginError.style.display = 'block';
                    }
                    return;
                }
                
                await sendPasswordResetEmail(auth, email);
                showNotification('Password reset email sent. Check your inbox or spam folder.', 'success');
                
                if (loginError) {
                    loginError.style.display = 'none';
                }
            } catch (error) {
                console.error('Password reset error:', error);
                if (loginError) {
                    loginError.textContent = error.message;
                    loginError.style.display = 'block';
                }
            }
        }

        async function checkEmailExists(email) {
            try {
                const signInMethods = await fetchSignInMethodsForEmail(auth, email);
                return signInMethods.length > 0;
            } catch (error) {
                console.error('Error checking email:', error);
                return false;
            }
        }

        function handleLogout() {
            if (userOpportunitiesListener) {
                userOpportunitiesListener();
                userOpportunitiesListener = null;
            }
            
            userOpportunities = {
                pending: [],
                completed: []
            };
            
            signOut(auth)
                .then(() => {
                    showNotification('Successfully logged out');
                })
                .catch((error) => {
                    console.error('Logout error:', error);
                });
        }

       function saveOpportunity(userId, opportunity) {
    const userOppRef = ref(database, `userOpportunities/${userId}/${opportunity.id}`);
    
    const alreadySaved = userOpportunities.pending.some(opp => opp.id === opportunity.id) || 
                        userOpportunities.completed.some(opp => opp.id === opportunity.id);
    
    if (alreadySaved) {
        showNotification('This opportunity is already in your dashboard!', 'warning');
        return;
    }
    
    set(userOppRef, {
        opportunityId: opportunity.id,
        savedAt: new Date().toISOString(),
        status: 'pending'
    })
    .then(() => {
        showNotification('Opportunity saved to your dashboard!');
        
        // ADD THIS LINE HERE:
        updateCuratorStatsOnSave(opportunity.id, userId);
        
        if (currentOpportunityDetails && currentOpportunityDetails.id === opportunity.id) {
            const detailsSaveBtn = document.getElementById('detailsSaveBtn');
            if (detailsSaveBtn) {
                detailsSaveBtn.innerHTML = '<i class="fas fa-bookmark"></i> Remove from Dashboard';
                detailsSaveBtn.classList.add('saved');
            }
        }
    })
    .catch((error) => {
        console.error('Error saving opportunity:', error);
    });
}

        function removeOpportunity(userId, opportunity) {
            const userOppRef = ref(database, `userOpportunities/${userId}/${opportunity.id}`);
            
            remove(userOppRef)
            .then(() => {
                showNotification('Opportunity removed from your dashboard');
                
                if (currentOpportunityDetails && currentOpportunityDetails.id === opportunity.id) {
                    const detailsSaveBtn = document.getElementById('detailsSaveBtn');
                    if (detailsSaveBtn) {
                        detailsSaveBtn.innerHTML = '<i class="far fa-bookmark"></i> Save to Dashboard';
                        detailsSaveBtn.classList.remove('saved');
                    }
                }
            })
            .catch((error) => {
                console.error('Error removing opportunity:', error);
            });
        }

        function loadUserOpportunities(userId) {
            if (userOpportunitiesListener) {
                userOpportunitiesListener();
            }
            
            const userOppRef = ref(database, `userOpportunities/${userId}`);
            
            userOpportunitiesListener = onValue(userOppRef, (snapshot) => {
                const data = snapshot.val();
                
                userOpportunities.pending = [];
                userOpportunities.completed = [];
                
                if (data) {
                    const opportunityMap = {};
                    allOpportunities.forEach(opp => {
                        opportunityMap[opp.id] = opp;
                    });
                    
                    for (const key in data) {
                        const savedOpp = data[key];
                        const opportunityId = savedOpp.opportunityId || key;
                        const fullOpportunity = opportunityMap[opportunityId];
                        
                        if (fullOpportunity) {
                            const opportunityWithStatus = {
                                ...fullOpportunity,
                                savedAt: savedOpp.savedAt,
                                status: savedOpp.status || 'pending'
                            };
                            
                            if (savedOpp.status === 'completed') {
                                userOpportunities.completed.push(opportunityWithStatus);
                            } else {
                                userOpportunities.pending.push(opportunityWithStatus);
                            }
                        }
                    }
                }
                
                renderOpportunities();
                renderDashboardOpportunities();
            });
        }

        function renderDashboardOpportunities() {
            if (pendingOpportunities) {
                if (userOpportunities.pending.length === 0) {
                    pendingOpportunities.innerHTML = `
                        <div class="empty-state">
                            <i class="far fa-bookmark"></i>
                            <h3>No pending opportunities</h3>
                            <p>Save opportunities to your dashboard to track them here</p>
                        </div>
                    `;
                } else {
                    pendingOpportunities.innerHTML = '';
                    userOpportunities.pending.forEach(opp => {
                        const oppElement = createDashboardOpportunityElement(opp, 'pending');
                        pendingOpportunities.appendChild(oppElement);
                    });
                }
            }
            
            if (completedOpportunities) {
                if (userOpportunities.completed.length === 0) {
                    completedOpportunities.innerHTML = `
                        <div class="empty-state">
                            <i class="far fa-check-circle"></i>
                            <h3>No completed opportunities</h3>
                            <p>Mark opportunities as complete to track your achievements</p>
                        </div>
                    `;
                } else {
                    completedOpportunities.innerHTML = '';
                    userOpportunities.completed.forEach(opp => {
                        const oppElement = createDashboardOpportunityElement(opp, 'completed');
                        completedOpportunities.appendChild(oppElement);
                    });
                }
            }
        }

  function createDashboardOpportunityElement(opportunity, status) {
    const isExpired = isOpportunityExpired(opportunity.deadline);
    const isUrgent = isDeadlineUrgent(opportunity.deadline);
    const timeRemaining = calculateTimeRemaining(opportunity.deadline);
    
    const element = document.createElement('div');
    element.className = `opportunity-card ${isExpired ? 'expired' : ''}`;
    
    // Show more description in dashboard (250 characters instead of 150)
    const truncatedDescription = opportunity.description ? 
        (opportunity.description.length > 250 ? 
            opportunity.description.substring(0, 250) + '...' : 
            opportunity.description) : 
        'No description available';
    
    element.innerHTML = `
        <div class="card-header">
            <span class="opportunity-badge type-badge">${getOpportunityTypeText(opportunity.type)}</span>
            <span class="opportunity-badge field-badge">${getFieldText(opportunity.field)}</span>
            ${getFormatBadge(opportunity.format)}
            <h3 class="dashboard-card-title">${opportunity.title || 'Untitled Opportunity'}</h3>
            <p class="organization">${opportunity.organization || 'Unknown Organization'}</p>
        </div>
        
        <div class="card-body">
            <div class="detail">
                <i class="fas fa-calendar-alt"></i>
                <span class="deadline ${isUrgent ? 'urgent' : ''}">Deadline: ${formatDate(opportunity.deadline)} 
                    <span class="time-remaining ${timeRemaining.class}">${timeRemaining.text}</span>
                </span>
            </div>
            <div class="description-container">
                ${truncatedDescription}
            </div>
        </div>
        
        <div class="card-footer">
            <div class="card-actions">
                <div class="left-actions">
                    <button class="save-btn saved" data-id="${opportunity.id}" title="Remove from dashboard">
                        <i class="fas fa-bookmark"></i>
                    </button>
                </div>
                <div class="right-actions">
                    <button class="details-btn" data-id="${opportunity.id}">View Details</button>
                    <a href="${opportunity.applyLink || '#'}" target="_blank" class="apply-link">Apply Now</a>
                    ${status === 'pending' ? 
                    `<button class="apply-link complete-btn" data-id="${opportunity.id}">Mark as Complete</button>` : 
                    `<span class="completed-badge">Completed</span>`}
                </div>
            </div>
        </div>
    `;
            
            const removeBtn = element.querySelector('.save-btn');
            removeBtn.addEventListener('click', function() {
                const user = auth.currentUser;
                if (user) {
                    removeOpportunity(user.uid, opportunity);
                }
            });
            
            const detailsBtn = element.querySelector('.details-btn');
            detailsBtn.addEventListener('click', function() {
                showOpportunityDetails(opportunity);
            });
            
            if (status === 'pending') {
                const completeBtn = element.querySelector('.complete-btn');
                completeBtn.addEventListener('click', function() {
                    const user = auth.currentUser;
                    if (user) {
                        markAsComplete(user.uid, opportunity);
                    }
                });
            }
            
            return element;
        }

        function markAsComplete(userId, opportunity) {
            const userOppRef = ref(database, `userOpportunities/${userId}/${opportunity.id}`);
            update(userOppRef, {
                status: 'completed',
                completedAt: new Date().toISOString()
            })
            .then(() => showNotification('Opportunity marked as complete!'))
            .catch((error) => console.error('Error updating opportunity:', error));
        }

  function applyFilters() {
    const selectedFields = fieldMultiSelect.getSelected();
    const selectedTypes = typeMultiSelect.getSelected();
    const selectedStudentTypes = studentTypeMultiSelect.getSelected();
    const formatFilter = document.getElementById('format').value;
    const deadlineFilter = document.getElementById('deadline').value;
    const languageFilter = document.getElementById('language').value;
    const searchTerm = searchInput.value.toLowerCase();
    
    // Get all opportunities first
    let tempFiltered = allOpportunities.filter(opp => {
        // Search filter
        if (searchTerm) {
            const titleMatch = opp.title.toLowerCase().includes(searchTerm);
            const orgMatch = opp.organization.toLowerCase().includes(searchTerm);
            const descMatch = opp.description.toLowerCase().includes(searchTerm);
            if (!titleMatch && !orgMatch && !descMatch) return false;
        }
        
        // Field filter
        if (selectedFields.length > 0) {
            const oppFields = Array.isArray(opp.field) ? opp.field : [opp.field];
            const hasAnyField = oppFields.includes('any');
            const hasMatchingField = oppFields.some(field => selectedFields.includes(field));
            
            if (!hasAnyField && !hasMatchingField) return false;
        }
        
        // Type filter
        if (selectedTypes.length > 0) {
            const oppTypes = Array.isArray(opp.type) ? opp.type : [opp.type];
            const hasMatchingType = oppTypes.some(type => selectedTypes.includes(type));
            if (!hasMatchingType) return false;
        }
        
        // Student Type filter
        if (selectedStudentTypes.length > 0) {
            const oppStudentTypes = Array.isArray(opp.studentType) ? opp.studentType : [opp.studentType || 'highschool'];
            const hasAnyStudentType = oppStudentTypes.includes('any');
            const hasMatchingStudentType = oppStudentTypes.some(type => selectedStudentTypes.includes(type));
            
            if (!hasAnyStudentType && !hasMatchingStudentType) return false;
        }
        
        // Format filter
        if (formatFilter && opp.format !== formatFilter) return false;
        
        // Language filter
        if (languageFilter && opp.language !== languageFilter) return false;
        
        // Deadline filter
        if (deadlineFilter && opp.deadline) {
            const today = new Date();
            const deadlineDate = new Date(opp.deadline);
            const diffTime = deadlineDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            switch(deadlineFilter) {
                case 'week':
                    if (diffDays > 7 || diffDays < 0) return false;
                    break;
                case 'month':
                    if (diffDays > 30 || diffDays < 0) return false;
                    break;
                case '3months':
                    if (diffDays > 90 || diffDays < 0) return false;
                    break;
            }
        }
        
        return true;
    });
    
    // REMOVE EXPIRED OPPORTUNITIES FROM MAIN VIEW
    // Only show expired opportunities if explicitly filtered
    if (deadlineFilter !== 'expired') {
        tempFiltered = tempFiltered.filter(opp => !isOpportunityExpired(opp.deadline));
    }
    
    filteredOpportunities = tempFiltered;
    renderOpportunities();
    showNotification(`Found ${filteredOpportunities.length} opportunities matching your filters`);
}
function renderOpportunities() {
    if (!opportunitiesGrid) return;
    
    // FILTER OUT EXPIRED OPPORTUNITIES HERE
    const nonExpiredOpportunities = filteredOpportunities.filter(opp => !isOpportunityExpired(opp.deadline));
    
    if (nonExpiredOpportunities.length === 0) {
        opportunitiesGrid.innerHTML = `
            <div class="no-results">
                <i class="fas fa-search"></i>
                <h3>No active opportunities found</h3>
                <p>${filteredOpportunities.length > 0 ? 
                    'All matching opportunities have expired. Try adjusting your filters.' : 
                    'Try adjusting your filters or search terms'}</p>
            </div>
        `;
        return;
    }
    
    opportunitiesGrid.innerHTML = '';
    
    nonExpiredOpportunities.forEach((opportunity) => {
        const isExpired = isOpportunityExpired(opportunity.deadline);
        const isUrgent = isDeadlineUrgent(opportunity.deadline);
        const timeRemaining = calculateTimeRemaining(opportunity.deadline);
        
        // Check if saved
        const isSaved = userOpportunities.pending.some(item => item.id === opportunity.id) || 
                       userOpportunities.completed.some(item => item.id === opportunity.id);
        
        const oppElement = document.createElement('div');
        oppElement.className = `opportunity-card ${isExpired ? 'expired' : ''}`;
        
        oppElement.innerHTML = `
            <div class="card-header">
                <span class="opportunity-badge type-badge">${getOpportunityTypeText(opportunity.type)}</span>
                <span class="opportunity-badge field-badge">${getFieldText(opportunity.field)}</span>
                <span class="opportunity-badge level-badge">${getStudentTypeText(opportunity.studentType)}</span>
                ${getFormatBadge(opportunity.format)}
                <h3>${opportunity.title || 'Untitled Opportunity'}</h3>
                <p class="organization">${opportunity.organization || 'Unknown Organization'}</p>
            </div>
            
            <div class="card-body">
                <div class="detail">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>${opportunity.format === 'online' ? 'Online' : (opportunity.location || 'Location not specified')}</span>
                </div>
                
                <div class="detail">
                    <i class="fas fa-calendar-alt"></i>
                    <span class="deadline ${isUrgent ? 'urgent' : ''}">Deadline: ${formatDate(opportunity.deadline)} 
                        ${timeRemaining.text !== 'No deadline' ? 
                            `<span class="time-remaining ${timeRemaining.class}">${timeRemaining.text}</span>` : 
                            ''}
                    </span>
                </div>
                
                ${opportunity.timeCommitment ? `
                <div class="detail">
                    <i class="fas fa-clock"></i>
                    <span>Time commitment: ${opportunity.timeCommitment}</span>
                </div>
                ` : ''}
                
                ${opportunity.duration ? `
                <div class="detail">
                    <i class="fas fa-calendar-day"></i>
                    <span>Duration: ${opportunity.duration}</span>
                </div>
                ` : ''}
                
                ${opportunity.language ? `
                <div class="detail">
                    <i class="fas fa-language"></i>
                    <span>Language: ${opportunity.language}</span>
                </div>
                ` : ''}
                
                <p>${opportunity.description ? (opportunity.description.substring(0, 150) + '...') : 'No description available'}</p>
            </div>
            
            <div class="card-footer">
                <div class="card-actions">
                    <div class="left-actions">
                        <button class="save-btn ${isSaved ? 'saved' : ''}" data-id="${opportunity.id}" title="${isSaved ? 'Remove from dashboard' : 'Save to dashboard'}">
                            <i class="${isSaved ? 'fas' : 'far'} fa-bookmark"></i>
                        </button>
                    </div>
                    <div class="right-actions">
                        <button class="details-btn" data-id="${opportunity.id}">View Details</button>
                        <a href="${opportunity.applyLink || '#'}" target="_blank" class="apply-link">Apply Now</a>
                    </div>
                </div>
            </div>
        `;
        
        opportunitiesGrid.appendChild(oppElement);
        
        // Add event listeners
        const saveBtn = oppElement.querySelector('.save-btn');
        saveBtn.addEventListener('click', function() {
            const user = auth.currentUser;
            if (user) {
                if (isSaved) {
                    removeOpportunity(user.uid, opportunity);
                } else {
                    saveOpportunity(user.uid, opportunity);
                }
            } else {
                showAuthModal('login');
                showNotification('Please sign in to save opportunities', 'warning');
            }
        });
        
        const detailsBtn = oppElement.querySelector('.details-btn');
        detailsBtn.addEventListener('click', function() {
            showOpportunityDetails(opportunity);
        });
    });
}
function resetApplicationUI() {
    const joinCommunityBtn = document.getElementById('joinCommunityBtn');
    const applicationStatus = document.getElementById('applicationStatus');
    
    if (joinCommunityBtn) {
        joinCommunityBtn.style.display = 'none';
    }
    
    if (applicationStatus) {
        applicationStatus.style.display = 'none';
    }
}
        function applySearchFilter() {
            applyFilters();
        }

function resetFilters() {
    fieldMultiSelect.clear();
    typeMultiSelect.clear();
    studentTypeMultiSelect.clear(); // ADD THIS
    document.getElementById('format').value = '';
    document.getElementById('deadline').value = '';
    document.getElementById('language').value = '';
    if (searchInput) searchInput.value = '';
    
    filteredOpportunities = [...allOpportunities];
    renderOpportunities();
    showNotification('Filters reset');
}

        function showDashboard() {
            const user = auth.currentUser;
            if (user) {
                if (heroSection) heroSection.style.display = 'none';
                if (filtersSection) filtersSection.style.display = 'none';
                if (opportunitiesTitle) opportunitiesTitle.style.display = 'none';
                if (opportunitiesGrid) opportunitiesGrid.style.display = 'none';
                if (adminPanel) adminPanel.style.display = 'none';
                if (dashboard) dashboard.style.display = 'block';
                if (document.getElementById('curatorProfile')) document.getElementById('curatorProfile').style.display = 'none';
                if (document.getElementById('leaderboardSection')) document.getElementById('leaderboardSection').style.display = 'none';
            } else {
                showAuthModal('login');
                showNotification('Please sign in to view your dashboard', 'warning');
            }
        }

        function showHome() {
            if (heroSection) heroSection.style.display = 'block';
            if (filtersSection) filtersSection.style.display = 'block';
            if (opportunitiesTitle) opportunitiesTitle.style.display = 'block';
            if (opportunitiesGrid) opportunitiesGrid.style.display = 'grid';
            if (dashboard) dashboard.style.display = 'none';
            if (adminPanel) adminPanel.style.display = 'none';
            if (document.getElementById('curatorProfile')) document.getElementById('curatorProfile').style.display = 'none';
            if (document.getElementById('leaderboardSection')) document.getElementById('leaderboardSection').style.display = 'none';
        }

       function showOpportunities() {
    if (heroSection) heroSection.style.display = 'block';
    if (filtersSection) filtersSection.style.display = 'block';
    if (opportunitiesTitle) opportunitiesTitle.style.display = 'block';
    if (opportunitiesGrid) opportunitiesGrid.style.display = 'grid';
    if (dashboard) dashboard.style.display = 'none';
    if (adminPanel) adminPanel.style.display = 'none';
    if (document.getElementById('curatorProfile')) document.getElementById('curatorProfile').style.display = 'none';
    if (document.getElementById('leaderboardSection')) document.getElementById('leaderboardSection').style.display = 'none';
}
// Updated showAdminPanel function
function showAdminPanel() {
    const user = auth.currentUser;
    if (user) {
        checkAdminStatus(user.uid).then(adminStatus => {
            if (adminStatus.isAdmin) {
                if (heroSection) heroSection.style.display = 'none';
                if (filtersSection) filtersSection.style.display = 'none';
                if (opportunitiesTitle) opportunitiesTitle.style.display = 'none';
                if (opportunitiesGrid) opportunitiesGrid.style.display = 'none';
                if (dashboard) dashboard.style.display = 'none';
                if (adminPanel) adminPanel.style.display = 'block';
                if (document.getElementById('curatorProfile')) document.getElementById('curatorProfile').style.display = 'none';
                if (document.getElementById('leaderboardSection')) document.getElementById('leaderboardSection').style.display = 'none';
                
                renderAdminOpportunities();
                
                // FIX: Initialize application management for super admins
                initApplicationManagement();
            } else {
                showNotification('Access denied. Admin privileges required.', 'error');
            }
        });
    } else {
        showNotification('Please sign in to access admin panel', 'warning');
    }
}

        function switchDashboardTab(tabName) {
            if (!dashboardTabs) return;
            
            dashboardTabs.forEach(tab => {
                if (tab.getAttribute('data-tab') === tabName) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
            
            if (tabName === 'pending') {
                document.getElementById('pendingContent').classList.add('active');
                document.getElementById('completedContent').classList.remove('active');
            } else {
                document.getElementById('pendingContent').classList.remove('active');
                document.getElementById('completedContent').classList.add('active');
            }
        }

        function showAdminModal(opportunity = null) {
            if (!adminModal) return;
            
            const user = auth.currentUser;
            if (!user) {
                showNotification('Please sign in to access admin features', 'warning');
                return;
            }
            
            if (!isAdminUser) {
                showNotification('Access denied. Admin privileges required.', 'error');
                return;
            }
            
            if (opportunity) {
                adminModalTitle.textContent = 'Edit Opportunity';
                document.getElementById('opportunityId').value = opportunity.id;
                document.getElementById('adminTitle').value = opportunity.title;
                document.getElementById('adminOrganization').value = opportunity.organization;
                adminTypeMultiSelect.setSelected(opportunity.type);
                adminFieldMultiSelect.setSelected(opportunity.field);
                 adminStudentTypeMultiSelect.setSelected(opportunity.studentType || ['highschool', 'any']);
                document.getElementById('adminFormat').value = opportunity.format;
                document.getElementById('adminDescription').value = opportunity.description;
                document.getElementById('adminLocation').value = opportunity.location;
                document.getElementById('adminDeadline').value = opportunity.deadline;
                document.getElementById('adminApplyLink').value = opportunity.applyLink;
                document.getElementById('adminTimeCommitment').value = opportunity.timeCommitment || '';
                document.getElementById('adminDuration').value = opportunity.duration || '';
                document.getElementById('adminLanguage').value = opportunity.language || '';
                
                handleFormatChange();
            } else {
                adminModalTitle.textContent = 'Add New Opportunity';
                adminOpportunityForm.reset();
                document.getElementById('opportunityId').value = '';
                adminTypeMultiSelect.clear();
                adminFieldMultiSelect.setSelected(['any']);
                 adminStudentTypeMultiSelect.setSelected(opportunity.studentType || ['highschool', 'any']);
                
                handleFormatChange();
            }
            
            adminModal.style.display = 'flex';
        }

        function fuzzyMatch(str1, str2, threshold = 0.8) {
            if (!str1 || !str2) return 0;
            
            const longer = str1.length > str2.length ? str1 : str2;
            const shorter = str1.length > str2.length ? str2 : str1;
            
            if (longer.length === 0) return 1.0;
            
            const longerLower = longer.toLowerCase();
            const shorterLower = shorter.toLowerCase();
            
            if (longerLower.includes(shorterLower)) return 1.0;
            
            let matches = 0;
            for (let i = 0; i < shorterLower.length; i++) {
                if (longerLower.includes(shorterLower[i])) matches++;
            }
            
            return matches / longerLower.length;
        }

        async function checkForDuplicateOpportunity(opportunityData) {
            const opportunitiesRef = ref(database, 'opportunities');
            const snapshot = await get(opportunitiesRef);
            
            if (!snapshot.exists()) return { isDuplicate: false };
            
            const opportunities = snapshot.val();
            const duplicates = [];
            
            for (const key in opportunities) {
                const existingOpp = opportunities[key];
                let similarityScore = 0;
                let reason = "";
                
                const titleSimilarity = fuzzyMatch(existingOpp.title, opportunityData.title);
                const orgSimilarity = fuzzyMatch(existingOpp.organization, opportunityData.organization);
                
                if (existingOpp.applyLink === opportunityData.applyLink) {
                    duplicates.push({
                        existingOpportunity: existingOpp,
                        reason: "Exact same application link",
                        confidence: 100
                    });
                    continue;
                }
                
                if (titleSimilarity > 0.9 && orgSimilarity > 0.9) {
                    duplicates.push({
                        existingOpportunity: existingOpp,
                        reason: "Very similar title and organization",
                        confidence: Math.round((titleSimilarity + orgSimilarity) / 2 * 100)
                    });
                }
                else if (titleSimilarity > 0.85 && existingOpp.organization.toLowerCase() === opportunityData.organization.toLowerCase()) {
                    duplicates.push({
                        existingOpportunity: existingOpp,
                        reason: "Similar title with same organization",
                        confidence: Math.round(titleSimilarity * 100)
                    });
                }
            }
            
            if (duplicates.length > 0) {
                const bestMatch = duplicates.reduce((prev, current) => 
                    (prev.confidence > current.confidence) ? prev : current
                );
                
                return {
                    isDuplicate: true,
                    existingOpportunity: bestMatch.existingOpportunity,
                    reason: bestMatch.reason,
                    confidence: bestMatch.confidence,
                    allDuplicates: duplicates
                };
            }
            
            return { isDuplicate: false };
        }

        function showDuplicateWarning(duplicateCheck, newOpportunity) {
            const duplicateModal = document.createElement('div');
            duplicateModal.className = 'duplicate-warning-modal';
            duplicateModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
            `;
            
            duplicateModal.innerHTML = `
                <div class="duplicate-warning-content">
                    <h3><i class="fas fa-exclamation-triangle"></i> Possible Duplicate Found</h3>
                    <p><strong>Reason:</strong> ${duplicateCheck.reason}</p>
                    <p><strong>Confidence:</strong> ${duplicateCheck.confidence}% match</p>
                    
                    <div class="existing-opportunity-info">
                        <h4>Existing Opportunity:</h4>
                        <p><strong>Title:</strong> ${duplicateCheck.existingOpportunity.title}</p>
                        <p><strong>Organization:</strong> ${duplicateCheck.existingOpportunity.organization}</p>
                        <p><strong>Deadline:</strong> ${formatDate(duplicateCheck.existingOpportunity.deadline)}</p>
                        <p><strong>Added by:</strong> ${duplicateCheck.existingOpportunity.addedByName || 'Unknown'}</p>
                    </div>
                    
                    <div class="duplicate-warning-actions">
                        <button class="cancel-duplicate-btn" id="cancelDuplicate">
                            Cancel
                        </button>
                        <button class="view-existing-btn" id="viewExisting">
                            View Existing
                        </button>
                        <button class="force-add-btn" id="forceAdd">
                            Add Anyway
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(duplicateModal);
            
            let modalRemoved = false;
            
            function removeModal() {
                if (!modalRemoved && document.body.contains(duplicateModal)) {
                    document.body.removeChild(duplicateModal);
                    modalRemoved = true;
                }
            }
            
            document.getElementById('cancelDuplicate').addEventListener('click', () => {
                removeModal();
            });
            
            document.getElementById('viewExisting').addEventListener('click', () => {
                removeModal();
                closeAdminModal();
                
                const existingOpp = allOpportunities.find(opp => 
                    opp.id === duplicateCheck.existingOpportunity.id ||
                    (opp.title.toLowerCase() === duplicateCheck.existingOpportunity.title.toLowerCase() &&
                     opp.organization.toLowerCase() === duplicateCheck.existingOpportunity.organization.toLowerCase())
                );
                
                if (existingOpp) {
                    setTimeout(() => {
                        showOpportunityDetails(existingOpp);
                    }, 100);
                } else {
                    showNotification('Could not find the existing opportunity.', 'error');
                }
            });
            
            document.getElementById('forceAdd').addEventListener('click', () => {
                removeModal();
                saveOpportunityData(null, newOpportunity);
            });
            
            duplicateModal.addEventListener('click', (e) => {
                if (e.target === duplicateModal) {
                    removeModal();
                }
            });
        }

        function saveOpportunityData(opportunityId, opportunityData) {
            if (opportunityId) {
                update(ref(database, `opportunities/${opportunityId}`), opportunityData)
                    .then(() => {
                        adminModal.style.display = 'none';
                        showNotification('Opportunity updated successfully!');
                    })
                    .catch((error) => {
                        showNotification('Error updating opportunity: ' + error.message, 'error');
                    });
            } else {
                const newOpportunityRef = push(ref(database, 'opportunities'));
                set(newOpportunityRef, opportunityData)
                    .then(() => {
                        adminModal.style.display = 'none';
                        showNotification('Opportunity added successfully!');
                    })
                    .catch((error) => {
                        showNotification('Error adding opportunity: ' + error.message, 'error');
                    });
            }
        }

        async function checkAllDuplicates() {
            showNotification('Scanning for duplicates...', 'warning');
            
            const opportunitiesRef = ref(database, 'opportunities');
            const snapshot = await get(opportunitiesRef);
            
            if (!snapshot.exists()) {
                showNotification('No opportunities found to check.', 'warning');
                return;
            }
            
            const opportunities = snapshot.val();
            const opportunityList = Object.values(opportunities);
            const duplicates = [];
            
            for (let i = 0; i < opportunityList.length; i++) {
                for (let j = i + 1; j < opportunityList.length; j++) {
                    const opp1 = opportunityList[i];
                    const opp2 = opportunityList[j];
                    
                    const titleSimilarity = fuzzyMatch(opp1.title, opp2.title);
                    const orgSimilarity = fuzzyMatch(opp1.organization, opp2.organization);
                    
                    if ((titleSimilarity > 0.9 && orgSimilarity > 0.8) || opp1.applyLink === opp2.applyLink) {
                        duplicates.push({ 
                            opp1, 
                            opp2, 
                            similarity: Math.round(titleSimilarity * 100),
                            reason: opp1.applyLink === opp2.applyLink ? "Same application link" : "Similar title and organization"
                        });
                    }
                }
            }
            
            if (duplicates.length > 0) {
                showNotification(`Found ${duplicates.length} potential duplicate pairs`, 'warning');
                
                let report = `Duplicate Report (${new Date().toLocaleDateString()})\n\n`;
                report += `Found ${duplicates.length} potential duplicate pairs:\n\n`;
                
                duplicates.forEach((dup, index) => {
                    report += `${index + 1}. ${dup.reason} (${dup.similarity}% similarity)\n`;
                    report += `   - "${dup.opp1.title}" by ${dup.opp1.organization}\n`;
                    report += `   - "${dup.opp2.title}" by ${dup.opp2.organization}\n\n`;
                });
                
                alert(report);
            } else {
                showNotification('No duplicates found in the system!', 'success');
            }
        }

        async function handleCheckDuplicate() {
            const opportunityData = gatherFormData();
            
            if (!opportunityData.title || !opportunityData.organization) {
                showNotification('Please fill in at least the title and organization fields', 'warning');
                return;
            }
            
            const duplicateCheck = await checkForDuplicateOpportunity(opportunityData);
            
            if (duplicateCheck.isDuplicate) {
                showNotification(`Possible duplicate found: ${duplicateCheck.reason} (${duplicateCheck.confidence}% match)`, 'warning');
            } else {
                showNotification('No duplicates found. You can safely submit.', 'success');
            }
        }

    function gatherFormData() {
    const format = document.getElementById('adminFormat').value;
    let location = '';
    if (format === 'online') {
        location = 'Online';
    } else {
        location = document.getElementById('adminLocation').value;
    }
    
    return {
        title: document.getElementById('adminTitle').value.trim(),
        organization: document.getElementById('adminOrganization').value.trim(),
        type: adminTypeMultiSelect.getSelected(),
        field: adminFieldMultiSelect.getSelected(),
        // ADD THIS LINE:
        studentType: adminStudentTypeMultiSelect.getSelected(), 
        format: format,
        description: document.getElementById('adminDescription').value.trim(),
        location: location,
        deadline: document.getElementById('adminDeadline').value,
        applyLink: document.getElementById('adminApplyLink').value.trim(),
        timeCommitment: document.getElementById('adminTimeCommitment').value,
        duration: document.getElementById('adminDuration').value,
        language: document.getElementById('adminLanguage').value,
        ageRestrictions: document.getElementById('adminAgeRestrictions').value
    };
}

     async function handleAdminFormSubmit(e) {
    e.preventDefault();
    
    const user = auth.currentUser;
    if (!user || !isAdminUser) {
        showNotification('Admin privileges required.', 'error');
        return;
    }
    
    const opportunityId = document.getElementById('opportunityId').value;
    const opportunityData = gatherFormData();
    
    // FIX: Preserve original creator information when editing
    if (opportunityId) {
        // Editing existing opportunity - preserve original creator
        const originalOpportunity = allOpportunities.find(opp => opp.id === opportunityId);
        opportunityData.addedBy = originalOpportunity.addedBy;
        opportunityData.addedByName = originalOpportunity.addedByName;
        opportunityData.createdAt = originalOpportunity.createdAt;
    } else {
        // Creating new opportunity - set current user as creator
        opportunityData.addedBy = user.uid;
        opportunityData.addedByName = user.displayName || user.email;
        opportunityData.createdAt = new Date().toISOString();
    }
    
    opportunityData.updatedAt = new Date().toISOString();
    
    if (!opportunityId) {
        const duplicateCheck = await checkForDuplicateOpportunity(opportunityData);
        
        if (duplicateCheck.isDuplicate) {
            showDuplicateWarning(duplicateCheck, opportunityData);
            return;
        }
    }
    
    saveOpportunityData(opportunityId, opportunityData);
}
        function closeAdminModal() {
            if (adminModal) {
                adminModal.style.display = 'none';
            }
        }

        function deleteOpportunity(opportunityId) {
            const user = auth.currentUser;
            if (!user) {
                showNotification('Please sign in to access admin features', 'warning');
                return;
            }
            
            if (!isAdminUser) {
                showNotification('Access denied. Admin privileges required.', 'error');
                return;
            }
            
            if (confirm('Are you sure you want to delete this opportunity?')) {
                remove(ref(database, `opportunities/${opportunityId}`))
                    .then(() => {
                        showNotification('Opportunity deleted successfully!');
                    })
                    .catch((error) => {
                        showNotification('Error deleting opportunity: ' + error.message, 'error');
                    });
            }
        }

        
      async function checkAdminStatus(userId) {
    try {
        console.log('Checking admin status for user:', userId);
        
        const adminRef = ref(database, `admins/${userId}`);
        const snapshot = await get(adminRef);
        
        if (snapshot.exists()) {
            const adminData = snapshot.val();
            console.log('Admin data found:', adminData);
            
            return {
                isAdmin: true,
                role: adminData.role || ADMIN_ROLES.ADMIN,
                data: adminData
            };
        } else {
            console.log('No admin data found for user:', userId);
            return { 
                isAdmin: false, 
                role: null,
                data: null 
            };
        }
    } catch (error) {
        console.error('Error checking admin status:', error);
        
        // If it's a permission error, try a different approach
        if (error.code === 'PERMISSION_DENIED') {
            console.log('Permission denied for admin check, trying alternative method...');
            
            // Try to check if user can access admin features by testing a simple operation
            try {
                const testRef = ref(database, `admins`);
                const testSnapshot = await get(testRef);
                
                if (testSnapshot.exists()) {
                    const allAdmins = testSnapshot.val();
                    const isUserAdmin = allAdmins && allAdmins[userId];
                    
                    return {
                        isAdmin: !!isUserAdmin,
                        role: isUserAdmin ? (isUserAdmin.role || ADMIN_ROLES.ADMIN) : null,
                        data: isUserAdmin || null
                    };
                }
            } catch (secondError) {
                console.error('Alternative admin check also failed:', secondError);
            }
        }
        
        // Default to non-admin if we can't determine status
        return { 
            isAdmin: false, 
            role: null,
            data: null,
            error: error.message 
        };
    }
}
async function canUserModifyOpportunity(opportunityId) {
    const user = auth.currentUser;
    if (!user) return false;
    
    try {
        const adminStatus = await checkAdminStatus(user.uid);
        
        if (adminStatus.role === ADMIN_ROLES.SUPER_ADMIN) {
            return true; // Super admins can edit any opportunity
        }
        
        if (adminStatus.isAdmin) {
            // For regular admins, check if they created this opportunity
            const opportunityRef = ref(database, `opportunities/${opportunityId}`);
            const snapshot = await get(opportunityRef);
            
            if (snapshot.exists()) {
                const opportunity = snapshot.val();
                return opportunity.addedBy === user.uid;
            }
        }
        
        return false;
    } catch (error) {
        console.error('Error checking opportunity ownership:', error);
        return false;
    }
}
function initCommunityApplicationSystem() {
    const joinCommunityBtn = document.getElementById('joinCommunityBtn');
    const communityApplicationModal = document.getElementById('communityApplicationModal');
    const communityApplicationForm = document.getElementById('communityApplicationForm');
    const cancelApplicationBtn = document.getElementById('cancelApplicationBtn');

    // Event Listeners
    if (joinCommunityBtn) {
        joinCommunityBtn.addEventListener('click', () => {
            const user = auth.currentUser;
            if (!user) {
                showNotification('Please sign in to apply', 'warning');
                return;
            }
            communityApplicationModal.style.display = 'flex';
        });
    }

    if (cancelApplicationBtn) {
        cancelApplicationBtn.addEventListener('click', () => {
            communityApplicationModal.style.display = 'none';
        });
    }

    if (communityApplicationForm) {
        communityApplicationForm.addEventListener('submit', handleApplicationSubmit);
    }

    // Close modal when clicking outside
    window.addEventListener('click', (e) => {
        if (e.target === communityApplicationModal) {
            communityApplicationModal.style.display = 'none';
        }
    });

    // Check for existing application when user is logged in
    onAuthStateChanged(auth, (user) => {
        if (user) {
            console.log('User logged in, checking application status:', user.uid);
            checkExistingApplication(user.uid);
            
            // Set up real-time listener for application status changes
            setupApplicationStatusListener(user.uid);
        } else {
            // User is logged out, reset UI
            resetApplicationUI();
        }
    });
}
 function checkExistingApplication(userId) {
    console.log('Checking application for user:', userId);
    
    const applicationsRef = ref(database, 'community_applications');
    
    get(applicationsRef).then((snapshot) => {
        const applications = snapshot.val();
        let userApplication = null;
        
        if (applications) {
            for (const appId in applications) {
                const app = applications[appId];
                if (app.userId === userId) {
                    userApplication = { id: appId, ...app };
                    console.log('Found application:', userApplication);
                    break;
                }
            }
        }
        
        updateApplicationStatusUI(userApplication);
        
    }).catch((error) => {
        console.error('Error checking application:', error);
        // If there's a permission error, user can still see the apply button
        updateApplicationStatusUI(null);
    });
}

function updateApplicationStatusUI(application) {
    const joinCommunityBtn = document.getElementById('joinCommunityBtn');
    const applicationStatus = document.getElementById('applicationStatus');
    const statusText = document.getElementById('statusText');
    const statusMessage = document.getElementById('statusMessage');
    const user = auth.currentUser;
    
    if (!user) {
        resetApplicationUI();
        return;
    }
    
    // First check if user is already an admin
    checkAdminStatus(user.uid).then(adminStatus => {
        if (adminStatus.isAdmin) {
            // User is already an admin
            if (joinCommunityBtn) joinCommunityBtn.style.display = 'none';
            if (applicationStatus) {
                applicationStatus.style.display = 'block';
                statusText.textContent = 'You are already a curator';
                statusText.style.color = 'var(--success)';
                statusMessage.textContent = 'You have curator privileges and can manage opportunities.';
            }
            return;
        }
        
        // User is not an admin, handle application status
        if (!application) {
            // No application found - show apply button
            if (applicationStatus) applicationStatus.style.display = 'none';
            if (joinCommunityBtn) {
                joinCommunityBtn.style.display = 'block';
                joinCommunityBtn.disabled = false;
                joinCommunityBtn.innerHTML = '<i class="fas fa-handshake"></i> I Want to Become a Part of This Community';
                joinCommunityBtn.style.opacity = '1';
            }
            return;
        }
        
        // User has an application - show status
        if (applicationStatus) applicationStatus.style.display = 'block';
        
        switch(application.status) {
            case 'pending':
                statusText.textContent = 'Under Review';
                statusText.style.color = 'var(--warning)';
                statusMessage.textContent = 'Your application is being reviewed. We\'ll get back to you soon!';
                if (joinCommunityBtn) {
                    joinCommunityBtn.disabled = true;
                    joinCommunityBtn.innerHTML = '<i class="fas fa-clock"></i> Application Pending Review';
                    joinCommunityBtn.style.opacity = '0.6';
                }
                break;
                
            case 'approved':
                statusText.textContent = 'Approved!';
                statusText.style.color = 'var(--success)';
                statusMessage.textContent = 'Welcome to our community! You now have curator privileges.';
                if (joinCommunityBtn) {
                    joinCommunityBtn.disabled = true;
                    joinCommunityBtn.innerHTML = '<i class="fas fa-check"></i> Application Approved';
                    joinCommunityBtn.style.opacity = '0.6';
                }
                break;
                
            case 'rejected':
                statusText.textContent = 'Not Approved';
                statusText.style.color = 'var(--danger)';
                statusMessage.textContent = application.rejectionReason || 'Your application was not approved at this time.';
                if (joinCommunityBtn) {
                    joinCommunityBtn.disabled = false;
                    joinCommunityBtn.innerHTML = '<i class="fas fa-redo"></i> Apply Again';
                    joinCommunityBtn.style.opacity = '1';
                }
                break;
                
            default:
                // Unknown status, show apply button
                if (applicationStatus) applicationStatus.style.display = 'none';
                if (joinCommunityBtn) {
                    joinCommunityBtn.disabled = false;
                    joinCommunityBtn.innerHTML = '<i class="fas fa-handshake"></i> I Want to Become a Part of This Community';
                    joinCommunityBtn.style.opacity = '1';
                }
        }
    }).catch(error => {
        // If checking admin status fails, treat as non-admin
        console.log('User is not an admin (or cannot check admin status)');
        
        if (!application) {
            if (applicationStatus) applicationStatus.style.display = 'none';
            if (joinCommunityBtn) {
                joinCommunityBtn.disabled = false;
                joinCommunityBtn.innerHTML = '<i class="fas fa-handshake"></i> I Want to Become a Part of This Community';
                joinCommunityBtn.style.opacity = '1';
            }
            return;
        }
        
        if (applicationStatus) applicationStatus.style.display = 'block';
        
        // Handle application status
        switch(application.status) {
            case 'pending':
                statusText.textContent = 'Under Review';
                statusText.style.color = 'var(--warning)';
                statusMessage.textContent = 'Your application is being reviewed. We\'ll get back to you soon!';
                if (joinCommunityBtn) {
                    joinCommunityBtn.disabled = true;
                    joinCommunityBtn.innerHTML = '<i class="fas fa-clock"></i> Application Pending Review';
                    joinCommunityBtn.style.opacity = '0.6';
                }
                break;
                
            case 'approved':
                statusText.textContent = 'Approved!';
                statusText.style.color = 'var(--success)';
                statusMessage.textContent = 'Welcome to our community!';
                if (joinCommunityBtn) {
                    joinCommunityBtn.disabled = true;
                    joinCommunityBtn.innerHTML = '<i class="fas fa-check"></i> Application Approved';
                    joinCommunityBtn.style.opacity = '0.6';
                }
                break;
                
            case 'rejected':
                statusText.textContent = 'Not Approved';
                statusText.style.color = 'var(--danger)';
                statusMessage.textContent = application.rejectionReason || 'Your application was not approved at this time.';
                if (joinCommunityBtn) {
                    joinCommunityBtn.disabled = false;
                    joinCommunityBtn.innerHTML = '<i class="fas fa-redo"></i> Apply Again';
                    joinCommunityBtn.style.opacity = '1';
                }
                break;
        }
    });
}


// Handle application submission
function handleApplicationSubmit(e) {
    e.preventDefault();
    
    const user = auth.currentUser;
    if (!user) {
        showNotification('Please sign in to apply', 'warning');
        return;
    }

    // Check if user is already admin
    checkAdminStatus(user.uid).then(adminStatus => {
        if (adminStatus.isAdmin) {
            showNotification('You are already a curator!', 'warning');
            document.getElementById('communityApplicationModal').style.display = 'none';
            return;
        }

        const applicationData = {
            userId: user.uid,
            userEmail: user.email,
            name: document.getElementById('applicantName').value.trim(),
            age: parseInt(document.getElementById('applicantAge').value),
            reason: document.getElementById('applicantReason').value.trim(),
            status: 'pending',
            appliedAt: new Date().toISOString()
        };

        // Validate reason length
        if (applicationData.reason.length < 20) {
            showNotification('Please write at least 20 characters for your reason', 'warning');
            return;
        }

        // Submit application
        const applicationsRef = ref(database, 'community_applications');
        const newApplicationRef = push(applicationsRef);
        
        set(newApplicationRef, applicationData)
            .then(() => {
                showNotification('Application submitted successfully! We will review it soon.');
                document.getElementById('communityApplicationModal').style.display = 'none';
                document.getElementById('communityApplicationForm').reset();
                
                // Update UI immediately
                const pendingApplication = {
                    id: newApplicationRef.key,
                    ...applicationData,
                    status: 'pending'
                };
                updateApplicationStatusUI(pendingApplication);
            })
            .catch((error) => {
                console.error('Error submitting application:', error);
                showNotification('Error submitting application. Please try again.', 'error');
            });
    });
}
    let allApplications = [];
let filteredApplications = [];

function initApplicationManagement() {
    const user = auth.currentUser;
    if (!user) return;
    
    checkAdminStatus(user.uid).then(adminStatus => {
        const applicationsSection = document.getElementById('applicationsManagementSection');
        
        if (adminStatus.role === ADMIN_ROLES.SUPER_ADMIN) {
            // Show the applications section for super admin
            if (applicationsSection) {
                applicationsSection.style.display = 'block';
                console.log('Applications management section shown for super admin');
            }
            
            // Load applications
            loadApplications();
            
            // Event listeners for application management
            const refreshBtn = document.getElementById('refreshApplicationsBtn');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', loadApplications);
            }
            
            // Filter buttons
            const filterBtns = document.querySelectorAll('.application-filters .filter-btn');
            filterBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    filterBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    filterApplications(this.dataset.status);
                });
            });
        } else {
            // Hide the applications section for non-super-admins
            if (applicationsSection) {
                applicationsSection.style.display = 'none';
            }
        }
    }).catch(error => {
        console.error('Error checking admin status:', error);
    });
}
function loadApplications() {
    const applicationsRef = ref(database, 'community_applications');
    
    onValue(applicationsRef, (snapshot) => {
        const data = snapshot.val();
        allApplications = [];
        
        console.log('Applications data loaded:', data);
        
        if (data) {
            for (const [key, app] of Object.entries(data)) {
                allApplications.push({
                    id: key,
                    ...app
                });
            }
            
            // Sort by application date (newest first)
            allApplications.sort((a, b) => new Date(b.appliedAt) - new Date(a.appliedAt));
            console.log(`Loaded ${allApplications.length} applications`);
        } else {
            console.log('No applications found in database');
        }
        
        filterApplications('all');
        showNotification(`Loaded ${allApplications.length} applications`);
    }, (error) => {
        console.error('Error loading applications:', error);
        showNotification('Error loading applications', 'error');
    });
}

function filterApplications(status) {
    if (status === 'all') {
        filteredApplications = [...allApplications];
    } else {
        filteredApplications = allApplications.filter(app => app.status === status);
    }
    
    renderApplications();
}

function renderApplications() {
    const applicationsList = document.getElementById('applicationsList');
    if (!applicationsList) return;
    
    applicationsList.innerHTML = '';
    
    if (filteredApplications.length === 0) {
        applicationsList.innerHTML = `
            <tr>
                <td colspan="7" style="text-align: center; padding: 2rem;">
                    <div class="empty-state">
                        <i class="fas fa-file-alt"></i>
                        <h3>No applications found</h3>
                        <p>No applications match the current filter</p>
                    </div>
                </td>
            </tr>
        `;
        return;
    }
    
    filteredApplications.forEach(application => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${application.name || 'N/A'}</td>
            <td>${application.age || 'N/A'}</td>
            <td>${application.userEmail || 'N/A'}</td>
            <td class="application-reason" title="${application.reason || ''}">
                ${application.reason ? application.reason.substring(0, 50) + '...' : 'N/A'}
            </td>
            <td>${formatDate(application.appliedAt) || 'N/A'}</td>
            <td>
                <span class="status-badge status-${application.status}">
                    ${application.status || 'pending'}
                </span>
            </td>
            <td class="admin-actions-cell">
                <button class="admin-btn view-btn" data-id="${application.id}">
                    <i class="fas fa-eye"></i> View
                </button>
                ${application.status === 'pending' ? `
                    <button class="admin-btn approve-btn" data-id="${application.id}">
                        <i class="fas fa-check"></i> Approve
                    </button>
                    <button class="admin-btn delete-btn" data-id="${application.id}">
                        <i class="fas fa-times"></i> Reject
                    </button>
                ` : ''}
                ${application.status === 'rejected' ? `
                    <button class="admin-btn approve-btn" data-id="${application.id}">
                        <i class="fas fa-check"></i> Approve
                    </button>
                ` : ''}
                ${application.status === 'approved' ? `
                    <button class="admin-btn delete-btn revoke-btn" data-id="${application.id}">
                        <i class="fas fa-times"></i> Revoke
                    </button>
                ` : ''}
            </td>
        `;
        
        applicationsList.appendChild(row);
        
        // Add event listeners
        const viewBtn = row.querySelector('.view-btn');
        viewBtn.addEventListener('click', () => viewApplication(application));
        
        const approveBtn = row.querySelector('.approve-btn');
        if (approveBtn) {
            approveBtn.addEventListener('click', () => approveApplication(application.id));
        }
        
        const rejectBtn = row.querySelector('.delete-btn'); 
        if (rejectBtn && !rejectBtn.classList.contains('revoke-btn')) {
            rejectBtn.addEventListener('click', () => rejectApplication(application.id));
        }
        
        const revokeBtn = row.querySelector('.revoke-btn');
        if (revokeBtn) {
            revokeBtn.addEventListener('click', () => revokeAdminPrivileges(application.id));
        }
    });
}

function viewApplication(application) {
    const modal = document.createElement('div');
    modal.className = 'admin-modal';
    modal.style.display = 'flex';
    
    modal.innerHTML = `
        <div class="admin-modal-content">
            <h2>Application Details</h2>
            
            <div class="admin-form-group">
                <label><strong>Applicant Name:</strong></label>
                <p>${application.name || 'N/A'}</p>
            </div>
            
            <div class="admin-form-group">
                <label><strong>Age:</strong></label>
                <p>${application.age || 'N/A'}</p>
            </div>
            
            <div class="admin-form-group">
                <label><strong>Email:</strong></label>
                <p>${application.userEmail || 'N/A'}</p>
            </div>
            
            <div class="admin-form-group">
                <label><strong>Application Reason:</strong></label>
                <div style="background: var(--light-gray); padding: 1rem; border-radius: 4px; margin-top: 0.5rem;">
                    <p style="white-space: pre-wrap; line-height: 1.5;">${application.reason || 'No reason provided'}</p>
                </div>
            </div>
            
            <div class="admin-form-group">
                <label><strong>Applied On:</strong></label>
                <p>${formatDate(application.appliedAt) || 'N/A'}</p>
            </div>
            
            <div class="admin-form-group">
                <label><strong>Current Status:</strong></label>
                <span class="status-badge status-${application.status}">
                    ${application.status || 'pending'}
                </span>
            </div>
            
            ${application.rejectionReason ? `
            <div class="admin-form-group">
                <label><strong>Rejection Reason:</strong></label>
                <p>${application.rejectionReason}</p>
            </div>
            ` : ''}
            
            <div class="admin-form-actions">
                <button type="button" class="cancel-btn" id="closeViewModal">Close</button>
                ${application.status === 'pending' ? `
                    <button type="button" class="submit-btn" id="approveFromView" data-id="${application.id}">Approve</button>
                    <button type="button" class="delete-btn" id="rejectFromView" data-id="${application.id}">Reject</button>
                ` : ''}
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    
    // Event listeners for modal
    document.getElementById('closeViewModal').addEventListener('click', () => {
        document.body.removeChild(modal);
    });
    
    const approveBtn = document.getElementById('approveFromView');
    if (approveBtn) {
        approveBtn.addEventListener('click', () => {
            approveApplication(application.id);
            document.body.removeChild(modal);
        });
    }
    
    const rejectBtn = document.getElementById('rejectFromView');
    if (rejectBtn) {
        rejectBtn.addEventListener('click', () => {
            document.body.removeChild(modal);
            rejectApplication(application.id);
        });
    }
    
    // Close modal when clicking outside
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            document.body.removeChild(modal);
        }
    });
}

function approveApplication(applicationId) {
    const user = auth.currentUser;
    if (!user) return;
    
    checkAdminStatus(user.uid).then(adminStatus => {
        if (adminStatus.role !== ADMIN_ROLES.SUPER_ADMIN) {
            showNotification('Only super admins can approve applications', 'error');
            return;
        }
        
        const applicationRef = ref(database, `community_applications/${applicationId}`);
        
        // First get the application to find the user ID
        get(applicationRef).then((snapshot) => {
            if (snapshot.exists()) {
                const application = snapshot.val();
                
                // Update application status
                update(applicationRef, {
                    status: 'approved',
                    reviewedAt: new Date().toISOString(),
                    reviewedBy: user.uid
                })
                .then(() => {
                    showNotification('Application approved successfully!');
                    
                    // Grant admin privileges to the user - pass both application data and ID
                    grantAdminPrivileges(application, applicationId);
                    
                    // Refresh the applications list
                    loadApplications();
                })
                .catch((error) => {
                    console.error('Error approving application:', error);
                    showNotification('Error approving application', 'error');
                });
            }
        });
    });
}


function rejectApplication(applicationId) {
    const user = auth.currentUser;
    if (!user) return;
    
    checkAdminStatus(user.uid).then(adminStatus => {
        if (adminStatus.role !== ADMIN_ROLES.SUPER_ADMIN) {
            showNotification('Only super admins can reject applications', 'error');
            return;
        }
        
        const reason = prompt('Please provide a reason for rejection (optional):');
        
        const updates = {
            status: 'rejected',
            reviewedAt: new Date().toISOString(),
            reviewedBy: user.uid
        };
        
        if (reason) {
            updates.rejectionReason = reason;
        }
        
        const applicationRef = ref(database, `community_applications/${applicationId}`);
        
        update(applicationRef, updates)
        .then(() => {
            showNotification('Application rejected');
            // Refresh the applications list
            loadApplications();
        })
        .catch((error) => {
            console.error('Error rejecting application:', error);
            showNotification('Error rejecting application', 'error');
        });
    });
}
function setupApplicationStatusListener(userId) {
    const applicationsRef = ref(database, 'community_applications');
    
    onValue(applicationsRef, (snapshot) => {
        const applications = snapshot.val();
        let userApplication = null;
        
        if (applications) {
            for (const appId in applications) {
                const app = applications[appId];
                if (app.userId === userId) {
                    userApplication = { id: appId, ...app };
                    break;
                }
            }
        }
        
        updateApplicationStatusUI(userApplication);
    }, (error) => {
        console.error('Error listening to application status:', error);
        // If permission denied, try one-time check
        checkExistingApplication(userId);
    });
}
           


function grantAdminPrivileges(application, applicationId) {
    const userId = application.userId;
    
    if (!userId) {
        console.error('No user ID found in application');
        showNotification('Error: No user ID found in application', 'error');
        return;
    }
    
    console.log('Granting admin privileges to user:', userId);
    
    // Add user to admins list as REGULAR ADMIN (not super admin)
    const adminRef = ref(database, `admins/${userId}`);
    set(adminRef, {
        userId: userId,
        email: application.userEmail,
        name: application.name,
        role: ADMIN_ROLES.ADMIN, // Regular admin role
        permissions: ["manage_opportunities"],
        approvedAt: new Date().toISOString(),
        approvedBy: auth.currentUser.uid,
        applicationId: applicationId // Use the passed applicationId parameter
    })
    .then(() => {
        console.log('Admin privileges granted successfully');
        showNotification(`Admin privileges granted to ${application.name || application.userEmail}!`);
        
        // Try to update user profile, but don't fail if it doesn't work
        const userProfileRef = ref(database, `users/${userId}`);
        update(userProfileRef, {
            isAdmin: true,
            adminRole: ADMIN_ROLES.ADMIN,
            adminSince: new Date().toISOString()
        }).then(() => {
            console.log('User profile updated successfully');
        }).catch(error => {
            console.warn('Could not update user profile (this is okay):', error);
        });
    })
    .catch((error) => {
        console.error('Error granting admin privileges:', error);
        showNotification('Error granting admin privileges: ' + error.message, 'error');
    });
}
        
       function revokeAdminPrivileges(applicationId) {
    const user = auth.currentUser;
    if (!user) return;
    
    checkAdminStatus(user.uid).then(adminStatus => {
        if (adminStatus.role !== ADMIN_ROLES.SUPER_ADMIN) {
            showNotification('Only super admins can revoke admin privileges', 'error');
            return;
        }
        
        const applicationRef = ref(database, `community_applications/${applicationId}`);
        
        // First get the application to find the user ID
        get(applicationRef).then((snapshot) => {
            if (snapshot.exists()) {
                const application = snapshot.val();
                const userId = application.userId;
                
                if (!userId) {
                    showNotification('Error: No user ID found in application', 'error');
                    return;
                }
                
                // Remove from admins list
                const adminRef = ref(database, `admins/${userId}`);
                remove(adminRef)
                .then(() => {
                    // Try to update user profile, but don't fail if it doesn't work
                    const userProfileRef = ref(database, `users/${userId}`);
                    update(userProfileRef, {
                        isAdmin: false,
                        adminRole: null,
                        adminSince: null
                    }).then(() => {
                        console.log('User profile updated successfully');
                    }).catch(error => {
                        console.warn('Could not update user profile (this is okay):', error);
                    });
                    
                    // Update application status to rejected
                    update(applicationRef, {
                        status: 'rejected',
                        revokedAt: new Date().toISOString(),
                        revokedBy: user.uid,
                        rejectionReason: 'Admin privileges revoked'
                    })
                    .then(() => {
                        showNotification('Admin privileges revoked successfully');
                        loadApplications();
                    })
                    .catch(error => {
                        console.error('Error updating application status:', error);
                        showNotification('Admin privileges revoked but failed to update application status', 'warning');
                        loadApplications();
                    });
                })
                .catch((error) => {
                    console.error('Error revoking admin privileges:', error);
                    showNotification('Error revoking admin privileges', 'error');
                });
            }
        });
    });
}
        // Initialize the app
        function initApp() {
            loadOpportunitiesFromFirebase();
            initCommunityApplicationSystem(); 
            // In the DOMContentLoaded event listener, add this:
           
        }

        // Initialize the app
        initApp();
        initExpiredOpportunitiesFilter();
        
    });
</script>
</body>
</html>
