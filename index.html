<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpportunityHub - Find Your Next Challenge</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --accent: #f72585;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #4cc9f0;
            --warning: #ffd166;
            --danger: #ef476f;
            --gray: #6c757d;
            --light-gray: #e9ecef;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7ff;
            color: var(--dark);
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header Styles */
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1rem 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            display: flex;
            align-items: center;
        }
        
        .logo i {
            margin-right: 10px;
        }
        
        nav ul {
            display: flex;
            list-style: none;
        }
        
        nav ul li {
            margin-left: 1.5rem;
        }
        
        nav ul li a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            padding: 5px 10px;
            border-radius: 4px;
        }
        
        nav ul li a:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .auth-buttons {
            display: flex;
            gap: 10px;
        }
        
        .auth-buttons button {
            background-color: white;
            color: var(--primary);
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .auth-buttons button:hover {
            background-color: var(--light);
            transform: translateY(-2px);
        }
        
        /* Auth Modal */
        .auth-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .auth-content {
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 1.5rem;
        }
        
        .auth-tab {
            flex: 1;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            border-bottom: 2px solid var(--light-gray);
        }
        
        .auth-tab.active {
            border-bottom: 2px solid var(--primary);
            font-weight: 600;
            color: var(--primary);
        }
        
        .auth-form {
            display: none;
        }
        
        .auth-form.active {
            display: block;
        }
        
        .auth-form input {
            width: 100%;
            padding: 12px;
            margin-bottom: 1rem;
            border: 1px solid var(--light-gray);
            border-radius: 4px;
            font-size: 1rem;
        }
        
        .auth-form button {
            width: 100%;
            padding: 12px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .auth-form button:hover {
            background-color: var(--secondary);
        }
        
        .auth-error {
            color: var(--danger);
            margin-top: 1rem;
            text-align: center;
            display: none;
        }
        
        /* Google Sign-In Button */
        .google-signin-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 10px;
            background-color: white;
            color: #757575;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 15px;
        }
        
        .google-signin-btn:hover {
            background-color: #f5f5f5;
        }
        
        .google-signin-btn img {
            width: 18px;
            height: 18px;
            margin-right: 10px;
        }
        
        /* Password Reset Link */
        .password-reset-link {
            text-align: center;
            margin-top: 15px;
            color: var(--primary);
            cursor: pointer;
            font-size: 14px;
        }
        
        .password-reset-link:hover {
            text-decoration: underline;
        }
        
        /* Hero Section */
        .hero {
            background: linear-gradient(rgba(67, 97, 238, 0.9), rgba(58, 12, 163, 0.9)), url('https://images.unsplash.com/photo-1523240795612-9a054b0db644?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80');
            background-size: cover;
            background-position: center;
            color: white;
            padding: 4rem 0;
            text-align: center;
        }
        
        .hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        .hero p {
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto 2rem;
        }
        
        .search-bar {
            max-width: 600px;
            margin: 0 auto;
            display: flex;
        }
        
       .search-bar input {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 4px 0 0 4px;
            font-size: 1rem;
        }
        
        .search-bar button {
            background-color: var(--accent);
            color: white;
            border: none;
            padding: 0 20px;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
            font-size: 1.2rem;
        }
        
        /* Filters Section */
        .filters {
            background-color: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            margin: -30px auto 30px;
            position: relative;
            max-width: 1000px;
            z-index: 10;
        }
        
        .filter-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .filter-group {
            flex: 1;
            min-width: 200px;
        }
        
        .filter-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }
        
        .filter-group select, .filter-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--light-gray);
            border-radius: 4px;
            background-color: var(--light);
        }
        
        .filter-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .filter-actions button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .apply-btn {
            background-color: var(--primary);
            color: white;
        }
        
        .reset-btn {
            background-color: var(--light-gray);
            color: var(--dark);
        }
        
        /* Opportunities Grid */
        .opportunities-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin: 2rem 0;
        }
        
        .opportunity-card {
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
        }
        
        .opportunity-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
        }
        
        .card-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .opportunity-type {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .internship {
            background-color: #e6f7ff;
            color: #0066cc;
        }
        
        .research {
            background-color: #e6f2ff;
            color: #003399;
        }
        
        .summer {
            background-color: #fff0e6;
            color: #cc4400;
        }
        
        .volunteer {
            background-color: #e6f7ed;
            color: #007a41;
        }
        
        .card-header h3 {
            font-size: 1.3rem;
            margin-bottom: 10px;
        }
        
        .organization {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .card-body {
            padding: 1.5rem;
        }
        
        .detail {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .detail i {
            width: 24px;
            color: var(--primary);
            margin-right: 10px;
        }
        
        .deadline {
            color: var(--danger);
            font-weight: 600;
            display: flex;
            align-items: center;
        }
        
        .deadline.urgent {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { color: var(--danger); }
            50% { color: #ff8fa3; }
            100% { color: var(--danger); }
        }
        
        .time-remaining {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 8px;
            background-color: var(--light-gray);
        }
        
        .time-remaining.urgent {
            background-color: var(--danger);
            color: white;
        }
        
        .time-remaining.warning {
            background-color: var(--warning);
            color: var(--dark);
        }
        
        .time-remaining.normal {
            background-color: var(--success);
            color: white;
        }
        
        .card-footer {
            padding: 1rem 1.5rem;
            background-color: var(--light);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .save-btn {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 1.2rem;
            transition: color 0.3s ease;
        }
        
        .save-btn:hover, .save-btn.saved {
            color: var(--accent);
        }
        
        .apply-link, .details-btn {
            color: var(--primary);
            font-weight: 600;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 4px;
            background-color: rgba(67, 97, 238, 0.1);
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .apply-link:hover, .details-btn:hover {
            background-color: var(--primary);
            color: white;
        }
        
        .card-actions {
            display: flex;
            gap: 10px;
            width: 100%;
            justify-content: space-between;
        }
        
        .card-actions .left-actions {
            display: flex;
            gap: 10px;
        }
        
        .card-actions .right-actions {
            display: flex;
            gap: 10px;
        }
        
        /* Dashboard */
        .dashboard {
            display: none;
            margin: 2rem 0;
        }
        
        .dashboard-tabs {
            display: flex;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .dashboard-tab {
            padding: 1rem 1.5rem;
            cursor: pointer;
            font-weight: 500;
        }
        
        .dashboard-tab.active {
            border-bottom: 2px solid var(--primary);
            color: var(--primary);
        }
        
      .dashboard-content {
            display: none;
        }
        
        .dashboard-content.active {
            display: block;
        }
        
        .dashboard-opportunities {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .empty-state {
            text-align: center;
            padding: 2rem;
            color: var(--gray);
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--light-gray);
        }
        
        /* Admin Panel */
        .admin-panel {
            display: none;
            margin: 2rem 0;
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .admin-actions {
            display: flex;
            gap: 10px;
        }
        
        .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 2rem;
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }
        
        .admin-table th, .admin-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--light-gray);
        }
        
        .admin-table th {
            background-color: var(--primary);
            color: white;
            font-weight: 600;
        }
        
        .admin-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .admin-table tr:hover {
            background-color: #e9ecef;
        }
        
        .admin-actions-cell {
            display: flex;
            gap: 8px;
        }
        
        .admin-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .edit-btn {
            background-color: var(--warning);
            color: var(--dark);
        }
        
        .delete-btn {
            background-color: var(--danger);
            color: white;
        }
        
        /* Admin Modal */
        .admin-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .admin-modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            width: 100%;
            max-width: 600px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .admin-form-group {
            margin-bottom: 1.5rem;
        }
        
        .admin-form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .admin-form-group input, .admin-form-group select, .admin-form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--light-gray);
            border-radius: 4px;
            font-size: 1rem;
        }
        
        .admin-form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .admin-form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 1.5rem;
        }
        
        .admin-form-actions button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .cancel-btn {
            background-color: var(--light-gray);
            color: var(--dark);
        }
        
        .submit-btn {
            background-color: var(--primary);
            color: white;
        }
        
        /* Notification */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: white;
            border-left: 4px solid var(--success);
            padding: 15px 20px;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            transform: translateX(150%);
            transition: transform 0.3s ease;
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification i {
            color: var(--success);
            font-size: 1.5rem;
            margin-right: 10px;
        }
        
        .notification.error {
            border-left-color: var(--danger);
        }
        
        .notification.error i {
            color: var(--danger);
        }
        
        .notification.warning {
            border-left-color: var(--warning);
        }
        
        .notification.warning i {
            color: var(--warning);
        }
        
        /* Footer */
        footer {
            background-color: var(--dark);
            color: white;
            padding: 3rem 0 2rem;
            margin-top: 4rem;
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
        }
        
        .footer-section h3 {
            font-size: 1.2rem;
            margin-bottom: 1.2rem;
            position: relative;
            padding-bottom: 10px;
        }
        
        .footer-section h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 2px;
            background-color: var(--accent);
        }
        
        .footer-links {
            list-style: none;
        }
        
        .footer-links li {
            margin-bottom: 10px;
        }
        
        .footer-links a {
            color: #ccc;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .footer-links a:hover {
            color: white;
        }
        
        .copyright {
            text-align: center;
            padding-top: 2rem;
            margin-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #ccc;
            font-size: 0.9rem;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            nav ul {
                margin-top: 1rem;
                justify-content: center;
                flex-wrap: wrap;
            }
            
            nav ul li {
                margin: 5px;
            }
            
            .auth-buttons {
                margin-top: 1rem;
            }
            
            .hero h1 {
                font-size: 2.2rem;
            }
            
            .hero p {
                font-size: 1rem;
            }
            
            .filter-row {
                flex-direction: column;
            }
            
            .admin-table {
                display: block;
                overflow-x: auto;
            }
            
            .opportunities-grid {
                grid-template-columns: 1fr;
            }
            
            .card-footer {
                flex-direction: column;
                align-items: stretch;
            }
            
            .card-actions {
                flex-direction: column;
                gap: 10px;
            }
            
            .card-actions .left-actions, .card-actions .right-actions {
                justify-content: space-between;
                width: 100%;
            }
        }

        /* Enhanced Notification System */
        .notification-system {
            position: fixed;
            top: 80px;
            right: 20px;
            width: 350px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
            z-index: 9999;
            display: none;
            max-height: 500px;
            overflow: hidden;
        }

        .notification-system.show {
            display: block;
            animation: slideInRight 0.3s ease;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: var(--primary);
            color: white;
            border-radius: 8px 8px 0 0;
        }

        .notification-header h3 {
            margin: 0;
            font-size: 1.1rem;
        }

        .notification-clear {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .notification-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .notification-item {
            padding: 15px 20px;
            border-bottom: 1px solid var(--light-gray);
            display: flex;
            align-items: flex-start;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .notification-item:hover {
            background-color: #f8f9fa;
        }

        .notification-item.unread {
            background-color: #f0f7ff;
            border-left: 3px solid var(--primary);
        }

        .notification-item.urgent {
            background-color: #fff5f5;
            border-left: 3px solid var(--danger);
        }

        .notification-icon {
            margin-right: 12px;
            font-size: 1.2rem;
            margin-top: 2px;
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 0.95rem;
        }

        .notification-message {
            font-size: 0.85rem;
            color: var(--gray);
            margin-bottom: 5px;
            line-height: 1.4;
        }

        .notification-time {
            font-size: 0.75rem;
            color: #adb5bd;
        }

        .notification-actions {
            display: flex;
            gap: 5px;
            margin-top: 8px;
        }

        .notification-action-btn {
            background: none;
            border: 1px solid #dee2e6;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 0.7rem;
            cursor: pointer;
        }

        .empty-notifications {
            text-align: center;
            padding: 30px 20px;
            color: var(--gray);
        }

        .empty-notifications i {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--light-gray);
        }

        /* Deadline Alert Modal */
        .deadline-alert-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .deadline-alert-modal.show {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .deadline-alert-content {
            background: white;
            border-radius: 12px;
            width: 100%;
            max-width: 450px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .deadline-alert-header {
            background: linear-gradient(135deg, var(--danger), #ff6b6b);
            color: white;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .deadline-alert-header h3 {
            margin: 0;
            flex: 1;
        }

        .deadline-alert-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .deadline-alert-body {
            padding: 25px;
        }

        .deadline-alert-body p {
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .deadline-alert-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .btn-primary, .btn-secondary, .btn-tertiary {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-secondary {
            background: var(--warning);
            color: var(--dark);
        }

        .btn-tertiary {
            background: var(--light-gray);
            color: var(--dark);
        }

        /* Notification Bell in Header */
        .notification-bell {
            position: relative;
            margin-right: 15px;
            cursor: pointer;
        }

        .notification-bell i {
            font-size: 1.3rem;
            color: white;
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Notification Settings */
        .notification-settings {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            z-index: 999;
            display: none;
            max-width: 300px;
            width: 90%;
        }

        .notification-settings.show {
            display: block;
        }

        .notification-settings h4 {
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Settings Icon */
        .settings-icon {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1rem;
            padding: 5px;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s;
        }

        .settings-icon:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        /* Notification Preferences */
        .notification-preferences {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--light-gray);
        }

        .preference-item {
            margin-bottom: 10px;
        }

        .preference-item label {
            display: flex;
            align-items: center;
            font-size: 0.9rem;
            cursor: pointer;
        }

        .preference-item input {
            margin-right: 8px;
        }

        /* Details Modal */
        .details-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .details-modal.show {
            display: flex;
        }

        .details-content {
            background-color: white;
            border-radius: 8px;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }

        .details-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--light-gray);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .details-header h2 {
            margin: 0;
            flex: 1;
            margin-right: 20px;
        }

        .details-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }

        .details-body {
            padding: 1.5rem;
        }

        .details-section {
            margin-bottom: 1.5rem;
        }

        .details-section h3 {
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        .details-actions {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--light-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        @media (max-width: 480px) {
            .notification-system {
                width: 90%;
                right: 5%;
            }
            
            .hero h1 {
                font-size: 1.8rem;
            }
            
            .search-bar {
                flex-direction: column;
            }
            
            .search-bar input {
                border-radius: 4px;
                margin-bottom: 10px;
            }
            
            .search-bar button {
                border-radius: 4px;
                padding: 12px;
            }
            
            .details-content {
                max-width: 100%;
            }
            
            .details-actions {
                flex-direction: column;
            }
            
            .details-actions .left-actions, .details-actions .right-actions {
                width: 100%;
                justify-content: space-between;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container header-content">
            <div class="logo">
                <i class="fas fa-rocket"></i>
                <span>OpportunityHub</span>
            </div>
            
            <nav>
                <ul>
                    <li><a href="#" class="nav-home">Home</a></li>
                    <li><a href="#" class="nav-opportunities">Opportunities</a></li>
                    <li><a href="#" class="nav-dashboard">Dashboard</a></li>
                    <li><a href="#" class="nav-admin" style="display: none;">Admin</a></li>
                    <li><a href="#">Resources</a></li>
                    <li><a href="#">Contact</a></li>
                    <li class="notification-bell" id="notificationBell" style="display: none;">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
                    </li>
                </ul>
            </nav>
            
            <div class="auth-buttons">
                <button id="loginBtn">Sign In</button>
                <button id="signupBtn">Sign Up</button>
                <button id="logoutBtn" style="display: none;">Logout</button>
                <button class="settings-icon" id="notificationSettingsBtn" style="display: none;">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </div>
    </header>
    
    <!-- Auth Modal -->
    <div class="auth-modal" id="authModal">
        <div class="auth-content">
            <div class="auth-tabs">
                <div class="auth-tab active" data-tab="login">Login</div>
                <div class="auth-tab" data-tab="signup">Sign Up</div>
            </div>
            
            <div class="auth-form active" id="loginForm">
                <input type="email" id="loginEmail" placeholder="Email">
                <input type="password" id="loginPassword" placeholder="Password">
                <button id="doLogin">Login</button>
                <div class="password-reset-link" id="passwordResetLink">Forgot Password?</div>
                <div class="auth-error" id="loginError"></div>
                
                <div class="divider">or</div>
                <button class="google-signin-btn" id="googleSignIn">
                    <img src="https://developers.google.com/identity/images/g-logo.png" alt="Google logo">
                    Sign in with Google
                </button>
            </div>
            
            <div class="auth-form" id="signupForm">
                <input type="text" id="signupName" placeholder="Full Name">
                <input type="email" id="signupEmail" placeholder="Email">
                <input type="password" id="signupPassword" placeholder="Password">
                <input type="password" id="signupConfirm" placeholder="Confirm Password">
                <button id="doSignup">Sign Up</button>
                <div class="auth-error" id="signupError"></div>
                
                <div class="divider">or</div>
                <button class="google-signin-btn" id="googleSignUp">
                    <img src="https://developers.google.com/identity/images/g-logo.png" alt="Google logo">
                    Sign up with Google
                </button>
            </div>
        </div>
    </div>
    
    <!-- Hero Section -->
    <section class="hero" id="heroSection">
        <div class="container">
            <h1>Find Your Next Challenge</h1>
            <p>Discover internships, research opportunities, and summer programs to build your portfolio and boost your career</p>
            
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="Search opportunities by keyword, field, or organization...">
                <button id="searchBtn"><i class="fas fa-search"></i></button>
            </div>
        </div>
    </section>
    
    <!-- Main Content -->
    <main class="container">
        <!-- Filters -->
        <section class="filters" id="filtersSection">
            <div class="filter-row">
                <div class="filter-group">
                    <label for="field">Field of Interest</label>
                    <select id="field">
                        <option value="">All Fields</option>
                        <option value="stem">STEM</option>
                        <option value="business">Business & Finance</option>
                        <option value="arts">Arts & Design</option>
                        <option value="social">Social Sciences</option>
                        <option value="health">Health & Medicine</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="type">Opportunity Type</label>
                    <select id="type">
                        <option value="">All Types</option>
                        <option value="internship">Internship</option>
                        <option value="research">Research</option>
                        <option value="summer">Summer Program</option>
                        <option value="volunteer">Volunteer</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="compensation">Compensation</label>
                    <select id="compensation">
                        <option value="">Any</option>
                        <option value="paid">Paid</option>
                        <option value="unpaid">Unpaid</option>
                        <option value="stipend">Stipend</option>
                    </select>
                </div>
            </div>
            
            <div class="filter-row">
                <div class="filter-group">
                    <label for="deadline">Deadline Within</label>
                    <select id="deadline">
                        <option value="">Any Time</option>
                        <option value="week">1 Week</option>
                        <option value="month">1 Month</option>
                        <option value="3months">3 Months</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="impact">Impact Level</label>
                    <select id="impact">
                        <option value="">Any Impact</option>
                        <option value="low">Low</option>
                        <option value="medium">Medium</option>
                        <option value="high">High</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="location">Location</label>
                    <select id="location">
                        <option value="">Any Location</option>
                        <option value="remote">Remote</option>
                        <option value="onsite">On-site</option>
                        <option value="hybrid">Hybrid</option>
                    </select>
                </div>
            </div>
            
            <div class="filter-actions">
                <button class="reset-btn" id="resetFilters">Reset Filters</button>
                <button class="apply-btn" id="applyFilters">Apply Filters</button>
            </div>
        </section>
        
        <!-- Opportunities Grid -->
        <h2 id="opportunitiesTitle">Featured Opportunities</h2>
        <div class="opportunities-grid" id="opportunitiesGrid">
            <!-- Opportunities will be loaded from Firebase -->
        </div>
        
        <!-- Dashboard -->
        <div class="dashboard" id="dashboard">
            <h2>My Dashboard</h2>
            
            <div class="dashboard-tabs">
                <div class="dashboard-tab active" data-tab="pending">Pending Opportunities</div>
                <div class="dashboard-tab" data-tab="completed">Completed</div>
            </div>
            
            <div class="dashboard-content active" id="pendingContent">
                <div class="dashboard-opportunities" id="pendingOpportunities">
                    <div class="empty-state">
                        <i class="far fa-bookmark"></i>
                        <h3>No pending opportunities</h3>
                        <p>Save opportunities to your dashboard to track them here</p>
                    </div>
                </div>
            </div>
            
            <div class="dashboard-content" id="completedContent">
                <div class="dashboard-opportunities" id="completedOpportunities">
                    <div class="empty-state">
                        <i class="far fa-check-circle"></i>
                        <h3>No completed opportunities</h3>
                        <p>Mark opportunities as complete to track your achievements</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Admin Panel -->
        <div class="admin-panel" id="adminPanel">
            <div class="admin-header">
                <h2>Admin Panel</h2>
                <div class="admin-actions">
                    <button class="apply-btn" id="addOpportunityBtn">Add New Opportunity</button>
                </div>
            </div>
            
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Organization</th>
                        <th>Type</th>
                        <th>Deadline</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="adminOpportunitiesList">
                    <!-- Admin opportunities will be loaded here -->
                </tbody>
            </table>
        </div>
    </main>
    
    <!-- Admin Modal -->
    <div class="admin-modal" id="adminModal">
        <div class="admin-modal-content">
            <h2 id="adminModalTitle">Add New Opportunity</h2>
            
            <form id="adminOpportunityForm">
                <input type="hidden" id="opportunityId">
                
                <div class="admin-form-group">
                    <label for="adminTitle">Title *</label>
                    <input type="text" id="adminTitle" required>
                </div>
                
                <div class="admin-form-group">
                    <label for="adminOrganization">Organization *</label>
                    <input type="text" id="adminOrganization" required>
                </div>
                
                <div class="admin-form-group">
                    <label for="adminType">Type *</label>
                    <select id="adminType" required>
                        <option value="">Select Type</option>
                        <option value="internship">Internship</option>
                        <option value="research">Research</option>
                        <option value="summer">Summer Program</option>
                        <option value="volunteer">Volunteer</option>
                    </select>
                </div>
                
                <div class="admin-form-group">
                    <label for="adminField">Field *</label>
                    <select id="adminField" required>
                        <option value="">Select Field</option>
                        <option value="stem">STEM</option>
                        <option value="business">Business & Finance</option>
                        <option value="arts">Arts & Design</option>
                        <option value="social">Social Sciences</option>
                        <option value="health">Health & Medicine</option>
                    </select>
                </div>
                
                <div class="admin-form-group">
                    <label for="adminDescription">Description *</label>
                    <textarea id="adminDescription" required></textarea>
                </div>
                
                <div class="admin-form-group">
                    <label for="adminLocation">Location *</label>
                    <input type="text" id="adminLocation" required>
                </div>
                
                <div class="admin-form-group">
                    <label for="adminDeadline">Deadline *</label>
                    <input type="date" id="adminDeadline" required>
                </div>
                
                <div class="admin-form-group">
                    <label for="adminApplyLink">Application Link *</label>
                    <input type="url" id="adminApplyLink" required>
                </div>
                
                <div class="admin-form-group">
                    <label for="adminImpact">Impact Level *</label>
                    <select id="adminImpact" required>
                        <option value="">Select Impact Level</option>
                        <option value="low">Low</option>
                        <option value="medium">Medium</option>
                        <option value="high">High</option>
                    </select>
                </div>
                
                <div class="admin-form-group">
                    <label>Compensation Type</label>
                    <div>
                        <input type="checkbox" id="adminPaid">
                        <label for="adminPaid">Paid</label>
                        
                        <input type="checkbox" id="adminStipend">
                        <label for="adminStipend">Stipend</label>
                        
                        <input type="checkbox" id="adminScholarship">
                        <label for="adminScholarship">Scholarship</label>
                    </div>
                </div>
                
                <div class="admin-form-group">
                    <label for="adminAmount">Compensation Amount (if applicable)</label>
                    <input type="text" id="adminAmount">
                </div>
                
                <div class="admin-form-actions">
                    <button type="button" class="cancel-btn" id="adminCancelBtn">Cancel</button>
                    <button type="submit" class="submit-btn">Save Opportunity</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Details Modal -->
    <div class="details-modal" id="detailsModal">
        <div class="details-content">
            <div class="details-header">
                <h2 id="detailsTitle">Opportunity Details</h2>
                <button class="details-close" id="detailsClose">&times;</button>
            </div>
            <div class="details-body">
                <div class="details-section">
                    <h3>Description</h3>
                    <p id="detailsDescription"></p>
                </div>
                <div class="details-section">
                    <h3>Organization</h3>
                    <p id="detailsOrganization"></p>
                </div>
                <div class="details-section">
                    <h3>Type</h3>
                    <p id="detailsType"></p>
                </div>
                <div class="details-section">
                    <h3>Location</h3>
                    <p id="detailsLocation"></p>
                </div>
                <div class="details-section">
                    <h3>Deadline</h3>
                    <p id="detailsDeadline"></p>
                </div>
                <div class="details-section">
                    <h3>Compensation</h3>
                    <p id="detailsCompensation"></p>
                </div>
                <div class="details-section">
                    <h3>Impact Level</h3>
                    <p id="detailsImpact"></p>
                </div>
            </div>
            <div class="details-actions">
                <div class="left-actions">
                    <button class="save-btn" id="detailsSaveBtn">
                        <i class="far fa-bookmark"></i> Save to Dashboard
                    </button>
                </div>
                <div class="right-actions">
                    <a href="#" target="_blank" class="apply-link" id="detailsApplyLink">Apply Now</a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Notification -->
    <div class="notification" id="notification">
        <i class="fas fa-bell"></i>
        <div class="notification-content">
            <h4>Notification</h4>
            <p>Operation completed successfully!</p>
        </div>
    </div>
    
    <!-- Enhanced Notification System -->
    <div class="notification-system" id="notificationSystem">
        <div class="notification-header">
            <h3><i class="fas fa-bell"></i> Notifications</h3>
            <div>
                <button class="notification-clear" id="markAllRead">Mark All Read</button>
                <button class="notification-clear" id="clearAllNotifications">Clear All</button>
            </div>
        </div>
        <div class="notification-list" id="notificationList">
            <!-- Notifications will be dynamically added here -->
        </div>
    </div>
    
    <!-- Deadline Alert Modal -->
    <div class="deadline-alert-modal" id="deadlineAlertModal">
        <div class="deadline-alert-content">
            <div class="deadline-alert-header">
                <i class="fas fa-exclamation-triangle"></i>
                <h3>Deadline Alert!</h3>
                <button class="deadline-alert-close" id="closeDeadlineAlert">&times;</button>
            </div>
            <div class="deadline-alert-body">
                <p id="deadlineAlertMessage"></p>
                <div class="deadline-alert-actions">
                    <button class="btn-primary" id="viewOpportunityBtn">View Opportunity</button>
                    <button class="btn-secondary" id="snoozeDeadlineBtn">Snooze (24h)</button>
                    <button class="btn-tertiary" id="dismissDeadlineBtn">Dismiss</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Notification Settings Panel -->
    <div class="notification-settings" id="notificationSettings">
        <h4>Notification Settings <button class="settings-icon" id="closeSettings"><i class="fas fa-times"></i></button></h4>
        
        <div class="setting-item">
            <span>Browser Notifications</span>
            <label class="switch">
                <input type="checkbox" id="browserNotifications">
                <span class="slider"></span>
            </label>
        </div>
        
        <div class="setting-item">
            <span>Sound Notifications</span>
            <label class="switch">
                <input type="checkbox" id="soundNotifications">
                <span class="slider"></span>
            </label>
        </div>
        
        <div class="notification-preferences">
            <h5>Notification Preferences</h5>
            <div class="preference-item">
                <label>
                    <input type="checkbox" id="deadlineReminders" checked>
                    Deadline Reminders
                </label>
            </div>
            <div class="preference-item">
                <label>
                    <input type="checkbox" id="newOpportunities" checked>
                    New Opportunities
                </label>
            </div>
            <div class="preference-item">
                <label>
                    <input type="checkbox" id="applicationUpdates" checked>
                    Application Updates
                </label>
            </div>
        </div>
        
        <div class="setting-item">
            <span>Reminder Intervals (days before deadline)</span>
            <div>
                <label><input type="checkbox" name="reminderIntervals" value="7" checked> 7 days</label>
                <label><input type="checkbox" name="reminderIntervals" value="3" checked> 3 days</label>
                <label><input type="checkbox" name="reminderIntervals" value="1" checked> 1 day</label>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer>
        <div class="container footer-content">
            <div class="footer-section">
                <h3>About OpportunityHub</h3>
                <p>We connect high school students with meaningful opportunities to build their portfolios and gain real-world experience.</p>
            </div>
            
            <div class="footer-section">
                <h3>Quick Links</h3>
                <ul class="footer-links">
                    <li><a href="#">Browse Opportunities</a></li>
                    <li><a href="#">Post an Opportunity</a></li>
                    <li><a href="#">Success Stories</a></li>
                    <li><a href="#">Upcoming Deadlines</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>Resources</h3>
                <ul class="footer-links">
                    <li><a href="#">Application Tips</a></li>
                    <li><a href="#">Resume Builder</a></li>
                    <li><a href="#">Interview Preparation</a></li>
                    <li><a href="#">Blog</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h3>Contact Us</h3>
                <ul class="footer-links">
                    <li><a href="#"><i class="fas fa-envelope"></i> contact@opportunityhub.com</a></li>
                    <li><a href="#"><i class="fas fa-phone"></i> (555) 123-4567</a></li>
                    <li><a href="#"><i class="fas fa-map-marker-alt"></i> New York, NY</a></li>
                </ul>
            </div>
        </div>
        
        <div class="container copyright">
            <p>&copy; 2023 OpportunityHub. All rights reserved.</p>
        </div>
    </footer>

    <!-- Firebase App (core SDK is always required) -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-app.js";
        import { 
            getAuth, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, 
            signOut, 
            onAuthStateChanged, 
            GoogleAuthProvider, 
            signInWithPopup,
            sendPasswordResetEmail,
            fetchSignInMethodsForEmail
        } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-auth.js";
        import { getDatabase, ref, set, get, child, push, onValue, remove, update } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-database.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDEFumFatqFMn29D1x9f-_WWiVh2F_aVtQ",
            authDomain: "youthaxis-16bab.firebaseapp.com",
            projectId: "youthaxis-16bab",
            storageBucket: "youthaxis-16bab.firebasestorage.app",
            messagingSenderId: "287063568472",
            appId: "1:287063568472:web:9209a3a4a82407d63e9a2d",
            measurementId: "G-7M9QET4FLZ",
            databaseURL: "https://youthaxis-16bab-default-rtdb.firebaseio.com/"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);
        const googleProvider = new GoogleAuthProvider();

        // Global variables
        let allOpportunities = [];
        let filteredOpportunities = [];
        let userOpportunities = {
            pending: [],
            completed: []
        };
        let isAdminUser = false;
        let userOpportunitiesListener = null;
        let notificationManager = null;
        let currentOpportunityDetails = null;

        // Enhanced Notification System
        class NotificationManager {
            constructor() {
                this.notifications = [];
                this.settings = {
                    browserNotifications: true,
                    soundEnabled: true,
                    reminderIntervals: [7, 3, 1], // days before deadline to remind
                    deadlineReminders: true,
                    newOpportunities: true,
                    applicationUpdates: true
                };
                this.init();
            }

            init() {
                this.loadSettings();
                this.setupEventListeners();
                this.startDeadlineChecker();
                
                // Request notification permission
                if ('Notification' in window) {
                    Notification.requestPermission();
                }
            }

            setupEventListeners() {
                // Notification bell
                const notificationBell = document.getElementById('notificationBell');
                if (notificationBell) {
                    notificationBell.addEventListener('click', () => this.toggleNotificationPanel());
                }

                // Mark all as read button
                const markAllReadBtn = document.getElementById('markAllRead');
                if (markAllReadBtn) {
                    markAllReadBtn.addEventListener('click', () => this.markAllAsRead());
                }

                // Clear all notifications
                const clearAllBtn = document.getElementById('clearAllNotifications');
                if (clearAllBtn) {
                    clearAllBtn.addEventListener('click', () => this.clearAllNotifications());
                }

                // Deadline alert modal buttons
                const closeAlertBtn = document.getElementById('closeDeadlineAlert');
                if (closeAlertBtn) {
                    closeAlertBtn.addEventListener('click', () => this.hideDeadlineAlert());
                }

                const viewOpportunityBtn = document.getElementById('viewOpportunityBtn');
                if (viewOpportunityBtn) {
                    viewOpportunityBtn.addEventListener('click', () => this.viewOpportunity());
                }

                const snoozeDeadlineBtn = document.getElementById('snoozeDeadlineBtn');
                if (snoozeDeadlineBtn) {
                    snoozeDeadlineBtn.addEventListener('click', () => this.snoozeDeadline());
                }

                const dismissDeadlineBtn = document.getElementById('dismissDeadlineBtn');
                if (dismissDeadlineBtn) {
                    dismissDeadlineBtn.addEventListener('click', () => this.dismissDeadline());
                }

                // Notification settings
                const notificationSettingsBtn = document.getElementById('notificationSettingsBtn');
                if (notificationSettingsBtn) {
                    notificationSettingsBtn.addEventListener('click', () => this.toggleSettingsPanel());
                }

                const closeSettingsBtn = document.getElementById('closeSettings');
                if (closeSettingsBtn) {
                    closeSettingsBtn.addEventListener('click', () => this.hideSettingsPanel());
                }

                // Settings checkboxes
                const browserNotificationsCheckbox = document.getElementById('browserNotifications');
                if (browserNotificationsCheckbox) {
                    browserNotificationsCheckbox.checked = this.settings.browserNotifications;
                    browserNotificationsCheckbox.addEventListener('change', (e) => {
                        this.settings.browserNotifications = e.target.checked;
                        this.saveSettings();
                    });
                }

                const soundNotificationsCheckbox = document.getElementById('soundNotifications');
                if (soundNotificationsCheckbox) {
                    soundNotificationsCheckbox.checked = this.settings.soundEnabled;
                    soundNotificationsCheckbox.addEventListener('change', (e) => {
                        this.settings.soundEnabled = e.target.checked;
                        this.saveSettings();
                    });
                }

                // Notification preferences
                const deadlineRemindersCheckbox = document.getElementById('deadlineReminders');
                if (deadlineRemindersCheckbox) {
                    deadlineRemindersCheckbox.checked = this.settings.deadlineReminders;
                    deadlineRemindersCheckbox.addEventListener('change', (e) => {
                        this.settings.deadlineReminders = e.target.checked;
                        this.saveSettings();
                    });
                }

                const newOpportunitiesCheckbox = document.getElementById('newOpportunities');
                if (newOpportunitiesCheckbox) {
                    newOpportunitiesCheckbox.checked = this.settings.newOpportunities;
                    newOpportunitiesCheckbox.addEventListener('change', (e) => {
                        this.settings.newOpportunities = e.target.checked;
                        this.saveSettings();
                    });
                }

                const applicationUpdatesCheckbox = document.getElementById('applicationUpdates');
                if (applicationUpdatesCheckbox) {
                    applicationUpdatesCheckbox.checked = this.settings.applicationUpdates;
                    applicationUpdatesCheckbox.addEventListener('change', (e) => {
                        this.settings.applicationUpdates = e.target.checked;
                        this.saveSettings();
                    });
                }

                // Reminder intervals
                const reminderIntervalsCheckboxes = document.querySelectorAll('input[name="reminderIntervals"]');
                reminderIntervalsCheckboxes.forEach(checkbox => {
                    checkbox.checked = this.settings.reminderIntervals.includes(parseInt(checkbox.value));
                    checkbox.addEventListener('change', (e) => {
                        if (e.target.checked) {
                            this.settings.reminderIntervals.push(parseInt(e.target.value));
                        } else {
                            this.settings.reminderIntervals = this.settings.reminderIntervals.filter(
                                interval => interval !== parseInt(e.target.value)
                            );
                        }
                        this.saveSettings();
                    });
                });

                // Close notification panel when clicking outside
                document.addEventListener('click', (e) => {
                    const notificationSystem = document.getElementById('notificationSystem');
                    const notificationBell = document.getElementById('notificationBell');
                    
                    if (notificationSystem && notificationSystem.classList.contains('show') &&
                        !notificationSystem.contains(e.target) && 
                        !notificationBell.contains(e.target)) {
                        this.hideNotificationPanel();
                    }

                    // Close settings panel when clicking outside
                    const notificationSettings = document.getElementById('notificationSettings');
                    const notificationSettingsBtn = document.getElementById('notificationSettingsBtn');
                    
                    if (notificationSettings && notificationSettings.classList.contains('show') &&
                        !notificationSettings.contains(e.target) && 
                        !notificationSettingsBtn.contains(e.target)) {
                        this.hideSettingsPanel();
                    }
                });
            }

            // Load notification settings from localStorage
            loadSettings() {
                const user = auth.currentUser;
                const key = user ? `notificationSettings_${user.uid}` : 'notificationSettings_guest';
                const savedSettings = localStorage.getItem(key);
                
                if (savedSettings) {
                    this.settings = { ...this.settings, ...JSON.parse(savedSettings) };
                }
            }

            // Save notification settings to localStorage
            saveSettings() {
                const user = auth.currentUser;
                const key = user ? `notificationSettings_${user.uid}` : 'notificationSettings_guest';
                localStorage.setItem(key, JSON.stringify(this.settings));
            }

            // Check for approaching deadlines
            startDeadlineChecker() {
                // Check every hour
                setInterval(() => {
                    this.checkApproachingDeadlines();
                }, 60 * 60 * 1000);

                // Initial check
                setTimeout(() => {
                    this.checkApproachingDeadlines();
                }, 2000);
            }

            async checkApproachingDeadlines() {
                const user = auth.currentUser;
                if (!user || !allOpportunities || allOpportunities.length === 0) return;

                try {
                    const userOppRef = ref(database, `userOpportunities/${user.uid}`);
                    const snapshot = await get(userOppRef);
                    
                    if (!snapshot.exists()) return;

                    const userOpportunities = snapshot.val();
                    const now = new Date();
                    const opportunitiesToNotify = [];

                    for (const [oppId, userOpp] of Object.entries(userOpportunities)) {
                        if (userOpp.status !== 'pending') continue;

                        const opportunity = allOpportunities.find(opp => opp.id === oppId);
                        if (!opportunity || !opportunity.deadline) continue;

                        const deadline = new Date(opportunity.deadline);
                        const daysUntilDeadline = Math.ceil((deadline - now) / (1000 * 60 * 60 * 24));

                        // Check if we should notify based on reminder intervals
                        if (this.settings.reminderIntervals.includes(daysUntilDeadline) && daysUntilDeadline > 0) {
                            opportunitiesToNotify.push({
                                opportunity,
                                daysUntilDeadline,
                                userOpp
                            });
                        }

                        // Notify if deadline is today
                        if (daysUntilDeadline === 0) {
                            opportunitiesToNotify.push({
                                opportunity,
                                daysUntilDeadline: 0,
                                userOpp,
                                isToday: true
                            });
                        }

                        // Notify if deadline has passed but not completed
                        if (daysUntilDeadline < 0 && userOpp.status === 'pending') {
                            opportunitiesToNotify.push({
                                opportunity,
                                daysUntilDeadline,
                                userOpp,
                                isOverdue: true
                            });
                        }
                    }

                    // Create notifications for each opportunity
                    opportunitiesToNotify.forEach(opp => {
                        this.createDeadlineNotification(opp);
                    });

                } catch (error) {
                    console.error('Error checking deadlines:', error);
                }
            }

            createDeadlineNotification(opportunityInfo) {
                const { opportunity, daysUntilDeadline, isToday, isOverdue } = opportunityInfo;
                const notificationId = `deadline-${opportunity.id}-${daysUntilDeadline}`;

                // Check if we already notified for this deadline
                if (this.hasBeenNotified(notificationId)) return;

                let title, message, type, urgent = false;

                if (isOverdue) {
                    title = 'Deadline Passed!';
                    message = `The deadline for "${opportunity.title}" has passed. Consider marking it as complete or removing it.`;
                    type = 'error';
                    urgent = true;
                } else if (isToday) {
                    title = 'Deadline Today!';
                    message = `"${opportunity.title}" application is due today!`;
                    type = 'error';
                    urgent = true;
                } else {
                    title = 'Deadline Approaching';
                    message = `"${opportunity.title}" application is due in ${daysUntilDeadline} day${daysUntilDeadline !== 1 ? 's' : ''}.`;
                    type = 'warning';
                    urgent = daysUntilDeadline <= 3;
                }

                const notification = {
                    id: notificationId,
                    title,
                    message,
                    type,
                    opportunityId: opportunity.id,
                    timestamp: new Date().toISOString(),
                    read: false,
                    urgent,
                    category: 'deadline'
                };

                this.addNotification(notification);
                this.showBrowserNotification(notification);
                
                if (urgent) {
                    this.showUrgentDeadlineAlert(notification, opportunity);
                }

                // Mark as notified in localStorage
                this.markAsNotified(notificationId);
            }

            addNotification(notification) {
                this.notifications.unshift(notification);
                this.saveNotifications();
                this.updateNotificationUI();
            }

            saveNotifications() {
                const user = auth.currentUser;
                if (user) {
                    localStorage.setItem(`notifications_${user.uid}`, JSON.stringify(this.notifications));
                } else {
                    localStorage.setItem('notifications_guest', JSON.stringify(this.notifications));
                }
            }

            loadNotifications() {
                const user = auth.currentUser;
                const key = user ? `notifications_${user.uid}` : 'notifications_guest';
                const savedNotifications = localStorage.getItem(key);
                
                if (savedNotifications) {
                    this.notifications = JSON.parse(savedNotifications);
                    this.updateNotificationUI();
                }
            }

            updateNotificationUI() {
                const notificationBell = document.getElementById('notificationBell');
                const notificationBadge = document.getElementById('notificationBadge');
                const notificationList = document.getElementById('notificationList');

                if (!notificationBell || !notificationBadge || !notificationList) return;

                const unreadCount = this.notifications.filter(n => !n.read).length;

                // Update badge
                if (unreadCount > 0) {
                    notificationBadge.textContent = unreadCount > 99 ? '99+' : unreadCount;
                    notificationBadge.style.display = 'block';
                    notificationBell.style.display = 'list-item';
                } else {
                    notificationBadge.style.display = 'none';
                }

                // Update notification list
                notificationList.innerHTML = '';

                if (this.notifications.length === 0) {
                    notificationList.innerHTML = `
                        <div class="empty-notifications">
                            <i class="fas fa-bell-slash"></i>
                            <p>No notifications yet</p>
                        </div>
                    `;
                    return;
                }

                this.notifications.forEach(notification => {
                    const notificationElement = this.createNotificationElement(notification);
                    notificationList.appendChild(notificationElement);
                });
            }

            createNotificationElement(notification) {
                const element = document.createElement('div');
                element.className = `notification-item ${notification.urgent ? 'urgent' : ''} ${!notification.read ? 'unread' : ''}`;
                element.innerHTML = `
                    <div class="notification-icon">
                        <i class="fas fa-${this.getNotificationIcon(notification.type)}"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-title">${notification.title}</div>
                        <div class="notification-message">${notification.message}</div>
                        <div class="notification-time">${this.formatTime(notification.timestamp)}</div>
                        <div class="notification-actions">
                            ${!notification.read ? 
                                `<button class="notification-action-btn mark-read" data-id="${notification.id}">Mark Read</button>` : 
                                `<button class="notification-action-btn mark-unread" data-id="${notification.id}">Mark Unread</button>`
                            }
                            <button class="notification-action-btn delete-notification" data-id="${notification.id}">Delete</button>
                        </div>
                    </div>
                `;

                // Add event listeners
                element.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('notification-action-btn')) {
                        this.handleNotificationClick(notification);
                    }
                });

                const markReadBtn = element.querySelector('.mark-read, .mark-unread');
                if (markReadBtn) {
                    markReadBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.toggleReadStatus(notification.id);
                    });
                }

                const deleteBtn = element.querySelector('.delete-notification');
                if (deleteBtn) {
                    deleteBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.deleteNotification(notification.id);
                    });
                }

                return element;
            }

            getNotificationIcon(type) {
                switch (type) {
                    case 'error': return 'exclamation-triangle';
                    case 'warning': return 'exclamation-circle';
                    case 'success': return 'check-circle';
                    default: return 'info-circle';
                }
            }

            formatTime(timestamp) {
                const now = new Date();
                const notificationTime = new Date(timestamp);
                const diffMs = now - notificationTime;
                const diffMins = Math.floor(diffMs / (1000 * 60));
                const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
                const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));

                if (diffMins < 1) return 'Just now';
                if (diffMins < 60) return `${diffMins}m ago`;
                if (diffHours < 24) return `${diffHours}h ago`;
                if (diffDays < 7) return `${diffDays}d ago`;
                
                return notificationTime.toLocaleDateString();
            }

            handleNotificationClick(notification) {
                this.markAsRead(notification.id);
                
                if (notification.opportunityId) {
                    // Find and show the opportunity
                    const opportunity = allOpportunities.find(opp => opp.id === notification.opportunityId);
                    if (opportunity) {
                        this.showOpportunity(opportunity);
                    }
                }
                
                this.hideNotificationPanel();
            }

            markAsRead(notificationId) {
                const notification = this.notifications.find(n => n.id === notificationId);
                if (notification && !notification.read) {
                    notification.read = true;
                    this.saveNotifications();
                    this.updateNotificationUI();
                }
            }

            markAllAsRead() {
                this.notifications.forEach(notification => {
                    notification.read = true;
                });
                this.saveNotifications();
                this.updateNotificationUI();
            }

            toggleReadStatus(notificationId) {
                const notification = this.notifications.find(n => n.id === notificationId);
                if (notification) {
                    notification.read = !notification.read;
                    this.saveNotifications();
                    this.updateNotificationUI();
                }
            }

            deleteNotification(notificationId) {
                this.notifications = this.notifications.filter(n => n.id !== notificationId);
                this.saveNotifications();
                this.updateNotificationUI();
            }

            clearAllNotifications() {
                this.notifications = [];
                this.saveNotifications();
                this.updateNotificationUI();
            }

            toggleNotificationPanel() {
                const notificationSystem = document.getElementById('notificationSystem');
                if (notificationSystem) {
                    notificationSystem.classList.toggle('show');
                }
            }

            hideNotificationPanel() {
                const notificationSystem = document.getElementById('notificationSystem');
                if (notificationSystem) {
                    notificationSystem.classList.remove('show');
                }
            }

            toggleSettingsPanel() {
                const notificationSettings = document.getElementById('notificationSettings');
                if (notificationSettings) {
                    notificationSettings.classList.toggle('show');
                }
            }

            hideSettingsPanel() {
                const notificationSettings = document.getElementById('notificationSettings');
                if (notificationSettings) {
                    notificationSettings.classList.remove('show');
                }
            }

            showBrowserNotification(notification) {
                if (!this.settings.browserNotifications || !('Notification' in window)) return;
                
                if (Notification.permission === 'granted') {
                    const browserNotification = new Notification(notification.title, {
                        body: notification.message,
                        icon: '/favicon.ico',
                        tag: notification.id
                    });

                    browserNotification.onclick = () => {
                        this.handleNotificationClick(notification);
                        window.focus();
                    };
                }
            }

            showUrgentDeadlineAlert(notification, opportunity) {
                const modal = document.getElementById('deadlineAlertModal');
                const message = document.getElementById('deadlineAlertMessage');
                
                if (modal && message) {
                    message.textContent = notification.message;
                    modal.classList.add('show');
                    
                    // Store current opportunity for action buttons
                    this.currentAlertOpportunity = opportunity;
                    this.currentAlertNotification = notification;
                }
            }

            hideDeadlineAlert() {
                const modal = document.getElementById('deadlineAlertModal');
                if (modal) {
                    modal.classList.remove('show');
                }
            }

            viewOpportunity() {
                if (this.currentAlertOpportunity) {
                    this.showOpportunity(this.currentAlertOpportunity);
                    this.hideDeadlineAlert();
                }
            }

            snoozeDeadline() {
                if (this.currentAlertNotification) {
                    // Remove current notification and create a new one for 24 hours later
                    this.deleteNotification(this.currentAlertNotification.id);
                    
                    const snoozeTime = new Date();
                    snoozeTime.setHours(snoozeTime.getHours() + 24);
                    
                    // You could implement more sophisticated snooze logic here
                    this.hideDeadlineAlert();
                    showNotification('Reminder snoozed for 24 hours');
                }
            }

            dismissDeadline() {
                if (this.currentAlertNotification) {
                    this.markAsRead(this.currentAlertNotification.id);
                    this.hideDeadlineAlert();
                }
            }

            showOpportunity(opportunity) {
                // Show opportunity details
                showOpportunityDetails(opportunity);
                this.hideDeadlineAlert();
            }

            hasBeenNotified(notificationId) {
                const notified = localStorage.getItem(`notified_${notificationId}`);
                return notified === 'true';
            }

            markAsNotified(notificationId) {
                localStorage.setItem(`notified_${notificationId}`, 'true');
                
                // Auto-expire the "notified" marker after deadline passes
                const expireTime = new Date();
                expireTime.setDate(expireTime.getDate() + 30); // 30 days from now
                localStorage.setItem(`notified_expire_${notificationId}`, expireTime.toISOString());
            }

            // Clean up expired notification markers
            cleanupExpiredMarkers() {
                const now = new Date();
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith('notified_expire_')) {
                        const expireTime = new Date(localStorage.getItem(key));
                        if (expireTime < now) {
                            const notificationId = key.replace('notified_expire_', '');
                            localStorage.removeItem(key);
                            localStorage.removeItem(`notified_${notificationId}`);
                        }
                    }
                }
            }
        }

        // Utility function to calculate time remaining
        function calculateTimeRemaining(deadline) {
            const now = new Date();
            const deadlineDate = new Date(deadline);
            const diffTime = deadlineDate - now;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays < 0) {
                return { text: 'Expired', class: 'expired' };
            } else if (diffDays === 0) {
                return { text: 'Today', class: 'urgent' };
            } else if (diffDays === 1) {
                return { text: '1 day', class: 'urgent' };
            } else if (diffDays < 7) {
                return { text: `${diffDays} days`, class: 'urgent' };
            } else if (diffDays < 30) {
                const weeks = Math.floor(diffDays / 7);
                const days = diffDays % 7;
                let text = `${weeks} week${weeks > 1 ? 's' : ''}`;
                if (days > 0) {
                    text += `, ${days} day${days > 1 ? 's' : ''}`;
                }
                return { text, class: 'warning' };
            } else {
                const months = Math.floor(diffDays / 30);
                const days = diffDays % 30;
                let text = `${months} month${months > 1 ? 's' : ''}`;
                if (days > 0) {
                    text += `, ${days} day${days > 1 ? 's' : ''}`;
                }
                return { text, class: 'normal' };
            }
        }

        // Show opportunity details modal
        function showOpportunityDetails(opportunity) {
            const detailsModal = document.getElementById('detailsModal');
            const detailsTitle = document.getElementById('detailsTitle');
            const detailsDescription = document.getElementById('detailsDescription');
            const detailsOrganization = document.getElementById('detailsOrganization');
            const detailsType = document.getElementById('detailsType');
            const detailsLocation = document.getElementById('detailsLocation');
            const detailsDeadline = document.getElementById('detailsDeadline');
            const detailsCompensation = document.getElementById('detailsCompensation');
            const detailsImpact = document.getElementById('detailsImpact');
            const detailsApplyLink = document.getElementById('detailsApplyLink');
            const detailsSaveBtn = document.getElementById('detailsSaveBtn');
            
            if (!detailsModal) return;
            
            // Set opportunity details
            detailsTitle.textContent = opportunity.title;
            detailsDescription.textContent = opportunity.description;
            detailsOrganization.textContent = opportunity.organization;
            detailsType.textContent = getOpportunityTypeText(opportunity.type);
            detailsLocation.textContent = opportunity.location;
            detailsDeadline.textContent = formatDate(opportunity.deadline);
            detailsCompensation.textContent = getCompensationText(opportunity);
            detailsImpact.textContent = opportunity.impact;
            detailsApplyLink.href = opportunity.applyLink;
            
            // Check if opportunity is already saved
            const isSaved = userOpportunities.pending.some(item => item.id === opportunity.id) || 
                           userOpportunities.completed.some(item => item.id === opportunity.id);
            
            // Update save button
            if (isSaved) {
                detailsSaveBtn.innerHTML = '<i class="fas fa-bookmark"></i> Remove from Dashboard';
                detailsSaveBtn.classList.add('saved');
            } else {
                detailsSaveBtn.innerHTML = '<i class="far fa-bookmark"></i> Save to Dashboard';
                detailsSaveBtn.classList.remove('saved');
            }
            
            // Store current opportunity for save button functionality
            currentOpportunityDetails = opportunity;
            
            // Show modal
            detailsModal.classList.add('show');
        }

        // Close opportunity details modal
        function closeOpportunityDetails() {
            const detailsModal = document.getElementById('detailsModal');
            if (detailsModal) {
                detailsModal.classList.remove('show');
            }
        }

        // Wait for DOM to be fully loaded before accessing elements
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const loginBtn = document.getElementById('loginBtn');
            const signupBtn = document.getElementById('signupBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            const authModal = document.getElementById('authModal');
            const authTabs = document.querySelectorAll('.auth-tab');
            const loginForm = document.getElementById('loginForm');
            const signupForm = document.getElementById('signupForm');
            const doLogin = document.getElementById('doLogin');
            const doSignup = document.getElementById('doSignup');
            const loginError = document.getElementById('loginError');
            const signupError = document.getElementById('signupError');
            const notification = document.getElementById('notification');
            const opportunitiesGrid = document.getElementById('opportunitiesGrid');
            const dashboard = document.getElementById('dashboard');
            const adminPanel = document.getElementById('adminPanel');
            const navDashboard = document.querySelector('.nav-dashboard');
            const navHome = document.querySelector('.nav-home');
            const navOpportunities = document.querySelector('.nav-opportunities');
            const navAdmin = document.querySelector('.nav-admin');
            const heroSection = document.getElementById('heroSection');
            const filtersSection = document.getElementById('filtersSection');
            const opportunitiesTitle = document.getElementById('opportunitiesTitle');
            const searchInput = document.getElementById('searchInput');
            const searchBtn = document.getElementById('searchBtn');
            const applyFiltersBtn = document.getElementById('applyFilters');
            const resetFiltersBtn = document.getElementById('resetFilters');
            const pendingOpportunities = document.getElementById('pendingOpportunities');
            const completedOpportunities = document.getElementById('completedOpportunities');
            const dashboardTabs = document.querySelectorAll('.dashboard-tab');
            const addOpportunityBtn = document.getElementById('addOpportunityBtn');
            const adminModal = document.getElementById('adminModal');
            const adminModalTitle = document.getElementById('adminModalTitle');
            const adminOpportunityForm = document.getElementById('adminOpportunityForm');
            const adminCancelBtn = document.getElementById('adminCancelBtn');
            const adminOpportunitiesList = document.getElementById('adminOpportunitiesList');
            const googleSignIn = document.getElementById('googleSignIn');
            const googleSignUp = document.getElementById('googleSignUp');
            const passwordResetLink = document.getElementById('passwordResetLink');
            const notificationSettingsBtn = document.getElementById('notificationSettingsBtn');
            const detailsModal = document.getElementById('detailsModal');
            const detailsClose = document.getElementById('detailsClose');
            const detailsSaveBtn = document.getElementById('detailsSaveBtn');

            // Event Listeners
            if (loginBtn) loginBtn.addEventListener('click', () => showAuthModal('login'));
            if (signupBtn) signupBtn.addEventListener('click', () => showAuthModal('signup'));
            if (logoutBtn) logoutBtn.addEventListener('click', handleLogout);
            
            if (authTabs) {
                authTabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        const tabName = tab.getAttribute('data-tab');
                        switchAuthTab(tabName);
                    });
                });
            }
            
            if (doLogin) doLogin.addEventListener('click', handleLogin);
            if (doSignup) doSignup.addEventListener('click', handleSignup);
            
            if (navDashboard) {
                navDashboard.addEventListener('click', (e) => {
                    e.preventDefault();
                    showDashboard();
                });
            }
            
            if (navHome) {
                navHome.addEventListener('click', (e) => {
                    e.preventDefault();
                    showHome();
                });
            }
            
            if (navOpportunities) {
                navOpportunities.addEventListener('click', (e) => {
                    e.preventDefault();
                    showOpportunities();
                });
            }
            
            if (navAdmin) {
                navAdmin.addEventListener('click', (e) => {
                    e.preventDefault();
                    showAdminPanel();
                });
            }

            if (searchBtn) searchBtn.addEventListener('click', applySearchFilter);
            if (searchInput) {
                searchInput.addEventListener('keyup', (e) => {
                    if (e.key === 'Enter') applySearchFilter();
                });
            }

            if (applyFiltersBtn) applyFiltersBtn.addEventListener('click', applyFilters);
            if (resetFiltersBtn) resetFiltersBtn.addEventListener('click', resetFilters);

            if (dashboardTabs) {
                dashboardTabs.forEach(tab => {
                    tab.addEventListener('click', () => {
                        const tabName = tab.getAttribute('data-tab');
                        switchDashboardTab(tabName);
                    });
                });
            }

            if (addOpportunityBtn) addOpportunityBtn.addEventListener('click', () => showAdminModal());
            if (adminCancelBtn) adminCancelBtn.addEventListener('click', () => adminModal.style.display = 'none');
            if (adminOpportunityForm) adminOpportunityForm.addEventListener('submit', handleAdminFormSubmit);

            // Google Sign-In/Sign-Up buttons
            if (googleSignIn) googleSignIn.addEventListener('click', () => handleGoogleSignIn());
            if (googleSignUp) googleSignUp.addEventListener('click', () => handleGoogleSignIn());
            
            // Password reset link
            if (passwordResetLink) passwordResetLink.addEventListener('click', handlePasswordReset);
            
            // Details modal
            if (detailsClose) detailsClose.addEventListener('click', closeOpportunityDetails);
            if (detailsSaveBtn) detailsSaveBtn.addEventListener('click', handleDetailsSave);

            // Close modals when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === authModal) {
                    authModal.style.display = 'none';
                }
                if (e.target === adminModal) {
                    adminModal.style.display = 'none';
                }
                if (e.target === detailsModal) {
                    closeOpportunityDetails();
                }
            });

            // Check auth state
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    // User is signed in
                    if (loginBtn) loginBtn.style.display = 'none';
                    if (signupBtn) signupBtn.style.display = 'none';
                    if (logoutBtn) logoutBtn.style.display = 'block';
                    if (notificationSettingsBtn) notificationSettingsBtn.style.display = 'block';
                    
                    // Check if user is admin using Firebase rules
                    checkAdminStatus(user.uid).then(adminStatus => {
                        isAdminUser = adminStatus;
                        if (navAdmin) {
                            navAdmin.style.display = isAdminUser ? 'list-item' : 'none';
                        }
                    });
                    
                    // Load user's saved opportunities
                    loadUserOpportunities(user.uid);
                    
                    // Initialize notification manager for ALL users (not just admins)
                    notificationManager = new NotificationManager();
                    notificationManager.loadNotifications();
                    
                    // Show notification bell for ALL users
                    const notificationBell = document.getElementById('notificationBell');
                    if (notificationBell) {
                        notificationBell.style.display = 'list-item';
                    }
                } else {
                    // User is signed out
                    if (loginBtn) loginBtn.style.display = 'block';
                    if (signupBtn) signupBtn.style.display = 'block';
                    if (logoutBtn) logoutBtn.style.display = 'none';
                    if (notificationSettingsBtn) notificationSettingsBtn.style.display = 'none';
                    if (navAdmin) navAdmin.style.display = 'none';
                    
                    // Hide dashboard and admin panel if user is not logged in
                    if (dashboard) dashboard.style.display = 'none';
                    if (adminPanel) adminPanel.style.display = 'none';
                    
                    // Reset admin status
                    isAdminUser = false;
                    
                    // Remove the user opportunities listener when logging out
                    if (userOpportunitiesListener) {
                        userOpportunitiesListener();
                        userOpportunitiesListener = null;
                    }
                    
                    // Hide notification bell
                    const notificationBell = document.getElementById('notificationBell');
                    if (notificationBell) {
                        notificationBell.style.display = 'none';
                    }
                }
            });

            // Initialize the app
            initApp();

            // Check if user is admin using Firebase rules
            async function checkAdminStatus(userId) {
                try {
                    const adminRef = ref(database, `admins/${userId}`);
                    const snapshot = await get(adminRef);
                    return snapshot.exists();
                } catch (error) {
                    console.error('Error checking admin status:', error);
                    return false;
                }
            }

            // Load opportunities from Firebase
            function loadOpportunitiesFromFirebase() {
                const opportunitiesRef = ref(database, 'opportunities');
                
                onValue(opportunitiesRef, (snapshot) => {
                    const data = snapshot.val();
                    allOpportunities = [];
                    
                    if (data) {
                        for (const key in data) {
                            allOpportunities.push({
                                id: key,
                                ...data[key]
                            });
                        }
                    }
                    
                    // Apply current filters
                    applyFilters();
                    
                    // Render admin opportunities if admin panel is visible
                    if (adminPanel.style.display === 'block') {
                        renderAdminOpportunities();
                    }
                });
            }

            // Render opportunities to the grid
            function renderOpportunities() {
                if (!opportunitiesGrid) return;
                
                opportunitiesGrid.innerHTML = '';
                
                if (filteredOpportunities.length === 0) {
                    opportunitiesGrid.innerHTML = '<p class="no-results">No opportunities match your filters. Try adjusting your search criteria.</p>';
                    return;
                }
                
                filteredOpportunities.forEach(opp => {
                    const isSaved = userOpportunities.pending.some(item => item.id === opp.id) || 
                                   userOpportunities.completed.some(item => item.id === opp.id);
                    
                    const isExpired = isOpportunityExpired(opp.deadline);
                    const isUrgent = isDeadlineUrgent(opp.deadline);
                    const timeRemaining = calculateTimeRemaining(opp.deadline);
                    
                    const opportunityCard = document.createElement('div');
                    opportunityCard.className = `opportunity-card ${isExpired ? 'expired' : ''}`;
                    opportunityCard.innerHTML = `
                        <div class="card-header">
                            <span class="opportunity-type ${opp.type}">${getOpportunityTypeText(opp.type)}</span>
                            <h3>${opp.title}</h3>
                            <p class="organization">${opp.organization}</p>
                        </div>
                        
                        <div class="card-body">
                            <div class="detail">
                                <i class="fas fa-money-bill-wave"></i>
                                <span>${getCompensationText(opp)}</span>
                            </div>
                            <div class="detail">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>${opp.location}</span>
                            </div>
                            <div class="detail">
                                <i class="fas fa-calendar-alt"></i>
                                <span class="deadline ${isUrgent ? 'urgent' : ''}">Deadline: ${formatDate(opp.deadline)} 
                                    <span class="time-remaining ${timeRemaining.class}">${timeRemaining.text}</span>
                                </span>
                            </div>
                            <div class="detail">
                                <i class="fas fa-chart-line"></i>
                                <span>Impact: ${opp.impact}</span>
                            </div>
                            <p>${opp.description.substring(0, 150)}${opp.description.length > 150 ? '...' : ''}</p>
                        </div>
                        
                        <div class="card-footer">
                            <div class="card-actions">
                                <div class="left-actions">
                                    <button class="save-btn ${isSaved ? 'saved' : ''}" data-id="${opp.id}" title="${isSaved ? 'Remove from dashboard' : 'Save to dashboard'}">
                                        <i class="${isSaved ? 'fas' : 'far'} fa-bookmark"></i>
                                    </button>
                                </div>
                                <div class="right-actions">
                                    <button class="details-btn" data-id="${opp.id}">View Details</button>
                                    <a href="${opp.applyLink}" target="_blank" class="apply-link">Apply Now</a>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    opportunitiesGrid.appendChild(opportunityCard);
                    
                    // Add event listeners to save buttons
                    const saveButton = opportunityCard.querySelector('.save-btn');
                    saveButton.addEventListener('click', function() {
                        const user = auth.currentUser;
                        if (user) {
                            const oppId = this.getAttribute('data-id');
                            const opportunity = allOpportunities.find(opp => opp.id === oppId);
                            if (this.classList.contains('saved')) {
                                removeOpportunity(user.uid, opportunity);
                            } else {
                                saveOpportunity(user.uid, opportunity);
                            }
                        } else {
                            showAuthModal('login');
                            showNotification('Please sign in to save opportunities', 'warning');
                        }
                    });
                    
                    // Add event listener to details button
                    const detailsButton = opportunityCard.querySelector('.details-btn');
                    detailsButton.addEventListener('click', function() {
                        const oppId = this.getAttribute('data-id');
                        const opportunity = allOpportunities.find(opp => opp.id === oppId);
                        showOpportunityDetails(opportunity);
                    });
                });
            }

            // Handle details modal save button
            function handleDetailsSave() {
                const user = auth.currentUser;
                if (user && currentOpportunityDetails) {
                    if (detailsSaveBtn.classList.contains('saved')) {
                        removeOpportunity(user.uid, currentOpportunityDetails);
                    } else {
                        saveOpportunity(user.uid, currentOpportunityDetails);
                    }
                } else {
                    showAuthModal('login');
                    showNotification('Please sign in to save opportunities', 'warning');
                }
            }

            // Render admin opportunities
            function renderAdminOpportunities() {
                if (!adminOpportunitiesList) return;
                
                adminOpportunitiesList.innerHTML = '';
                
                if (allOpportunities.length === 0) {
                    adminOpportunitiesList.innerHTML = '<tr><td colspan="5" style="text-align: center;">No opportunities found</td></tr>';
                    return;
                }
                
                allOpportunities.forEach(opp => {
                    const timeRemaining = calculateTimeRemaining(opp.deadline);
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${opp.title}</td>
                        <td>${opp.organization}</td>
                        <td>${getOpportunityTypeText(opp.type)}</td>
                        <td>${formatDate(opp.deadline)} <span class="time-remaining ${timeRemaining.class}">${timeRemaining.text}</span></td>
                        <td class="admin-actions-cell">
                            <button class="admin-btn edit-btn" data-id="${opp.id}">Edit</button>
                            <button class="admin-btn delete-btn" data-id="${opp.id}">Delete</button>
                        </td>
                    `;
                    
                    adminOpportunitiesList.appendChild(row);
                    
                    // Add event listeners to edit and delete buttons
                    const editButton = row.querySelector('.edit-btn');
                    editButton.addEventListener('click', function() {
                        const oppId = this.getAttribute('data-id');
                        const opportunity = allOpportunities.find(opp => opp.id === oppId);
                        showAdminModal(opportunity);
                    });
                    
                    const deleteButton = row.querySelector('.delete-btn');
                    deleteButton.addEventListener('click', function() {
                        const oppId = this.getAttribute('data-id');
                        deleteOpportunity(oppId);
                    });
                });
            }

            // Check if opportunity is expired
            function isOpportunityExpired(deadline) {
                const today = new Date();
                const deadlineDate = new Date(deadline);
                return deadlineDate < today;
            }

            // Check if deadline is urgent (within 7 days)
            function isDeadlineUrgent(deadline) {
                const today = new Date();
                const deadlineDate = new Date(deadline);
                const diffTime = deadlineDate - today;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                return diffDays <= 7 && diffDays >= 0;
            }

            // Get opportunity type text
            function getOpportunityTypeText(type) {
                switch(type) {
                    case 'internship': return 'Internship';
                    case 'research': return 'Research';
                    case 'summer': return 'Summer Program';
                    case 'volunteer': return 'Volunteer';
                    default: return type;
                }
            }

            // Get compensation text
            function getCompensationText(opp) {
                if (opp.paid && opp.amount) return `Paid - ${opp.amount}`;
                if (opp.stipend && opp.amount) return `Stipend - ${opp.amount}`;
                if (opp.scholarship) return 'Scholarship Available';
                return 'Unpaid';
            }

            // Format date
            function formatDate(dateString) {
                const options = { year: 'numeric', month: 'short', day: 'numeric' };
                return new Date(dateString).toLocaleDateString(undefined, options);
            }

            // Show auth modal
            function showAuthModal(tab) {
                if (!authModal) return;
                authModal.style.display = 'flex';
                switchAuthTab(tab);
            }

            // Switch auth tab
            function switchAuthTab(tabName) {
                if (!authTabs || !loginForm || !signupForm) return;
                
                // Update tabs
                authTabs.forEach(tab => {
                    if (tab.getAttribute('data-tab') === tabName) {
                        tab.classList.add('active');
                    } else {
                        tab.classList.remove('active');
                    }
                });
                
                // Update forms
                if (tabName === 'login') {
                    loginForm.classList.add('active');
                    signupForm.classList.remove('active');
                } else {
                    loginForm.classList.remove('active');
                    signupForm.classList.add('active');
                }
                
                // Clear errors
                if (loginError) loginError.style.display = 'none';
                if (signupError) signupError.style.display = 'none';
            }

            // Handle login
            function handleLogin() {
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                if (!email || !password) {
                    if (loginError) {
                        loginError.textContent = 'Please enter both email and password';
                        loginError.style.display = 'block';
                    }
                    return;
                }
                
                signInWithEmailAndPassword(auth, email, password)
                    .then((userCredential) => {
                        // Signed in 
                        if (authModal) authModal.style.display = 'none';
                        showNotification('Successfully logged in!');
                    })
                    .catch((error) => {
                        if (loginError) {
                            let errorMessage = error.message;
                            // Make error messages more user-friendly
                            if (error.code === 'auth/invalid-email') {
                                errorMessage = 'Invalid email address format';
                            } else if (error.code === 'auth/user-not-found') {
                                errorMessage = 'No account found with this email';
                            } else if (error.code === 'auth/wrong-password') {
                                errorMessage = 'Incorrect password';
                            } else if (error.code === 'auth/invalid-credential') {
                                errorMessage = 'Invalid credentials';
                            }
                            loginError.textContent = errorMessage;
                            loginError.style.display = 'block';
                        }
                    });
            }

            // Handle signup
            function handleSignup() {
                const name = document.getElementById('signupName').value;
                const email = document.getElementById('signupEmail').value;
                const password = document.getElementById('signupPassword').value;
                const confirm = document.getElementById('signupConfirm').value;
                
                // Basic validation
                if (!name || !email || !password || !confirm) {
                    if (signupError) {
                        signupError.textContent = 'Please fill in all fields';
                        signupError.style.display = 'block';
                    }
                    return;
                }
                
                if (password !== confirm) {
                    if (signupError) {
                        signupError.textContent = 'Passwords do not match';
                        signupError.style.display = 'block';
                    }
                    return;
                }
                
                if (password.length < 6) {
                    if (signupError) {
                        signupError.textContent = 'Password should be at least 6 characters';
                        signupError.style.display = 'block';
                    }
                    return;
                }
                
                createUserWithEmailAndPassword(auth, email, password)
                    .then((userCredential) => {
                        // Signed up 
                        const user = userCredential.user;
                        
                        // Save user profile
                        set(ref(database, 'users/' + user.uid), {
                            name: name,
                            email: email,
                            createdAt: new Date().toISOString()
                        });

                        // After creating the user, check if it's an admin account
                        const adminEmails = ['boymirzayevismoiljon@gmail.com', 'ibaymirzayev@gmail.com'];
                        
                        if (adminEmails.includes(email)) {
                            // Add user ID to the admins list
                            set(ref(database, `admins/${user.uid}`), true);
                        }

                        if (authModal) authModal.style.display = 'none';
                        showNotification('Account created successfully!');
                    })
                    .catch((error) => {
                        if (signupError) {
                            let errorMessage = error.message;
                            // Make error messages more user-friendly
                            if (error.code === 'auth/email-already-in-use') {
                                errorMessage = 'An account with this email already exists';
                            } else if (error.code === 'auth/invalid-email') {
                                errorMessage = 'Invalid email address format';
                            } else if (error.code === 'auth/weak-password') {
                                errorMessage = 'Password is too weak';
                            }
                            signupError.textContent = errorMessage;
                            signupError.style.display = 'block';
                        }
                    });
            }

            // Handle Google Sign-In
            function handleGoogleSignIn() {
                signInWithPopup(auth, googleProvider)
                    .then((result) => {
                        // This gives you a Google Access Token
                        const credential = GoogleAuthProvider.credentialFromResult(result);
                        const token = credential.accessToken;
                        
                        // The signed-in user info
                        const user = result.user;
                        
                        // Check if user exists in database
                        const userRef = ref(database, 'users/' + user.uid);
                        
                        get(userRef).then((snapshot) => {
                            if (!snapshot.exists()) {
                                // User doesn't exist, create a new user record
                                set(userRef, {
                                    name: user.displayName,
                                    email: user.email,
                                    createdAt: new Date().toISOString(),
                                    isGoogleUser: true
                                });
                                
                                // Check if user should be admin
                                const adminEmails = ['boymirzayevismoiljon@gmail.com', 'ibaymirzayev@gmail.com'];
                                if (adminEmails.includes(user.email)) {
                                    set(ref(database, `admins/${user.uid}`), true);
                                }
                            }
                            
                            // Close auth modal and show success notification
                            if (authModal) authModal.style.display = 'none';
                            showNotification('Successfully signed in with Google!');
                        });
                    })
                    .catch((error) => {
                        // Handle Errors here
                        const errorCode = error.code;
                        const errorMessage = error.message;
                        const email = error.customData?.email;
                        const credential = GoogleAuthProvider.credentialFromError(error);
                        
                        // Show error in appropriate form
                        const currentTab = document.querySelector('.auth-tab.active').getAttribute('data-tab');
                        if (currentTab === 'login' && loginError) {
                            loginError.textContent = errorMessage;
                            loginError.style.display = 'block';
                        } else if (currentTab === 'signup' && signupError) {
                            signupError.textContent = errorMessage;
                            signupError.style.display = 'block';
                        }
                    });
            }

            // Check if email exists
            async function checkEmailExists(email) {
                try {
                    const signInMethods = await fetchSignInMethodsForEmail(auth, email);
                    return signInMethods.length > 0;
                } catch (error) {
                    console.error('Error checking email:', error);
                    return false;
                }
            }

            // Handle password reset
            async function handlePasswordReset() {
                const email = document.getElementById('loginEmail').value;
                
                if (!email) {
                    showNotification('Please enter your email address first', 'warning');
                    return;
                }
                
                // Basic email format validation
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    if (loginError) {
                        loginError.textContent = 'Please enter a valid email address';
                        loginError.style.display = 'block';
                    }
                    return;
                }
                
                try {
                    // Check if email exists in Firebase Auth
                    const emailExists = await checkEmailExists(email);
                    
                    if (!emailExists) {
                        if (loginError) {
                            loginError.textContent = 'This email is not registered with us';
                            loginError.style.display = 'block';
                        }
                        return;
                    }
                    
                    // If email exists, send password reset email
                    await sendPasswordResetEmail(auth, email);
                    showNotification('Password reset email sent. Check your inbox or spam folder.', 'success');
                    
                    // Clear any previous errors
                    if (loginError) {
                        loginError.style.display = 'none';
                    }
                } catch (error) {
                    console.error('Password reset error:', error);
                    if (loginError) {
                        loginError.textContent = error.message;
                        loginError.style.display = 'block';
                    }
                }
            }

            // Handle logout
            function handleLogout() {
                // Remove the listener when logging out
                if (userOpportunitiesListener) {
                    userOpportunitiesListener();
                    userOpportunitiesListener = null;
                }
                
                signOut(auth)
                    .then(() => {
                        showNotification('Successfully logged out');
                    })
                    .catch((error) => {
                        console.error('Logout error:', error);
                    });
            }

            // Save opportunity to user's dashboard
            function saveOpportunity(userId, opportunity) {
                const userOppRef = ref(database, `userOpportunities/${userId}/${opportunity.id}`);
                
                // Check if already saved in local state
                const alreadySaved = userOpportunities.pending.some(opp => opp.id === opportunity.id) || 
                                    userOpportunities.completed.some(opp => opp.id === opportunity.id);
                
                if (alreadySaved) {
                    showNotification('This opportunity is already in your dashboard!', 'warning');
                    return;
                }
                
                // Store only a reference to the opportunity, not the full object
                set(userOppRef, {
                    opportunityId: opportunity.id,
                    savedAt: new Date().toISOString(),
                    status: 'pending'
                })
                .then(() => {
                    showNotification('Opportunity saved to your dashboard!');
                    
                    // Update the details modal save button if it's open for this opportunity
                    if (currentOpportunityDetails && currentOpportunityDetails.id === opportunity.id) {
                        const detailsSaveBtn = document.getElementById('detailsSaveBtn');
                        if (detailsSaveBtn) {
                            detailsSaveBtn.innerHTML = '<i class="fas fa-bookmark"></i> Remove from Dashboard';
                            detailsSaveBtn.classList.add('saved');
                        }
                    }
                })
                .catch((error) => {
                    console.error('Error saving opportunity:', error);
                });
            }

            // Remove opportunity from user's dashboard
            function removeOpportunity(userId, opportunity) {
                const userOppRef = ref(database, `userOpportunities/${userId}/${opportunity.id}`);
                
                remove(userOppRef)
                .then(() => {
                    showNotification('Opportunity removed from your dashboard');
                    
                    // Update the details modal save button if it's open for this opportunity
                    if (currentOpportunityDetails && currentOpportunityDetails.id === opportunity.id) {
                        const detailsSaveBtn = document.getElementById('detailsSaveBtn');
                        if (detailsSaveBtn) {
                            detailsSaveBtn.innerHTML = '<i class="far fa-bookmark"></i> Save to Dashboard';
                            detailsSaveBtn.classList.remove('saved');
                        }
                    }
                })
                .catch((error) => {
                    console.error('Error removing opportunity:', error);
                });
            }

            // Load user's saved opportunities
            function loadUserOpportunities(userId) {
                // Remove previous listener if it exists
                if (userOpportunitiesListener) {
                    userOpportunitiesListener();
                }
                
                const userOppRef = ref(database, `userOpportunities/${userId}`);
                
                // Set up the listener and store it for potential cleanup
                userOpportunitiesListener = onValue(userOppRef, (snapshot) => {
                    const data = snapshot.val();
                    
                    // Always reset the arrays completely
                    userOpportunities.pending = [];
                    userOpportunities.completed = [];
                    
                    if (data) {
                        // Create a map of all opportunities for quick lookup
                        const opportunityMap = {};
                        allOpportunities.forEach(opp => {
                            opportunityMap[opp.id] = opp;
                        });
                        
                        for (const key in data) {
                            const savedOpp = data[key];
                            const opportunityId = savedOpp.opportunityId || key;
                            const fullOpportunity = opportunityMap[opportunityId];
                            
                            if (fullOpportunity) {
                                const opportunityWithStatus = {
                                    ...fullOpportunity,
                                    savedAt: savedOpp.savedAt,
                                    status: savedOpp.status || 'pending'
                                };
                                
                                if (savedOpp.status === 'completed') {
                                    userOpportunities.completed.push(opportunityWithStatus);
                                } else {
                                    userOpportunities.pending.push(opportunityWithStatus);
                                }
                            }
                        }
                    }
                    
                    renderOpportunities();
                    renderDashboardOpportunities();
                });
            }

            // Render dashboard opportunities
            function renderDashboardOpportunities() {
                // Render pending opportunities
                if (pendingOpportunities) {
                    if (userOpportunities.pending.length === 0) {
                        pendingOpportunities.innerHTML = `
                            <div class="empty-state">
                                <i class="far fa-bookmark"></i>
                                <h3>No pending opportunities</h3>
                                <p>Save opportunities to your dashboard to track them here</p>
                            </div>
                        `;
                    } else {
                        pendingOpportunities.innerHTML = '';
                        userOpportunities.pending.forEach(opp => {
                            const oppElement = createDashboardOpportunityElement(opp, 'pending');
                            pendingOpportunities.appendChild(oppElement);
                        });
                    }
                }
                
                // Render completed opportunities
                if (completedOpportunities) {
                    if (userOpportunities.completed.length === 0) {
                        completedOpportunities.innerHTML = `
                            <div class="empty-state">
                                <i class="far fa-check-circle"></i>
                                <h3>No completed opportunities</h3>
                                <p>Mark opportunities as complete to track your achievements</p>
                            </div>
                        `;
                    } else {
                        completedOpportunities.innerHTML = '';
                        userOpportunities.completed.forEach(opp => {
                            const oppElement = createDashboardOpportunityElement(opp, 'completed');
                            completedOpportunities.appendChild(oppElement);
                        });
                    }
                }
            }

            // Create dashboard opportunity element
            function createDashboardOpportunityElement(opportunity, status) {
                const isExpired = isOpportunityExpired(opportunity.deadline);
                const isUrgent = isDeadlineUrgent(opportunity.deadline);
                const timeRemaining = calculateTimeRemaining(opportunity.deadline);
                
                const element = document.createElement('div');
                element.className = `opportunity-card ${isExpired ? 'expired' : ''}`;
                element.innerHTML = `
                    <div class="card-header">
                        <span class="opportunity-type ${opportunity.type}">${getOpportunityTypeText(opportunity.type)}</span>
                        <h3>${opportunity.title}</h3>
                        <p class="organization">${opportunity.organization}</p>
                    </div>
                    
                    <div class="card-body">
                        <div class="detail">
                            <i class="fas fa-money-bill-wave"></i>
                            <span>${getCompensationText(opportunity)}</span>
                        </div>
                        <div class="detail">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>${opportunity.location}</span>
                        </div>
                        <div class="detail">
                            <i class="fas fa-calendar-alt"></i>
                            <span class="deadline ${isUrgent ? 'urgent' : ''}">Deadline: ${formatDate(opportunity.deadline)} 
                                <span class="time-remaining ${timeRemaining.class}">${timeRemaining.text}</span>
                            </span>
                        </div>
                        <div class="detail">
                            <i class="fas fa-chart-line"></i>
                            <span>Impact: ${opportunity.impact}</span>
                        </div>
                        <p>${opportunity.description}</p>
                    </div>
                    
                    <div class="card-footer">
                        <div class="card-actions">
                            <div class="left-actions">
                                <button class="save-btn saved" data-id="${opportunity.id}" title="Remove from dashboard">
                                    <i class="fas fa-bookmark"></i>
                                </button>
                            </div>
                            <div class="right-actions">
                                <button class="details-btn" data-id="${opportunity.id}">View Details</button>
                                <a href="${opportunity.applyLink}" target="_blank" class="apply-link">Apply Now</a>
                                ${status === 'pending' ? 
                                `<button class="apply-link complete-btn" data-id="${opportunity.id}">Mark as Complete</button>` : 
                                `<span class="completed-badge">Completed</span>`}
                            </div>
                        </div>
                    </div>
                `;
                
                // Add event listener to remove button
                const removeBtn = element.querySelector('.save-btn');
                removeBtn.addEventListener('click', function() {
                    const user = auth.currentUser;
                    if (user) {
                        removeOpportunity(user.uid, opportunity);
                    }
                });
                
                // Add event listener to details button
                const detailsBtn = element.querySelector('.details-btn');
                detailsBtn.addEventListener('click', function() {
                    showOpportunityDetails(opportunity);
                });
                
                // Add event listener to complete button
                if (status === 'pending') {
                    const completeBtn = element.querySelector('.complete-btn');
                    completeBtn.addEventListener('click', function() {
                        const user = auth.currentUser;
                        if (user) {
                            markAsComplete(user.uid, opportunity);
                        }
                    });
                }
                
                return element;
            }

            // Mark opportunity as complete
            function markAsComplete(userId, opportunity) {
                const userOppRef = ref(database, `userOpportunities/${userId}/${opportunity.id}`);
                update(userOppRef, {
                    status: 'completed',
                    completedAt: new Date().toISOString()
                })
                .then(() => showNotification('Opportunity marked as complete!'))
                .catch((error) => console.error('Error updating opportunity:', error));
            }

            // Apply filters
            function applyFilters() {
                const fieldFilter = document.getElementById('field').value;
                const typeFilter = document.getElementById('type').value;
                const compensationFilter = document.getElementById('compensation').value;
                const deadlineFilter = document.getElementById('deadline').value;
                const impactFilter = document.getElementById('impact').value;
                const locationFilter = document.getElementById('location').value;
                const searchTerm = searchInput.value.toLowerCase();
                
                filteredOpportunities = allOpportunities.filter(opp => {
                    // Field filter
                    if (fieldFilter && opp.field !== fieldFilter) return false;
                    
                    // Type filter
                    if (typeFilter && opp.type !== typeFilter) return false;
                    
                    // Compensation filter
                    if (compensationFilter === 'paid' && !opp.paid) return false;
                    if (compensationFilter === 'unpaid' && (opp.paid || opp.stipend || opp.scholarship)) return false;
                    if (compensationFilter === 'stipend' && !opp.stipend) return false;
                    
                    // Impact filter
                    if (impactFilter && opp.impact && opp.impact.toLowerCase() !== impactFilter.toLowerCase()) return false;
                    
                    // Location filter - check if location contains the filter value
                    if (locationFilter && opp.location) {
                        const oppLocation = opp.location.toLowerCase();
                        if (locationFilter === 'remote' && !oppLocation.includes('remote')) return false;
                        if (locationFilter === 'onsite' && !oppLocation.includes('onsite') && 
                            !oppLocation.includes('on-site') && !oppLocation.includes('office')) return false;
                        if (locationFilter === 'hybrid' && !oppLocation.includes('hybrid')) return false;
                    
                    }
                    
                    // Search term filter
                    if (searchTerm && !(
                        (opp.title && opp.title.toLowerCase().includes(searchTerm)) ||
                        (opp.organization && opp.organization.toLowerCase().includes(searchTerm)) ||
                        (opp.description && opp.description.toLowerCase().includes(searchTerm)) ||
                        (opp.field && opp.field.toLowerCase().includes(searchTerm))
                    )) return false;
                    
                    // Deadline filter - check if deadline is within specified timeframe
                    if (deadlineFilter && opp.deadline) {
                        const today = new Date();
                        const oppDeadline = new Date(opp.deadline);
                        
                        // Skip expired opportunities for deadline filter
                        if (oppDeadline < today) return false;
                        
                        const diffTime = oppDeadline - today;
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        
                        if (deadlineFilter === 'week' && diffDays > 7) return false;
                        if (deadlineFilter === 'month' && diffDays > 30) return false;
                        if (deadlineFilter === '3months' && diffDays > 90) return false;
                    }
                    
                    return true;
                });
                
                renderOpportunities();
                showNotification(`Found ${filteredOpportunities.length} opportunities matching your filters`);
            }

            // Apply search filter
            function applySearchFilter() {
                applyFilters();
            }

            // Reset filters
            function resetFilters() {
                document.getElementById('field').value = '';
                document.getElementById('type').value = '';
                document.getElementById('compensation').value = '';
                document.getElementById('deadline').value = '';
                document.getElementById('impact').value = '';
                document.getElementById('location').value = '';
                if (searchInput) searchInput.value = '';
                
                filteredOpportunities = [...allOpportunities];
                renderOpportunities();
                showNotification('Filters reset');
            }

            // Check for approaching deadlines
            function checkDeadlines() {
                // This would check the user's saved opportunities for deadlines
                // and show notifications for approaching deadlines
                
                // For demo purposes, we'll just show a notification after 2 seconds
                setTimeout(() => {
                    showNotification('You have 3 opportunities with deadlines in the next week.', 'warning');
                }, 2000);
            }

            // Show notification
            function showNotification(message, type = 'success') {
                if (!notification) return;
                const notificationContent = notification.querySelector('.notification-content');
                
                // Update notification style based on type
                notification.className = 'notification';
                if (type === 'error') {
                    notification.classList.add('error');
                } else if (type === 'warning') {
                    notification.classList.add('warning');
                }
                
                if (message) {
                    notificationContent.innerHTML = `
                        <h4>${type === 'error' ? 'Error' : type === 'warning' ? 'Warning' : 'Success'}</h4>
                        <p>${message}</p>
                    `;
                }
                
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }

            // Show dashboard
            function showDashboard() {
                const user = auth.currentUser;
                if (user) {
                    // Hide other sections and show dashboard
                    if (heroSection) heroSection.style.display = 'none';
                    if (filtersSection) filtersSection.style.display = 'none';
                    if (opportunitiesTitle) opportunitiesTitle.style.display = 'none';
                    if (opportunitiesGrid) opportunitiesGrid.style.display = 'none';
                    if (adminPanel) adminPanel.style.display = 'none';
                    if (dashboard) dashboard.style.display = 'block';
                } else {
                    showAuthModal('login');
                    showNotification('Please sign in to view your dashboard', 'warning');
                }
            }

            // Show home page
            function showHome() {
                // Show all sections and hide dashboard and admin panel
                if (heroSection) heroSection.style.display = 'block';
                if (filtersSection) filtersSection.style.display = 'block';
                if (opportunitiesTitle) opportunitiesTitle.style.display = 'block';
                if (opportunitiesGrid) opportunitiesGrid.style.display = 'grid';
                if (dashboard) dashboard.style.display = 'none';
                if (adminPanel) adminPanel.style.display = 'none';
            }

            // Show opportunities page
            function showOpportunities() {
                showHome();
                // Additional logic for opportunities page could go here
            }

            // Show admin panel
            function showAdminPanel() {
                const user = auth.currentUser;
                if (user) {
                    // Check admin status using the stored variable
                    if (isAdminUser) {
                        // Hide other sections and show admin panel
                        if (heroSection) heroSection.style.display = 'none';
                        if (filtersSection) filtersSection.style.display = 'none';
                        if (opportunitiesTitle) opportunitiesTitle.style.display = 'none';
                        if (opportunitiesGrid) opportunitiesGrid.style.display = 'none';
                        if (dashboard) dashboard.style.display = 'none';
                        if (adminPanel) adminPanel.style.display = 'block';
                        
                        // Render admin opportunities
                        renderAdminOpportunities();
                    } else {
                        // Double-check admin status in case it wasn't loaded yet
                        checkAdminStatus(user.uid).then(adminStatus => {
                            if (adminStatus) {
                                isAdminUser = true;
                                if (navAdmin) navAdmin.style.display = 'list-item';
                                
                                // Hide other sections and show admin panel
                                if (heroSection) heroSection.style.display = 'none';
                                if (filtersSection) filtersSection.style.display = 'none';
                                if (opportunitiesTitle) opportunitiesTitle.style.display = 'none';
                                if (opportunitiesGrid) opportunitiesGrid.style.display = 'none';
                                if (dashboard) dashboard.style.display = 'none';
                                if (adminPanel) adminPanel.style.display = 'block';
                                
                                // Render admin opportunities
                                renderAdminOpportunities();
                            } else {
                                showNotification('Access denied. Admin privileges required.', 'error');
                            }
                        }).catch(error => {
                            console.error('Error checking admin status:', error);
                            showNotification('Error checking admin status', 'error');
                        });
                    }
                } else {
                    showNotification('Please sign in to access admin panel', 'warning');
                }
            }

            // Switch dashboard tab
            function switchDashboardTab(tabName) {
                if (!dashboardTabs) return;
                
                // Update tabs
                dashboardTabs.forEach(tab => {
                    if (tab.getAttribute('data-tab') === tabName) {
                        tab.classList.add('active');
                    } else {
                        tab.classList.remove('active');
                    }
                });
                
                // Update content
                if (tabName === 'pending') {
                    document.getElementById('pendingContent').classList.add('active');
                    document.getElementById('completedContent').classList.remove('active');
                } else {
                    document.getElementById('pendingContent').classList.remove('active');
                    document.getElementById('completedContent').classList.add('active');
                }
            }

            // Show admin modal for adding/editing opportunities
            function showAdminModal(opportunity = null) {
                if (!adminModal) return;
                
                // Check if user is admin
                const user = auth.currentUser;
                if (!user) {
                    showNotification('Please sign in to access admin features', 'warning');
                    return;
                }
                
                if (!isAdminUser) {
                    showNotification('Access denied. Admin privileges required.', 'error');
                    return;
                }
                
                if (opportunity) {
                    // Editing existing opportunity
                    adminModalTitle.textContent = 'Edit Opportunity';
                    document.getElementById('opportunityId').value = opportunity.id;
                    document.getElementById('adminTitle').value = opportunity.title;
                    document.getElementById('adminOrganization').value = opportunity.organization;
                    document.getElementById('adminType').value = opportunity.type;
                    document.getElementById('adminField').value = opportunity.field;
                    document.getElementById('adminDescription').value = opportunity.description;
                    document.getElementById('adminLocation').value = opportunity.location;
                    document.getElementById('adminDeadline').value = opportunity.deadline;
                    document.getElementById('adminApplyLink').value = opportunity.applyLink;
                    document.getElementById('adminImpact').value = opportunity.impact;
                    document.getElementById('adminPaid').checked = opportunity.paid || false;
                    document.getElementById('adminStipend').checked = opportunity.stipend || false;
                    document.getElementById('adminScholarship').checked = opportunity.scholarship || false;
                    document.getElementById('adminAmount').value = opportunity.amount || '';
                } else {
                    // Adding new opportunity
                    adminModalTitle.textContent = 'Add New Opportunity';
                    adminOpportunityForm.reset();
                    document.getElementById('opportunityId').value = '';
                }
                
                adminModal.style.display = 'flex';
            }

            // Handle admin form submission
            function handleAdminFormSubmit(e) {
                e.preventDefault();
                
                // Check if user is admin
                const user = auth.currentUser;
                if (!user) {
                    showNotification('Please sign in to access admin features', 'warning');
                    return;
                }
                
                if (!isAdminUser) {
                    showNotification('Access denied. Admin privileges required.', 'error');
                    return;
                }
                
                const opportunityId = document.getElementById('opportunityId').value;
                const title = document.getElementById('adminTitle').value;
                const organization = document.getElementById('adminOrganization').value;
                const type = document.getElementById('adminType').value;
                const field = document.getElementById('adminField').value;
                const description = document.getElementById('adminDescription').value;
                const location = document.getElementById('adminLocation').value;
                const deadline = document.getElementById('adminDeadline').value;
                const applyLink = document.getElementById('adminApplyLink').value;
                const impact = document.getElementById('adminImpact').value;
                const paid = document.getElementById('adminPaid').checked;
                const stipend = document.getElementById('adminStipend').checked;
                const scholarship = document.getElementById('adminScholarship').checked;
                const amount = document.getElementById('adminAmount').value;
                
                const opportunityData = {
                    title,
                    organization,
                    type,
                    field,
                    description,
                    location,
                    deadline,
                    applyLink,
                    impact,
                    paid,
                    stipend,
                    scholarship,
                    amount: amount || '',
                    createdAt: opportunityId ? allOpportunities.find(opp => opp.id === opportunityId).createdAt : new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                if (opportunityId) {
                    // Update existing opportunity
                    update(ref(database, `opportunities/${opportunityId}`), opportunityData)
                        .then(() => {
                            adminModal.style.display = 'none';
                            showNotification('Opportunity updated successfully!');
                        })
                        .catch((error) => {
                            showNotification('Error updating opportunity: ' + error.message, 'error');
                        });
                } else {
                    // Add new opportunity
                    const newOpportunityRef = push(ref(database, 'opportunities'));
                    set(newOpportunityRef, opportunityData)
                        .then(() => {
                            adminModal.style.display = 'none';
                            showNotification('Opportunity added successfully!');
                        })
                        .catch((error) => {
                            showNotification('Error adding opportunity: ' + error.message, 'error');
                        });
                }
            }

            // Delete opportunity
            function deleteOpportunity(opportunityId) {
                // Check if user is admin
                const user = auth.currentUser;
                if (!user) {
                    showNotification('Please sign in to access admin features', 'warning');
                    return;
                }
                
                if (!isAdminUser) {
                    showNotification('Access denied. Admin privileges required.', 'error');
                    return;
                }
                
                if (confirm('Are you sure you want to delete this opportunity?')) {
                    remove(ref(database, `opportunities/${opportunityId}`))
                        .then(() => {
                            showNotification('Opportunity deleted successfully!');
                        })
                        .catch((error) => {
                            showNotification('Error deleting opportunity: ' + error.message, 'error');
                        });
                }
            }

            // Initialize the app
            function initApp() {
                loadOpportunitiesFromFirebase();
                checkDeadlines();
                
                // Clean up expired notification markers
                if (notificationManager) {
                    notificationManager.cleanupExpiredMarkers();
                }
            }
        });
    </script>
</body>
</html>
